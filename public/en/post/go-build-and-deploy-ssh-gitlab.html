

<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=51376&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="content-type" content="text/html; charset=utf-8" />

<title>Compilation and deploy via SSH in Gitlab CI | Golang for all</title>




  






  
  
    
  








  



<meta name="description" content="Let&rsquo;s take a look at how Go compilation works and how to use GitLab CI for that.
">


<meta property="og:type" content="article">
<meta property="og:url" content="http://localhost:51376/en/post/go-build-and-deploy-ssh-gitlab.html">
<meta property="og:title" content="Compilation and deploy via SSH in Gitlab CI | Golang for all">
<meta property="og:description" content="Let&rsquo;s take a look at how Go compilation works and how to use GitLab CI for that.
">
<meta property="og:image" content="http://localhost:51376/en/post/go-build-and-deploy-ssh-gitlab/gitlab_logo.svg">
<meta property="og:site_name" content="Golang for all">
<meta property="og:locale" content="en">

  
    <meta property="article:published_time" content="2020-05-08T09:00:00&#43;03:00">
  
  
    <meta property="article:modified_time" content="2020-05-08T09:00:00&#43;03:00">
  
  
    
      <meta property="article:tag" content="Gitlab">
    
      <meta property="article:tag" content="Compilation">
    
      <meta property="article:tag" content="Deploy">
    
      <meta property="article:tag" content="Ssh">
    
      <meta property="article:tag" content="Modules">
    
      <meta property="article:tag" content="Vendor">
    
      <meta property="article:tag" content="Ci/Cd">
    
  



<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:url" content="http://localhost:51376/en/post/go-build-and-deploy-ssh-gitlab.html">
<meta name="twitter:title" content="Compilation and deploy via SSH in Gitlab CI | Golang for all">
<meta name="twitter:description" content="Let&rsquo;s take a look at how Go compilation works and how to use GitLab CI for that.
">
<meta name="twitter:image" content="http://localhost:51376/en/post/go-build-and-deploy-ssh-gitlab/gitlab_logo.svg">



<link rel="canonical" href="http://localhost:51376/en/post/go-build-and-deploy-ssh-gitlab.html">



  <link rel="alternate" hreflang="ru" href="http://localhost:51376/ru/post/go-build-and-deploy-ssh-gitlab.html">


<meta name="yandex-verification" content="10233a4b32f4dc29" />
<meta name="yandex-verification" content="cfa4be404c1af368" />

<link rel="icon" type="image/png" sizes="93x93" href="/gophereye.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="/gophereye32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/gophereye16x16.png">


    <link rel="stylesheet" href="/css/main.css">


      <script src="/js/main.js"></script>


<link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.4.6/css/flag-icon.min.css" integrity="sha256-YjcCvXkdRVOucibC9I4mBS41lXPrWfqY2BnpskhZPnw=" crossorigin="anonymous" />


</head>
<body>
<div class="container">
    <nav class="navbar navbar-expand-lg navbar-light" style="padding-bottom: 0;">
        <div class="container">
            <a class="navbar-brand" href="/en/" style="padding-bottom: 0">
                <img src="/verh.svg" alt="gopher eyes" style="height: 50px;"/>
            </a>

            <button class="navbar-toggler" type="button"
                    data-toggle="collapse"
                    data-target="#navbarResponsive"
                    aria-controls="navbarResponsive"
                    aria-expanded="false"
                    aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <a href="/en/" style="color:#000;"><span class="gopherchat">Golang for all</span></a>
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="/en/about.html">About</a>
                    </li>
                    
                </ul>
            </div>
        </div>
    </nav>
</div>
<div class="bg-light">&nbsp;</div>

<div class="container">
    
<div class="col-lg-12">
    
    <h1 class="mt-4">Compilation and deploy via SSH in Gitlab CI</h1>

    
    <p>


  May 8, 2020



            <a href="/tags/gitlab/" class="badge">Gitlab</a>
            <a href="/tags/compilation/" class="badge">Compilation</a>
            <a href="/tags/deploy/" class="badge">Deploy</a>
            <a href="/tags/ssh/" class="badge">Ssh</a>
            <a href="/tags/modules/" class="badge">Modules</a>
            <a href="/tags/vendor/" class="badge">Vendor</a>
            <a href="/tags/ci/cd/" class="badge">Ci/Cd</a>
    </p>

    <hr/>

    
    
    
    <div class="container">
        <div class="row mx-0 my-0">
            <div class="col-md-8">
                <img class="img-fluid rounded"
                     style="max-height: 400px;"
                     src="/en/post/go-build-and-deploy-ssh-gitlab/gitlab_logo.svg"
                     alt="Compilation and deploy via SSH in Gitlab CI"/>
            </div>
            <div class="col-md-4">
                
                
                <nav id="toc">
                    <h5>Contents</h5>
                    <nav id="TableOfContents">
  <ul>
    <li><a href="#compilation">Compilation</a></li>
    <li><a href="#vendor-or-loading">Vendor or Loading</a></li>
    <li><a href="#gitlab">GitLab</a></li>
    <li><a href="#compilation-with-gitlab">Compilation with GitLab</a></li>
    <li><a href="#deploy-via-ssh">Deploy via SSH</a></li>
  </ul>
</nav>
                </nav>
                
            </div>
        </div>
    </div>
    <hr>
    
    

    <div id="post-content">
    <p>Let&rsquo;s take a look at how Go compilation works and how to use GitLab CI for that.</p>
<h2 id="compilation">Compilation</h2>
<p>To compile a Go program, we should run <code>go build -o binary_name</code>.</p>
<p>If there are imports of third-party code, that means there are external dependencies in the project. To build a binary, all source code is required (including the source code of third-party libraries).</p>
<h2 id="vendor-or-loading">Vendor or Loading</h2>
<p>Currently, the latest Go version is 1.14.2. Starting from Go 1.11, there is Go modules functionality in Go.</p>
<p>Go modules make Go download every dependency when <code>go run</code> or <code>go build</code> is called. Also, we can explicitly download dependencies by calling <code>go get ./...</code>.</p>
<p>Downloaded dependency code is cached in <code>$GOPATH/pkg/mod</code> or in <code>$HOME/go/pkg/mod</code>, if the <code>$GOPATH</code> variable is not set.</p>
<p>There is also a vendor approach that can be used for dependencies. If the <code>-mod=vendor</code> parameter is set, dependencies will be downloaded to the <code>vendor</code> folder. That folder can be located inside the project repository and stored in Git.</p>
<p>If dependency source code is stored with the project code, there is no need to download dependencies.</p>
<h2 id="gitlab">GitLab</h2>
<p>GitLab allows us to run some actions after a code push.</p>
<p>To make GitLab do something with your code, we need to put a <code>.gitlab-ci.yml</code> file with instructions into the root of the repository.</p>
<h2 id="compilation-with-gitlab">Compilation with GitLab</h2>
<p>We need to set particular stages and actions to make GitLab perform them. For every stage and action, we can specify a Docker image which will be downloaded.</p>
<p>The source code is downloaded into <code>/builds/{project_group}/{project_name}</code> folder, which means there is no need to do anything to get the source code.</p>
<p>I created a build stage and an action with the same name:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">stages</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">build</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">build</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">image</span>: <span style="color:#ae81ff">rhaps1071/golang-1.14-alpine-git</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">stage</span>: <span style="color:#ae81ff">build</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">script</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">go get ./...</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">GOARCH=amd64 GOOS=linux go build -ldflags &#34;-extldflags &#39;-static&#39;&#34; -o $CI_PROJECT_DIR/binary</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">artifacts</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">paths</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">binary</span>
</span></span></code></pre></div><p>I used a custom Docker image <code>rhaps1071/golang-1.14-alpine-git</code> to perform the build. I added the <code>git</code> command to my custom Docker image, which is absent in <code>golang:1.14-alpine</code>. That is critical to make <code>go get ./...</code> work, which downloads dependencies by using <code>git clone</code>.</p>
<p><code>golang:1.14-alpine</code> is based on Alpine Linux, which is very small (about 3MB). But <code>golang:1.14-alpine</code> size is 370MB because of Go in it. However, there is a 2x image size economy compared to <code>golang:1.14</code> (809MB), which is based on Ubuntu.</p>
<p>There is no vendor approach in the project, so I have to download the dependencies. That&rsquo;s why <code>go get ./...</code> is used.</p>
<p>As mentioned before, the source code is placed into <code>/builds/{project_group}/{project_name}</code> folder by GitLab. That path is outside <code>$GOPATH</code>. To make Go commands work outside <code>$GOPATH</code>, a <code>go.mod</code> file is required to be placed in the root of project files. That file can be created with the <code>go mod init</code> command. If there is no <code>go.mod</code> file, <code>go get ./...</code> (also <code>go run</code> and <code>go build</code>) will fail to run outside <code>$GOPATH</code>.</p>
<p>If there are no Go modules in your project, your source code needs to be placed inside <code>$GOPATH</code>. In GitLab CI, we can do that by copying in the following way:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cp /builds/* $GOPATH/src/
</span></span></code></pre></div><p>The <code>artifacts</code> section in <code>.gitlab-ci.yml</code> allows us to save any file from CI for manual download via the GitLab interface or to pass that file to following stages/actions.</p>
<h2 id="deploy-via-ssh">Deploy via SSH</h2>
<p>Let&rsquo;s take a look at a simple binary deploy via SSH:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">deploy_stage</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">image</span>: <span style="color:#ae81ff">kroniak/ssh-client</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">stage</span>: <span style="color:#ae81ff">deploy</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">stage</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">url</span>: <span style="color:#ae81ff">http://stage.project.com</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">when</span>: <span style="color:#ae81ff">manual</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">script</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">mkdir -p ~/.ssh</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">echo &#34;$SSH_PRIVATE_KEY&#34; &gt; ~/.ssh/id_rsa</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">chmod -R 700 ~/.ssh</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">echo &#34;$SSH_KNOWN_HOSTS&#34; &gt;&gt; ~/.ssh/known_hosts</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">chmod 644 ~/.ssh/known_hosts</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">echo &#34;$CONFIG&#34; &gt; ./config.json</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">scp -P$SSH_PORT -r ./config.json $SSH_USER@$SSH_HOST:/var/www/project/config/</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">scp -P$SSH_PORT -r ./binary $SSH_USER@$SSH_HOST:~/binary_tmp</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">ssh -p$SSH_PORT $SSH_USER@$SSH_HOST &#39;sudo service project stop &amp;&amp; cp ~/binary_tmp /var/www/project/binary &amp;&amp; sudo service project restart&#39;</span>
</span></span></code></pre></div><p>Here we are using a custom Docker image based on Alpine Linux again — <code>kroniak/ssh-client</code> size is 12.1MB. This time there is an SSH client installed, which allows us to use <code>ssh</code> and <code>scp</code> commands.</p>
<p>The deploy logic is as follows:</p>
<ul>
<li>The following GitLab variables are set:
<ul>
<li><code>$SSH_PRIVATE_KEY</code> — private SSH key to access the server</li>
<li><code>$SSH_USER</code>, <code>$SSH_HOST</code>, <code>$SSH_PORT</code> — SSH credentials</li>
<li><code>$SSH_KNOWN_HOSTS</code> — data for <code>.ssh/known_hosts</code> file, which helps us validate that we are deploying to the exact server</li>
<li><code>$CONFIG</code> — contents of the service config file in JSON</li>
</ul>
</li>
<li>On deploy, we put data from some GitLab variables into files</li>
<li>All files are copied with the <code>scp</code> command. We could use <code>rsync</code> here because it only copies changed files. But since there are only 2 files that need to be copied, it doesn&rsquo;t matter</li>
<li>Finally, we change our binary and restart the service</li>
</ul>
<p>Full contents of <code>.gitlab-ci.yml</code> is below:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">stages</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">build</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">deploy</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">build</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">image</span>: <span style="color:#ae81ff">rhaps1071/golang-1.14-alpine-git</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">stage</span>: <span style="color:#ae81ff">build</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">script</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">go get ./...</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">GOARCH=amd64 GOOS=linux go build -ldflags &#34;-extldflags &#39;-static&#39;&#34; -o $CI_PROJECT_DIR/binary</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">artifacts</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">paths</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">binary</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">deploy_stage</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">image</span>: <span style="color:#ae81ff">kroniak/ssh-client</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">stage</span>: <span style="color:#ae81ff">deploy</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">stage</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">url</span>: <span style="color:#ae81ff">http://stage.project.com</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">when</span>: <span style="color:#ae81ff">manual</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">script</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">mkdir -p ~/.ssh</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">echo &#34;$SSH_PRIVATE_KEY&#34; &gt; ~/.ssh/id_rsa</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">chmod -R 700 ~/.ssh</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">echo &#34;$SSH_KNOWN_HOSTS&#34; &gt;&gt; ~/.ssh/known_hosts</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">chmod 644 ~/.ssh/known_hosts</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">echo &#34;$CONFIG&#34; &gt; ./config.json</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">scp -P$SSH_PORT -r ./config.json $SSH_USER@$SSH_HOST:/var/www/project/config/</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">scp -P$SSH_PORT -r ./binary $SSH_USER@$SSH_HOST:~/binary_tmp</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">ssh -p$SSH_PORT $SSH_USER@$SSH_HOST &#39;sudo service project stop &amp;&amp; cp ~/binary_tmp /var/www/project/binary &amp;&amp; sudo service project restart&#39;</span>
</span></span></code></pre></div>
    
  <div>
    <div>Tags:</div>
    <ul>
        <li><a href="/tags/gitlab/">Gitlab</a></li>
        <li><a href="/tags/compilation/">Compilation</a></li>
        <li><a href="/tags/deploy/">Deploy</a></li>
        <li><a href="/tags/ssh/">Ssh</a></li>
        <li><a href="/tags/modules/">Modules</a></li>
        <li><a href="/tags/vendor/">Vendor</a></li>
        <li><a href="/tags/ci/cd/">Ci/Cd</a></li>
    </ul>
  </div>

    </div>
    
<div id="article-quiz" class="mt-5 mb-5" data-quiz-lang="en">
  <hr class="mb-4">
  <h3 class="mb-4">Test Your Knowledge</h3>
  
  <form id="quiz-form" data-quiz-data="{&#34;questions&#34;:[{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;.gitlab-ci.yml&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;gitlab.yml&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;ci.yml&#34;}],&#34;question&#34;:&#34;What file is needed in the repository root to enable GitLab CI?&#34;,&#34;type&#34;:&#34;single-choice&#34;},{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;go.mod&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;go.sum&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;vendor.json&#34;}],&#34;question&#34;:&#34;What file is required for Go commands to work outside $GOPATH?&#34;,&#34;type&#34;:&#34;single-choice&#34;},{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;To store dependency source code with project code&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;To download dependencies automatically&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;To compile faster&#34;}],&#34;question&#34;:&#34;What is the vendor approach used for?&#34;,&#34;type&#34;:&#34;single-choice&#34;},{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;artifacts&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;files&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;output&#34;}],&#34;question&#34;:&#34;What section in .gitlab-ci.yml allows saving files for download or passing to following stages?&#34;,&#34;type&#34;:&#34;single-choice&#34;}]}">
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="0">
      <h5 class="mb-3">1. What file is needed in the repository root to enable GitLab CI?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-0" 
                 value="0"
                 id="q0-a0">
          <label class="form-check-label" for="q0-a0">
            .gitlab-ci.yml
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-0" 
                 value="1"
                 id="q0-a1">
          <label class="form-check-label" for="q0-a1">
            gitlab.yml
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-0" 
                 value="2"
                 id="q0-a2">
          <label class="form-check-label" for="q0-a2">
            ci.yml
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="1">
      <h5 class="mb-3">2. What file is required for Go commands to work outside $GOPATH?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-1" 
                 value="0"
                 id="q1-a0">
          <label class="form-check-label" for="q1-a0">
            go.mod
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-1" 
                 value="1"
                 id="q1-a1">
          <label class="form-check-label" for="q1-a1">
            go.sum
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-1" 
                 value="2"
                 id="q1-a2">
          <label class="form-check-label" for="q1-a2">
            vendor.json
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="2">
      <h5 class="mb-3">3. What is the vendor approach used for?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-2" 
                 value="0"
                 id="q2-a0">
          <label class="form-check-label" for="q2-a0">
            To store dependency source code with project code
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-2" 
                 value="1"
                 id="q2-a1">
          <label class="form-check-label" for="q2-a1">
            To download dependencies automatically
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-2" 
                 value="2"
                 id="q2-a2">
          <label class="form-check-label" for="q2-a2">
            To compile faster
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="3">
      <h5 class="mb-3">4. What section in .gitlab-ci.yml allows saving files for download or passing to following stages?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-3" 
                 value="0"
                 id="q3-a0">
          <label class="form-check-label" for="q3-a0">
            artifacts
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-3" 
                 value="1"
                 id="q3-a1">
          <label class="form-check-label" for="q3-a1">
            files
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-3" 
                 value="2"
                 id="q3-a2">
          <label class="form-check-label" for="q3-a2">
            output
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    
    <button type="button" class="btn btn-primary" id="check-answers">
      Check Answers
    </button>
    <button type="button" class="btn btn-secondary ml-2" id="reset-quiz" style="display: none;">
      Reset
    </button>
  </form>
  
  <div id="quiz-results" class="mt-4" style="display: none;">
    <div class="alert" role="alert"></div>
  </div>
</div>

<script>
(function() {
  try {
    const quizContainer = document.getElementById('article-quiz');
    const form = document.getElementById('quiz-form');
    const checkBtn = document.getElementById('check-answers');
    const resetBtn = document.getElementById('reset-quiz');
    const resultsDiv = document.getElementById('quiz-results');
    
    if (!quizContainer || !form || !checkBtn) {
      console.error('Quiz initialization failed: missing elements', {
        quizContainer: !!quizContainer,
        form: !!form,
        checkBtn: !!checkBtn
      });
      return;
    }
    
    const lang = quizContainer.getAttribute('data-quiz-lang') || 'en';
    const quizDataRaw = form.getAttribute('data-quiz-data');
    
    if (!quizDataRaw) {
      console.error('Quiz data not found in data attribute');
      return;
    }
    
    let quizData;
    try {
      quizData = JSON.parse(quizDataRaw);
    } catch (e) {
      console.error('Failed to parse quiz data:', e, quizDataRaw);
      return;
    }
    
    if (!quizData || !quizData.questions || !Array.isArray(quizData.questions)) {
      console.error('Invalid quiz data structure:', quizData);
      return;
    }
    
    
    console.log('Quiz data loaded:', quizData);
  
    function arraysEqual(a, b) {
      if (!a || !b) return false;
      if (a.length !== b.length) return false;
      const sortedA = [...a].sort();
      const sortedB = [...b].sort();
      return sortedA.every((val, i) => val === sortedB[i]);
    }
    
    checkBtn.addEventListener('click', function() {
    if (!quizData.questions || !Array.isArray(quizData.questions)) {
      console.error('Invalid quiz data structure');
      return;
    }
    
    let correctCount = 0;
    let totalQuestions = quizData.questions.length;
    
    quizData.questions.forEach((question, qIndex) => {
      const questionDiv = form.querySelector(`[data-question-index="${qIndex}"]`);
      if (!questionDiv) {
        console.error('Question div not found for index:', qIndex);
        return;
      }
      
      const feedbackDiv = questionDiv.querySelector('.quiz-feedback');
      if (!feedbackDiv) {
        console.error('Feedback div not found for question:', qIndex);
        return;
      }
      
      if (question.type === 'multiple-choice' || question.type === 'single-choice') {
        if (!question.answers || !Array.isArray(question.answers)) {
          console.error('Invalid answers for question:', qIndex);
          return;
        }
        
        const inputs = questionDiv.querySelectorAll(`input[name="question-${qIndex}"]`);
        const selectedAnswers = Array.from(inputs)
          .filter(input => input.checked)
          .map(input => parseInt(input.value));
        
        const correctAnswers = question.answers
          .map((answer, index) => answer.correct === true ? index : -1)
          .filter(index => index !== -1);
        
        const isCorrect = arraysEqual(selectedAnswers, correctAnswers);
        
        if (isCorrect) {
          correctCount++;
          feedbackDiv.innerHTML = '<span class="text-success">✓ ' + (lang === 'ru' ? 'Правильно!' : 'Correct!') + '</span>';
          feedbackDiv.style.display = 'block';
          inputs.forEach(input => {
            const answerIndex = parseInt(input.value);
            const answer = question.answers[answerIndex];
            if (!answer) return;
            
            if (input.checked && answer.correct === true) {
              input.parentElement.classList.add('text-success');
            } else if (input.checked && answer.correct !== true) {
              input.parentElement.classList.add('text-danger');
            } else if (!input.checked && answer.correct === true) {
              input.parentElement.classList.add('text-warning');
            }
          });
        } else {
          feedbackDiv.innerHTML = '<span class="text-danger">✗ ' + (lang === 'ru' ? 'Неправильно' : 'Incorrect') + '</span>';
          feedbackDiv.style.display = 'block';
          inputs.forEach(input => {
            const answerIndex = parseInt(input.value);
            const answer = question.answers[answerIndex];
            if (!answer) return;
            
            if (input.checked && answer.correct !== true) {
              input.parentElement.classList.add('text-danger');
            } else if (!input.checked && answer.correct === true) {
              input.parentElement.classList.add('text-warning');
            }
          });
        }
      } else if (question.type === 'text') {
        const textarea = questionDiv.querySelector('textarea');
        const correctAnswerDiv = questionDiv.querySelector('[data-correct-answer]');
        
        if (!textarea || !question.correct_answer) {
          console.error('Invalid text question:', qIndex);
          return;
        }
        
        if (textarea.value.trim().toLowerCase() === question.correct_answer.toLowerCase()) {
          correctCount++;
          feedbackDiv.innerHTML = '<span class="text-success">✓ ' + (lang === 'ru' ? 'Правильно!' : 'Correct!') + '</span>';
          feedbackDiv.style.display = 'block';
        } else {
          feedbackDiv.innerHTML = '<span class="text-danger">✗ ' + (lang === 'ru' ? 'Неправильно' : 'Incorrect') + '</span>';
          feedbackDiv.style.display = 'block';
          if (correctAnswerDiv) {
            correctAnswerDiv.style.display = 'block';
          }
        }
      }
    });
    
    const percentage = Math.round((correctCount / totalQuestions) * 100);
    const alertClass = percentage >= 70 ? 'alert-success' : percentage >= 50 ? 'alert-warning' : 'alert-danger';
    const message = (lang === 'ru' ? 'Вы ответили правильно на ' : 'You got ') + 
                   correctCount + (lang === 'ru' ? ' из ' : ' out of ') + 
                   totalQuestions + (lang === 'ru' ? ' вопросов (' : ' questions (') + 
                   percentage + '%)';
    
    const alertElement = resultsDiv.querySelector('.alert');
    if (alertElement) {
      alertElement.className = 'alert ' + alertClass;
      alertElement.textContent = message;
    }
      resultsDiv.style.display = 'block';
      checkBtn.style.display = 'none';
      if (resetBtn) {
        resetBtn.style.display = 'inline-block';
      }
    });
    
    if (resetBtn) {
      resetBtn.addEventListener('click', function() {
        form.reset();
        form.querySelectorAll('.quiz-feedback').forEach(el => el.style.display = 'none');
        form.querySelectorAll('.text-success, .text-danger, .text-warning').forEach(el => {
          el.classList.remove('text-success', 'text-danger', 'text-warning');
        });
        form.querySelectorAll('[data-correct-answer]').forEach(el => el.style.display = 'none');
        resultsDiv.style.display = 'none';
        checkBtn.style.display = 'inline-block';
        resetBtn.style.display = 'none';
      });
    }
  } catch (error) {
    console.error('Quiz script error:', error);
  }
})();
</script>



    
    <hr class="mt-5 mb-4">
    <h3 class="mb-4">Related Articles</h3>
    <div class="row">
      <div class="col-md-6 mb-4">
        <div class="card h-100 bg-light rounded" style="border: none;">
          <div class="card-body">
            <span style="color: #aaa; font-size: 0.9em;">


  December 20, 2024


</span>
            <h4 class="card-title mt-2">
              <a href="/en/post/go-telegram-bot-aws-lambda-deploy.html" style="text-decoration: none; color: inherit;">Deploying Telegram Bot to AWS Lambda with Function URL</a>
            </h4>
            
            
            
            
            <p class="card-text"><p>This article is a continuation of <a href="/en/post/go-telegram-gemini-ai-bot.html">&ldquo;Building an AI Telegram Bot with Go, Gemini API, and AWS Lambda&rdquo;</a> and contains detailed instructions for setting up and deploying a Telegram bot to AWS Lambda using Function URL.</p></p>
            
            <a href="/en/post/go-telegram-bot-aws-lambda-deploy.html" class="btn btn-primary btn-sm">Read More →</a>
                  <a href="/tags/go/" class="badge">Go</a>
                  <a href="/tags/telegram/" class="badge">Telegram</a>
                  <a href="/tags/aws/" class="badge">Aws</a>
                  <a href="/tags/lambda/" class="badge">Lambda</a>
                  <a href="/tags/deploy/" class="badge">Deploy</a>
                  <a href="/tags/function-url/" class="badge">Function-Url</a>
                  <a href="/tags/cli/" class="badge">Cli</a>
          </div>
        </div>
      </div>
      <div class="col-md-6 mb-4">
        <div class="card h-100 bg-light rounded" style="border: none;">
          <div class="card-body">
            <span style="color: #aaa; font-size: 0.9em;">


  July 1, 2020


</span>
            <h4 class="card-title mt-2">
              <a href="/en/post/deploy-docker-swarm-gitlab.html" style="text-decoration: none; color: inherit;">Deploy docker swarm from Gitlab CI</a>
            </h4>
            
            
            
            <a href="/en/post/deploy-docker-swarm-gitlab.html">
              <img class="card-img-top mb-3 rounded"
                   src="/en/post/deploy-docker-swarm-gitlab/docker.svg"
                   style="max-height: 200px;"
                   alt="Deploy docker swarm from Gitlab CI"/>
            </a>
            
            
            <p class="card-text"><p>Docker container deployment has many advantages over binary deployment. Let&rsquo;s dive into advantages and see how we can implement docker container deployment from Gitlab CI.
Let&rsquo;s talk about how standard docker can help us. Any docker orchestration tools (Kubernetes, for example) will be observed in future articles.</p></p>
            
            <a href="/en/post/deploy-docker-swarm-gitlab.html" class="btn btn-primary btn-sm">Read More →</a>
                  <a href="/tags/docker/" class="badge">Docker</a>
                  <a href="/tags/deploy/" class="badge">Deploy</a>
                  <a href="/tags/gitlab/" class="badge">Gitlab</a>
                  <a href="/tags/ci/cd/" class="badge">Ci/Cd</a>
          </div>
        </div>
      </div>
      <div class="col-md-6 mb-4">
        <div class="card h-100 bg-light rounded" style="border: none;">
          <div class="card-body">
            <span style="color: #aaa; font-size: 0.9em;">


  June 29, 2020


</span>
            <h4 class="card-title mt-2">
              <a href="/ru/post/go-minimum-docker-image.html" style="text-decoration: none; color: inherit;">Building Minimal Docker Images for Go Applications</a>
            </h4>
            
            
            
            <a href="/ru/post/go-minimum-docker-image.html">
              <img class="card-img-top mb-3 rounded"
                   src="/ru/post/go-minimum-docker-image/docker.svg"
                   style="max-height: 200px;"
                   alt="Building Minimal Docker Images for Go Applications"/>
            </a>
            
            
            <p class="card-text"><p>Let&rsquo;s discuss how to build a minimal Docker image for a Go program.</p></p>
            
            <a href="/ru/post/go-minimum-docker-image.html" class="btn btn-primary btn-sm">Read More →</a>
                  <a href="/tags/docker/" class="badge">Docker</a>
                  <a href="/tags/compilation/" class="badge">Compilation</a>
                  <a href="/tags/upx/" class="badge">Upx</a>
                  <a href="/tags/ldflags/" class="badge">Ldflags</a>
          </div>
        </div>
      </div>
    </div>


    <script defer src="/discuss.js"></script>
    <div id="discuss"></div>
</div>

</div>

<div class="bg-light">&nbsp;</div>

<footer>
    <div class="container " style="padding-top: 0; padding-bottom: 10px;">
    <div class="container">
        <img src="/niz.svg" alt="gopher legs" style="height: 50px; vertical-align: top;"/>
        <div style="text-align: right; vertical-align: top; display: inline-block;">
            
            &nbsp;
            &nbsp;
            &nbsp;
            
            
            <a href='/ru/post/go-build-and-deploy-ssh-gitlab.html'>
            <span class="flag-icon flag-icon-ru"></span>
            </a>
            
        </div>

    </div>
</div>

</footer>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script defer src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

</body>
</html>
