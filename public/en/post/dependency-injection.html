

<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=51376&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="content-type" content="text/html; charset=utf-8" />

<title>Dependency injection in GO | Golang for all</title>




  






  
  
    
  








  



<meta name="description" content="Let&rsquo;s talk about dependency injection pattern and dependency management in large programs.
">


<meta property="og:type" content="article">
<meta property="og:url" content="http://localhost:51376/en/post/dependency-injection.html">
<meta property="og:title" content="Dependency injection in GO | Golang for all">
<meta property="og:description" content="Let&rsquo;s talk about dependency injection pattern and dependency management in large programs.
">
<meta property="og:image" content="http://localhost:51376/en/post/dependency-injection/vlog.svg">
<meta property="og:site_name" content="Golang for all">
<meta property="og:locale" content="en">

  
    <meta property="article:published_time" content="2020-04-21T09:00:00&#43;03:00">
  
  
    <meta property="article:modified_time" content="2020-04-21T09:00:00&#43;03:00">
  
  
    
      <meta property="article:tag" content="Dependency">
    
      <meta property="article:tag" content="Injection">
    
      <meta property="article:tag" content="Container">
    
      <meta property="article:tag" content="Singleton">
    
      <meta property="article:tag" content="Multiton">
    
  



<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:url" content="http://localhost:51376/en/post/dependency-injection.html">
<meta name="twitter:title" content="Dependency injection in GO | Golang for all">
<meta name="twitter:description" content="Let&rsquo;s talk about dependency injection pattern and dependency management in large programs.
">
<meta name="twitter:image" content="http://localhost:51376/en/post/dependency-injection/vlog.svg">



<link rel="canonical" href="http://localhost:51376/en/post/dependency-injection.html">



  <link rel="alternate" hreflang="ru" href="http://localhost:51376/ru/post/dependency-injection.html">


<meta name="yandex-verification" content="10233a4b32f4dc29" />
<meta name="yandex-verification" content="cfa4be404c1af368" />

<link rel="icon" type="image/png" sizes="93x93" href="/gophereye.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="/gophereye32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/gophereye16x16.png">


    <link rel="stylesheet" href="/css/main.css">


      <script src="/js/main.js"></script>


<link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.4.6/css/flag-icon.min.css" integrity="sha256-YjcCvXkdRVOucibC9I4mBS41lXPrWfqY2BnpskhZPnw=" crossorigin="anonymous" />


</head>
<body>
<div class="container">
    <nav class="navbar navbar-expand-lg navbar-light" style="padding-bottom: 0;">
        <div class="container">
            <a class="navbar-brand" href="/en/" style="padding-bottom: 0">
                <img src="/verh.svg" alt="gopher eyes" style="height: 50px;"/>
            </a>

            <button class="navbar-toggler" type="button"
                    data-toggle="collapse"
                    data-target="#navbarResponsive"
                    aria-controls="navbarResponsive"
                    aria-expanded="false"
                    aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <a href="/en/" style="color:#000;"><span class="gopherchat">Golang for all</span></a>
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="/en/about.html">About</a>
                    </li>
                    
                </ul>
            </div>
        </div>
    </nav>
</div>
<div class="bg-light">&nbsp;</div>

<div class="container">
    
<div class="col-lg-12">
    
    <h1 class="mt-4">Dependency injection in GO</h1>

    
    <p>


  April 21, 2020



            <a href="/tags/dependency/" class="badge">Dependency</a>
            <a href="/tags/injection/" class="badge">Injection</a>
            <a href="/tags/container/" class="badge">Container</a>
            <a href="/tags/singleton/" class="badge">Singleton</a>
            <a href="/tags/multiton/" class="badge">Multiton</a>
    </p>

    <hr/>

    
    
    
    <div class="container">
        <div class="row mx-0 my-0">
            <div class="col-md-8">
                <img class="img-fluid rounded"
                     style="max-height: 400px;"
                     src="/en/post/dependency-injection/vlog.svg"
                     alt="Dependency injection in GO"/>
            </div>
            <div class="col-md-4">
                
                
                <nav id="toc">
                    <h5>Contents</h5>
                    <nav id="TableOfContents">
  <ul>
    <li><a href="#logger-example">Logger example</a></li>
    <li><a href="#definition">Definition</a></li>
    <li><a href="#issues">Issues</a>
      <ul>
        <li><a href="#service-with-more-dependencies">Service with more dependencies</a></li>
        <li><a href="#copy-init-code">Copy init code</a></li>
        <li><a href="#implement-init-code-for-each-dep">Implement init code for each dep</a></li>
        <li><a href="#singleton">Singleton</a></li>
        <li><a href="#pool-of-singletons-multiton">Pool of singletons (multiton)</a></li>
      </ul>
    </li>
    <li><a href="#dependency-injection-container-injector">Dependency injection container (injector)</a>
      <ul>
        <li><a href="#uber-godig">uber-go/dig</a></li>
        <li><a href="#elliotchancedingo">elliotchance/dingo</a></li>
        <li><a href="#sarulabsdi">sarulabs/di</a></li>
        <li><a href="#googlewire">google/wire</a></li>
      </ul>
    </li>
    <li><a href="#comparison-table">Comparison table</a></li>
  </ul>
</nav>
                </nav>
                
            </div>
        </div>
    </div>
    <hr>
    
    

    <div id="post-content">
    <p>Let&rsquo;s talk about dependency injection pattern and dependency management in large programs.</p>
<h2 id="logger-example">Logger example</h2>
<p>In any program there is <code>main.go</code> which manages to initialize and start some service(s).</p>
<p>We may say that every service in GO doesn&rsquo;t implement all its logic. Sometimes it requires other services and relies on them in particular parts of logic.</p>
<p>For example, logging is often delegated to some logger entity, for example zap:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Server</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">logger</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">zap</span>.<span style="color:#a6e22e">Logger</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewServer</span>(<span style="color:#a6e22e">logger</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">zap</span>.<span style="color:#a6e22e">Logger</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">Server</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Server</span>{<span style="color:#a6e22e">logger</span>: <span style="color:#a6e22e">logger</span>}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">s</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Server</span>) <span style="color:#a6e22e">Handle</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// do some work</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">logger</span>.<span style="color:#a6e22e">Info</span>(<span style="color:#e6db74">&#34;request processed&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">logger</span> <span style="color:#f92672">:=</span> <span style="color:#75715e">//... logger initializing</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">NewServer</span>(<span style="color:#a6e22e">logger</span>).<span style="color:#a6e22e">Run</span>() <span style="color:#75715e">// service with logger initializing</span>
</span></span></code></pre></div><p>It is good to reuse code and rely on an entity that does its work well instead of writing your own code.</p>
<p>Currently our Server is not logging by itself, Server relies on logger. In other words, logger became the dependency of Server.
We saved logger as a property of Server. By doing it we injected logger as a dependency.</p>
<h2 id="definition">Definition</h2>
<p>Dependency injection — pattern of composing entities, as a result of which the first (parent) entity is saved to the state of second (dependency) entity. Parent entity can call dependency entity when it is necessary.</p>
<p>Parent state change is important to distinguish dependency injection and external function call.</p>
<p>Without state change the basic &ldquo;hello world&rdquo; program can be mistakenly recognized as dependency injection:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;hello world&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>There is no state in main function, so it is not dependency injection.</p>
<h2 id="issues">Issues</h2>
<p>Why do I discuss dependency injection and which issues can be behind this topic?</p>
<p>Issues can appear in programs that have a large amount of entities having a lot of links between them.
If there are a lot of linked entities, there is a lot of their initialization code. Such code with proper logic structure makes service difficult to support.</p>
<h3 id="service-with-more-dependencies">Service with more dependencies</h3>
<p>Let&rsquo;s imagine that we are developing a service that has to do the following:</p>
<ul>
<li>database interaction;</li>
<li>perform external service calls;</li>
<li>logging;</li>
<li>loading and using config;</li>
</ul>
<p>The service constructor should look like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewService</span>(
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">db</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">sql</span>.<span style="color:#a6e22e">DB</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">bankClient</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Bank</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">cfg</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">Config</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">logger</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">zap</span>.<span style="color:#a6e22e">Logger</span>,
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p>Also, every Service dependency requires its own initialization, that can require other entities. For example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// Getting db connection</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">db</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sql</span>.<span style="color:#a6e22e">Open</span>(<span style="color:#e6db74">&#34;postgres&#34;</span>, <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;host=%s port=%s user=%s dbname=%s sslmode=disable password=%s&#34;</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">configStruct</span>.<span style="color:#a6e22e">DbHost</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">configStruct</span>.<span style="color:#a6e22e">DbPort</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">configStruct</span>.<span style="color:#a6e22e">DbUser</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">configStruct</span>.<span style="color:#a6e22e">DbName</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">configStruct</span>.<span style="color:#a6e22e">DbPass</span>)
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>To create bankClient we need cfg and logger.</p>
<p>Now let&rsquo;s imagine there is a second service needed to be implemented in the same program, that also requires db, cfg, logger as dependencies. Let&rsquo;s visualize the dependencies scheme:</p>
<p><img src="/en/post/dependency-injection/deps2.svg" alt="deps2.svg"></p>
<p>There is a lot of code to initialize the first service, but also we need to initialize the second.</p>
<h3 id="copy-init-code">Copy init code</h3>
<p>We could just copy-paste db, cfg, logger init code for service2.</p>
<p>It will work, but copying code is a bad idea. More code to support, more mistake probability.</p>
<p>Let&rsquo;s check other options.</p>
<h3 id="implement-init-code-for-each-dep">Implement init code for each dep</h3>
<p>For example we can implement db init function:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">GetDB</span>(<span style="color:#a6e22e">cfg</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">Config</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">sql</span>.<span style="color:#a6e22e">DB</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">db</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sql</span>.<span style="color:#a6e22e">Open</span>(<span style="color:#e6db74">&#34;postgres&#34;</span>, <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;host=%s port=%s user=%s dbname=%s sslmode=disable password=%s&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">configStruct</span>.<span style="color:#a6e22e">DbHost</span>, <span style="color:#a6e22e">configStruct</span>.<span style="color:#a6e22e">DbPort</span>, <span style="color:#a6e22e">configStruct</span>.<span style="color:#a6e22e">DbUser</span>, <span style="color:#a6e22e">configStruct</span>.<span style="color:#a6e22e">DbName</span>, <span style="color:#a6e22e">configStruct</span>.<span style="color:#a6e22e">DbPass</span>)
</span></span><span style="display:flex;"><span>	)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">db</span>, <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>It looks good and there will be no duplicate db init code. But we still need to implement that code for each reusable dep.</p>
<p>We still haven&rsquo;t finished with GetDB - it will create a new connection for each call.</p>
<h3 id="singleton">Singleton</h3>
<p>In case of db we need a single instance.</p>
<p>Let&rsquo;s implement it with singleton pattern:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">db</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">db</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">sql</span>.<span style="color:#a6e22e">DB</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">GetDB</span>(<span style="color:#a6e22e">cfg</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">Config</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">sql</span>.<span style="color:#a6e22e">DB</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">db</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">db</span>, <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">db</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">sql</span>.<span style="color:#a6e22e">Open</span>(<span style="color:#e6db74">&#34;postgres&#34;</span>, <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;host=%s port=%s user=%s dbname=%s sslmode=disable password=%s&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">configStruct</span>.<span style="color:#a6e22e">DbHost</span>, <span style="color:#a6e22e">configStruct</span>.<span style="color:#a6e22e">DbPort</span>, <span style="color:#a6e22e">configStruct</span>.<span style="color:#a6e22e">DbUser</span>, <span style="color:#a6e22e">configStruct</span>.<span style="color:#a6e22e">DbName</span>, <span style="color:#a6e22e">configStruct</span>.<span style="color:#a6e22e">DbPass</span>)
</span></span><span style="display:flex;"><span>	)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">db</span>, <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="pool-of-singletons-multiton">Pool of singletons (multiton)</h3>
<p>We can have connections to different database servers, it should be separate connections. But we still need each of them to be singleton. Let&rsquo;s implement pool of singletons — multiton.</p>
<p>On a small number of entities these patterns work well.
But if there are dozens of entity types even that simple code like singleton and multiton are hard to implement. In that case we could use some centralized logic that helps to build entities — dependency injector.</p>
<h2 id="dependency-injection-container-injector">Dependency injection container (injector)</h2>
<p>Using a separate entity to build and store other entities (injector) is pretty common in many programming languages.
Container implements logic about creating each entity, storing and getting.</p>
<p>The focus in the program that uses container is moved from entity and its links to the container that helps to simplify the code.</p>
<p><img src="/en/post/dependency-injection/container.svg" alt="container.svg"></p>
<p>Sometimes container work is so predictable that one can specify dependencies in declarative format — XML, YAML.</p>
<p>In Symfony (PHP) service container is one of the central parts in the framework - even Symfony core components are designed to work with container.
Symfony supports XML and YAML to declare dependencies.</p>
<p>In Spring (JAVA) dependency container can be configured by XML or annotations.</p>
<p>There are several libraries in GO implementing injector differently.</p>
<p>I used some of them and prepared a review about each of them below. There is source code about di libraries interaction in a separate github repository.</p>
<h3 id="uber-godig">uber-go/dig</h3>
<p>dig allows us to configure container by passing anonymous functions and uses reflect package.</p>
<p>One should use Provide method to add entity init function into container.
The function should return the desired entity, or both entity and error.</p>
<p>Let&rsquo;s see how we can create logger that depends on config. (It is almost the original example from dig readme).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">c</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">dig</span>.<span style="color:#a6e22e">New</span>()
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Provide</span>(<span style="color:#66d9ef">func</span>() (<span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// In real program there should be reading from the file, for example</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">cfg</span> <span style="color:#a6e22e">Config</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">Unmarshal</span>([]byte(<span style="color:#e6db74">`{&#34;prefix&#34;: &#34;[foo] &#34;}`</span>), <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">cfg</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">cfg</span>, <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>	panic(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Function to create logger by using config</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Provide</span>(<span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">cfg</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Logger</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">New</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stdout</span>, <span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">Prefix</span>, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>	panic(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>By using reflect package dig analyzes the types of returning value and the types of parameters.
Using that data the links between entities are resolved.</p>
<p>To get entity from container there is Invoke method:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Invoke</span>(<span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">l</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Logger</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">l</span>.<span style="color:#a6e22e">Print</span>(<span style="color:#e6db74">&#34;You&#39;ve been invoked&#34;</span>)
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>	panic(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>On identical entity creation one should pass name parameter when calling Provide. Otherwise Provide will return error.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// creating another logger</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Provide</span>(
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">cfg</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Logger</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">New</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stdout</span>, <span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">Prefix</span>, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>	},
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">dig</span>.<span style="color:#a6e22e">Name</span>(<span style="color:#e6db74">&#34;logger2&#34;</span>), <span style="color:#75715e">// passing name option</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>	panic(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Unfortunately getting named entity is not so simple — there is no name parameter in Invoke function.
In the related github issue developers say that the issue is fixed, but not released yet.
Currently one should use structure with tagged fields to invoke named entities:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">c</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">dig</span>.<span style="color:#a6e22e">New</span>()
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Provide</span>(<span style="color:#a6e22e">username</span>, <span style="color:#a6e22e">dig</span>.<span style="color:#a6e22e">Name</span>(<span style="color:#e6db74">&#34;username&#34;</span>))
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Provide</span>(<span style="color:#a6e22e">password</span>, <span style="color:#a6e22e">dig</span>.<span style="color:#a6e22e">Name</span>(<span style="color:#e6db74">&#34;password&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Invoke</span>(<span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">p</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">dig</span>.<span style="color:#a6e22e">In</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">U</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`name:&#34;username&#34;`</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">P</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`name:&#34;password&#34;`</span>
</span></span><span style="display:flex;"><span>}) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;user &gt;&gt;&gt;&#34;</span>, <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">U</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;pwd  &gt;&gt;&gt;&#34;</span>, <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">P</span>)
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></div><p>dig (and every injector library here) implements lazy loading of entities. Required entities are created only on Invoke call.</p>
<p>We could speak about that reflect is slow, but for container it doesn&rsquo;t matter, because typically container is used once on program start.</p>
<p>As a result: named entities issue should be documented in dig main readme. In other cases it works perfectly as injector.</p>
<h3 id="elliotchancedingo">elliotchance/dingo</h3>
<p>elliotchance/dingo works in a completely different way.
One should specify YAML config in order to generate container&rsquo;s GO-code. Let&rsquo;s continue with logger-config example. Our YAML should look like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">services</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Config</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#e6db74">&#39;*Config&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">error</span>: <span style="color:#ae81ff">return nil</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">returns</span>: <span style="color:#ae81ff">NewConfig()</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Logger</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#e6db74">&#39;*log.Logger&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">import</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#39;os&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">returns</span>: <span style="color:#ae81ff">log.New(os.Stdout, @{Config}.Prefix, 0)</span>
</span></span></code></pre></div><p>To me YAML is not very comfortable to use here. You will see below, that some parts of YAML could be actually the parts of GO code. But to me the GO code is comfortable to be in *.go files — at least the IDE will check go syntax.</p>
<p>For every entity in YAML probably need to specify following:</p>
<ul>
<li>imports — the list of imported libraries;</li>
<li>error — GO code, that should be called on error check;</li>
<li>returns — the part of GO code which will init and return the entity;</li>
</ul>
<p>With returns I couldn&rsquo;t decide: should I add big portion of GO code into the YAML, or should I create constructor function for each entity. Finally I moved all config construction logic to NewConfig function:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewConfig</span>() (<span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">cfg</span> <span style="color:#a6e22e">Config</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">Unmarshal</span>([]byte(<span style="color:#e6db74">`{&#34;prefix&#34;: &#34;[foo] &#34;}`</span>), <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">cfg</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">cfg</span>, <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When the YAML is ready, one should install dingo binary and call it in the project directory — <code>go get -u github.com/elliotchance/dingo; dingo</code>.</p>
<p>Code generation works fast. To me it looks like that the most settings from YAML are just directly copied into generated *.go file. So, generated file could be invalid.
Generated code is placed in file dingo.go. Container is simple structure with fields for every entity with singleton logic:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Container</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Config</span>	<span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Logger</span>	<span style="color:#f92672">*</span><span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Logger</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">container</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Container</span>) <span style="color:#a6e22e">GetLogger</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Logger</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">Logger</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">service</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">New</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stdout</span>, <span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">GetConfig</span>().<span style="color:#a6e22e">Prefix</span>, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">Logger</span> = <span style="color:#a6e22e">service</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">Logger</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>As a result: elliotchance/dingo helps to generate simple typed container from YAML, but putting GO code to YAML makes me feel a little bit uncomfortable.</p>
<h3 id="sarulabsdi">sarulabs/di</h3>
<p>sarulabs/di looks like dig, but doesn&rsquo;t use reflect. All deps in di must have unique names.</p>
<p>The main difference is that in dig we don&rsquo;t have to init dependencies of our entity, even from container — they just come as function parameters.
In di we have to pull dependencies from container:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">builder</span>.<span style="color:#a6e22e">Add</span>(<span style="color:#a6e22e">di</span>.<span style="color:#a6e22e">Def</span>{
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;logger&#34;</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Build</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">ctn</span> <span style="color:#a6e22e">di</span>.<span style="color:#a6e22e">Container</span>) (<span style="color:#66d9ef">interface</span>{}, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// Getting config from container to init logger</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">cfg</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">ctn</span>.<span style="color:#a6e22e">Fill</span>(<span style="color:#e6db74">&#34;config&#34;</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">cfg</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// Init logger</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">New</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stdout</span>, <span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">Prefix</span>, <span style="color:#ae81ff">0</span>), <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></div><p>GO code that gets dependency from container is not big, but it will be copied between entities with similar dependencies.</p>
<p>But also sarulabs/di has a bonus — one can specify not only creation function, but also a container destroy hook function. di container destroy starts with DeleteWithSubContainers call and can be performed on program shutdown.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">Close</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">obj</span> <span style="color:#66d9ef">interface</span>{}) <span style="color:#66d9ef">error</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">obj</span>.(<span style="color:#f92672">*</span><span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Logger</span>); <span style="color:#a6e22e">ok</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;logger close&#34;</span>) <span style="color:#75715e">// this code is called on logger destroy</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>As I mentioned before di doesn&rsquo;t use reflect and also doesn&rsquo;t store any information about entities types, that&rsquo;s why we should use type assertion in Close function to get logger to original type.</p>
<p>There is also a bonus functionality sarulabs/dingo, from the same developer, that also provides strictly typed container and code generation.</p>
<p>As a result: di is great injector, but there is some code copying logic — to get dependency from container.</p>
<p>dig is better here.</p>
<h3 id="googlewire">google/wire</h3>
<p>With wire we have to put construction function template code for each entity. We should place <code>//+build wireinject</code> comment to the beginning of such template files.</p>
<p>Then we should run <code>go get github.com/google/wire/cmd/wire; wire</code> which generates <code>*_gen.go</code> files for each template file. Generated code will contain real constructor functions that are generated from templates.</p>
<p>For our logger-config example the template of logger constructor will look like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">//+build wireinject</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;github.com/google/wire&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Template for generation</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">GetLogger</span>() (<span style="color:#f92672">*</span><span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Logger</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>	panic(<span style="color:#a6e22e">wire</span>.<span style="color:#a6e22e">Build</span>(<span style="color:#a6e22e">NewLogger</span>, <span style="color:#a6e22e">NewConfig</span>))
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Generated code is put into <code>*_gen.go</code> and looks like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Injectors from wire.go:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">GetLogger</span>() (<span style="color:#f92672">*</span><span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Logger</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">config</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">NewConfig</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">logger</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">NewLogger</span>(<span style="color:#a6e22e">config</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">logger</span>, <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>As in elliotchance/dingo there is code generation in wire. But I didn&rsquo;t manage to generate invalid GO code. In every invalid template situation wire outputs the errors and code is not generated.</p>
<p>There is one minus in wire — we have to implement constructor template by using wire package calls. And these calls are not so expressive as GO code. So I also move all constructor logic to the constructor functions to just call these constructor functions from templates.</p>
<h2 id="comparison-table">Comparison table</h2>
<table>
  <thead>
      <tr>
          <th>Library</th>
          <th>Dependencies format</th>
          <th>GO code generation</th>
          <th>Typing</th>
          <th>Code reduction</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>uber-go/dig</td>
          <td>GO code, anonymous functions with parameters</td>
          <td>No</td>
          <td>Strict, but also reflect is used</td>
          <td>Maximum</td>
      </tr>
      <tr>
          <td>elliotchance/dingo</td>
          <td>YAML</td>
          <td>Yes</td>
          <td>Strict</td>
          <td>Maximum, but there is mixing of GO code in YAML</td>
      </tr>
      <tr>
          <td>sarulabs/di</td>
          <td>GO code, declaration of Build functions with manual parameters getting</td>
          <td>No, but sarulabs/dingo allows that</td>
          <td>All deps are stored as interface{}. But sarulabs/dingo offers strictly typed container</td>
          <td>Good, but we have to get deps from container</td>
      </tr>
      <tr>
          <td>google/wire</td>
          <td>GO code — templates of constructor functions</td>
          <td>Yes</td>
          <td>Strict</td>
          <td>Maximum</td>
      </tr>
  </tbody>
</table>
    
  <div>
    <div>Tags:</div>
    <ul>
        <li><a href="/tags/dependency/">Dependency</a></li>
        <li><a href="/tags/injection/">Injection</a></li>
        <li><a href="/tags/container/">Container</a></li>
        <li><a href="/tags/singleton/">Singleton</a></li>
        <li><a href="/tags/multiton/">Multiton</a></li>
    </ul>
  </div>

    </div>
    
<div id="article-quiz" class="mt-5 mb-5" data-quiz-lang="en">
  <hr class="mb-4">
  <h3 class="mb-4">Test Your Knowledge</h3>
  
  <form id="quiz-form" data-quiz-data="{&#34;questions&#34;:[{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;A pattern where a parent entity stores a dependency entity in its state&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;A function call pattern&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;A database connection pattern&#34;}],&#34;question&#34;:&#34;What is dependency injection?&#34;,&#34;type&#34;:&#34;single-choice&#34;},{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;Singleton pattern&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;Factory pattern&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;Builder pattern&#34;}],&#34;question&#34;:&#34;What pattern is used when you need a single instance of a dependency?&#34;,&#34;type&#34;:&#34;single-choice&#34;},{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;uber-go/dig&#34;},{&#34;correct&#34;:true,&#34;text&#34;:&#34;google/wire&#34;},{&#34;correct&#34;:true,&#34;text&#34;:&#34;sarulabs/di&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;golang/di&#34;}],&#34;question&#34;:&#34;What libraries are mentioned for dependency injection in Go?&#34;,&#34;type&#34;:&#34;multiple-choice&#34;},{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;reflect package&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;types package&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;inject package&#34;}],&#34;question&#34;:&#34;What package does dig use to analyze function parameters and return types?&#34;,&#34;type&#34;:&#34;single-choice&#34;},{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;Pool of singletons - multiple separate singletons for different instances of the same type&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;Multiple inheritance&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;Pattern for creating multiple objects&#34;}],&#34;question&#34;:&#34;What is the multiton pattern?&#34;,&#34;type&#34;:&#34;single-choice&#34;},{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;A lot of initialization code&#34;},{&#34;correct&#34;:true,&#34;text&#34;:&#34;Service maintenance difficulty&#34;},{&#34;correct&#34;:true,&#34;text&#34;:&#34;Duplication of initialization code&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;Increased program execution speed&#34;}],&#34;question&#34;:&#34;What problems arise with a large number of dependencies in a program?&#34;,&#34;type&#34;:&#34;multiple-choice&#34;},{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;Invoke&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;Get&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;Retrieve&#34;}],&#34;question&#34;:&#34;What method is used in dig to get an entity from the container?&#34;,&#34;type&#34;:&#34;single-choice&#34;},{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;Provide&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;Add&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;Register&#34;}],&#34;question&#34;:&#34;What method is used in dig to add an entity initialization function to the container?&#34;,&#34;type&#34;:&#34;single-choice&#34;},{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;Entities are created only when Invoke is called&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;Entities are created immediately when added to container&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;Entities are created at program startup&#34;}],&#34;question&#34;:&#34;How does lazy loading of entities work in dependency containers?&#34;,&#34;type&#34;:&#34;single-choice&#34;},{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;elliotchance/dingo&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;uber-go/dig&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;sarulabs/di&#34;}],&#34;question&#34;:&#34;Which library uses GO code generation from YAML configuration?&#34;,&#34;type&#34;:&#34;single-choice&#34;},{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;google/wire&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;uber-go/dig&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;sarulabs/di&#34;}],&#34;question&#34;:&#34;Which library uses GO code generation from constructor function templates?&#34;,&#34;type&#34;:&#34;single-choice&#34;},{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;di doesn&#39;t use reflect&#34;},{&#34;correct&#34;:true,&#34;text&#34;:&#34;di requires manual dependency retrieval from container&#34;},{&#34;correct&#34;:true,&#34;text&#34;:&#34;di supports destroy hook functions&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;di uses reflect for type analysis&#34;}],&#34;question&#34;:&#34;What is the difference between sarulabs/di and uber-go/dig?&#34;,&#34;type&#34;:&#34;multiple-choice&#34;},{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;It distinguishes dependency injection from external function call&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;It increases performance&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;It&#39;s required for container to work&#34;}],&#34;question&#34;:&#34;Why is changing the parent entity state important for defining dependency injection?&#34;,&#34;type&#34;:&#34;single-choice&#34;},{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;Name parameter is passed when calling Provide&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;Separate CreateNamed method is used&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;It&#39;s impossible in dig&#34;}],&#34;question&#34;:&#34;How are identical entities of the same type created in dig?&#34;,&#34;type&#34;:&#34;single-choice&#34;},{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;Simplification of initialization code&#34;},{&#34;correct&#34;:true,&#34;text&#34;:&#34;Centralized dependency management&#34;},{&#34;correct&#34;:true,&#34;text&#34;:&#34;Automatic dependency resolution&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;Increased program execution time&#34;}],&#34;question&#34;:&#34;What advantages does using a dependency injection container provide?&#34;,&#34;type&#34;:&#34;multiple-choice&#34;}]}">
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="0">
      <h5 class="mb-3">1. What is dependency injection?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-0" 
                 value="0"
                 id="q0-a0">
          <label class="form-check-label" for="q0-a0">
            A pattern where a parent entity stores a dependency entity in its state
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-0" 
                 value="1"
                 id="q0-a1">
          <label class="form-check-label" for="q0-a1">
            A function call pattern
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-0" 
                 value="2"
                 id="q0-a2">
          <label class="form-check-label" for="q0-a2">
            A database connection pattern
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="1">
      <h5 class="mb-3">2. What pattern is used when you need a single instance of a dependency?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-1" 
                 value="0"
                 id="q1-a0">
          <label class="form-check-label" for="q1-a0">
            Singleton pattern
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-1" 
                 value="1"
                 id="q1-a1">
          <label class="form-check-label" for="q1-a1">
            Factory pattern
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-1" 
                 value="2"
                 id="q1-a2">
          <label class="form-check-label" for="q1-a2">
            Builder pattern
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="2">
      <h5 class="mb-3">3. What libraries are mentioned for dependency injection in Go?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-2" 
                 value="0"
                 id="q2-a0">
          <label class="form-check-label" for="q2-a0">
            uber-go/dig
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-2" 
                 value="1"
                 id="q2-a1">
          <label class="form-check-label" for="q2-a1">
            google/wire
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-2" 
                 value="2"
                 id="q2-a2">
          <label class="form-check-label" for="q2-a2">
            sarulabs/di
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-2" 
                 value="3"
                 id="q2-a3">
          <label class="form-check-label" for="q2-a3">
            golang/di
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="3">
      <h5 class="mb-3">4. What package does dig use to analyze function parameters and return types?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-3" 
                 value="0"
                 id="q3-a0">
          <label class="form-check-label" for="q3-a0">
            reflect package
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-3" 
                 value="1"
                 id="q3-a1">
          <label class="form-check-label" for="q3-a1">
            types package
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-3" 
                 value="2"
                 id="q3-a2">
          <label class="form-check-label" for="q3-a2">
            inject package
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="4">
      <h5 class="mb-3">5. What is the multiton pattern?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-4" 
                 value="0"
                 id="q4-a0">
          <label class="form-check-label" for="q4-a0">
            Pool of singletons - multiple separate singletons for different instances of the same type
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-4" 
                 value="1"
                 id="q4-a1">
          <label class="form-check-label" for="q4-a1">
            Multiple inheritance
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-4" 
                 value="2"
                 id="q4-a2">
          <label class="form-check-label" for="q4-a2">
            Pattern for creating multiple objects
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="5">
      <h5 class="mb-3">6. What problems arise with a large number of dependencies in a program?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-5" 
                 value="0"
                 id="q5-a0">
          <label class="form-check-label" for="q5-a0">
            A lot of initialization code
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-5" 
                 value="1"
                 id="q5-a1">
          <label class="form-check-label" for="q5-a1">
            Service maintenance difficulty
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-5" 
                 value="2"
                 id="q5-a2">
          <label class="form-check-label" for="q5-a2">
            Duplication of initialization code
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-5" 
                 value="3"
                 id="q5-a3">
          <label class="form-check-label" for="q5-a3">
            Increased program execution speed
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="6">
      <h5 class="mb-3">7. What method is used in dig to get an entity from the container?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-6" 
                 value="0"
                 id="q6-a0">
          <label class="form-check-label" for="q6-a0">
            Invoke
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-6" 
                 value="1"
                 id="q6-a1">
          <label class="form-check-label" for="q6-a1">
            Get
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-6" 
                 value="2"
                 id="q6-a2">
          <label class="form-check-label" for="q6-a2">
            Retrieve
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="7">
      <h5 class="mb-3">8. What method is used in dig to add an entity initialization function to the container?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-7" 
                 value="0"
                 id="q7-a0">
          <label class="form-check-label" for="q7-a0">
            Provide
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-7" 
                 value="1"
                 id="q7-a1">
          <label class="form-check-label" for="q7-a1">
            Add
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-7" 
                 value="2"
                 id="q7-a2">
          <label class="form-check-label" for="q7-a2">
            Register
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="8">
      <h5 class="mb-3">9. How does lazy loading of entities work in dependency containers?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-8" 
                 value="0"
                 id="q8-a0">
          <label class="form-check-label" for="q8-a0">
            Entities are created only when Invoke is called
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-8" 
                 value="1"
                 id="q8-a1">
          <label class="form-check-label" for="q8-a1">
            Entities are created immediately when added to container
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-8" 
                 value="2"
                 id="q8-a2">
          <label class="form-check-label" for="q8-a2">
            Entities are created at program startup
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="9">
      <h5 class="mb-3">10. Which library uses GO code generation from YAML configuration?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-9" 
                 value="0"
                 id="q9-a0">
          <label class="form-check-label" for="q9-a0">
            elliotchance/dingo
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-9" 
                 value="1"
                 id="q9-a1">
          <label class="form-check-label" for="q9-a1">
            uber-go/dig
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-9" 
                 value="2"
                 id="q9-a2">
          <label class="form-check-label" for="q9-a2">
            sarulabs/di
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="10">
      <h5 class="mb-3">11. Which library uses GO code generation from constructor function templates?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-10" 
                 value="0"
                 id="q10-a0">
          <label class="form-check-label" for="q10-a0">
            google/wire
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-10" 
                 value="1"
                 id="q10-a1">
          <label class="form-check-label" for="q10-a1">
            uber-go/dig
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-10" 
                 value="2"
                 id="q10-a2">
          <label class="form-check-label" for="q10-a2">
            sarulabs/di
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="11">
      <h5 class="mb-3">12. What is the difference between sarulabs/di and uber-go/dig?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-11" 
                 value="0"
                 id="q11-a0">
          <label class="form-check-label" for="q11-a0">
            di doesn&#39;t use reflect
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-11" 
                 value="1"
                 id="q11-a1">
          <label class="form-check-label" for="q11-a1">
            di requires manual dependency retrieval from container
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-11" 
                 value="2"
                 id="q11-a2">
          <label class="form-check-label" for="q11-a2">
            di supports destroy hook functions
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-11" 
                 value="3"
                 id="q11-a3">
          <label class="form-check-label" for="q11-a3">
            di uses reflect for type analysis
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="12">
      <h5 class="mb-3">13. Why is changing the parent entity state important for defining dependency injection?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-12" 
                 value="0"
                 id="q12-a0">
          <label class="form-check-label" for="q12-a0">
            It distinguishes dependency injection from external function call
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-12" 
                 value="1"
                 id="q12-a1">
          <label class="form-check-label" for="q12-a1">
            It increases performance
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-12" 
                 value="2"
                 id="q12-a2">
          <label class="form-check-label" for="q12-a2">
            It&#39;s required for container to work
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="13">
      <h5 class="mb-3">14. How are identical entities of the same type created in dig?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-13" 
                 value="0"
                 id="q13-a0">
          <label class="form-check-label" for="q13-a0">
            Name parameter is passed when calling Provide
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-13" 
                 value="1"
                 id="q13-a1">
          <label class="form-check-label" for="q13-a1">
            Separate CreateNamed method is used
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-13" 
                 value="2"
                 id="q13-a2">
          <label class="form-check-label" for="q13-a2">
            It&#39;s impossible in dig
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="14">
      <h5 class="mb-3">15. What advantages does using a dependency injection container provide?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-14" 
                 value="0"
                 id="q14-a0">
          <label class="form-check-label" for="q14-a0">
            Simplification of initialization code
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-14" 
                 value="1"
                 id="q14-a1">
          <label class="form-check-label" for="q14-a1">
            Centralized dependency management
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-14" 
                 value="2"
                 id="q14-a2">
          <label class="form-check-label" for="q14-a2">
            Automatic dependency resolution
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-14" 
                 value="3"
                 id="q14-a3">
          <label class="form-check-label" for="q14-a3">
            Increased program execution time
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    
    <button type="button" class="btn btn-primary" id="check-answers">
      Check Answers
    </button>
    <button type="button" class="btn btn-secondary ml-2" id="reset-quiz" style="display: none;">
      Reset
    </button>
  </form>
  
  <div id="quiz-results" class="mt-4" style="display: none;">
    <div class="alert" role="alert"></div>
  </div>
</div>

<script>
(function() {
  try {
    const quizContainer = document.getElementById('article-quiz');
    const form = document.getElementById('quiz-form');
    const checkBtn = document.getElementById('check-answers');
    const resetBtn = document.getElementById('reset-quiz');
    const resultsDiv = document.getElementById('quiz-results');
    
    if (!quizContainer || !form || !checkBtn) {
      console.error('Quiz initialization failed: missing elements', {
        quizContainer: !!quizContainer,
        form: !!form,
        checkBtn: !!checkBtn
      });
      return;
    }
    
    const lang = quizContainer.getAttribute('data-quiz-lang') || 'en';
    const quizDataRaw = form.getAttribute('data-quiz-data');
    
    if (!quizDataRaw) {
      console.error('Quiz data not found in data attribute');
      return;
    }
    
    let quizData;
    try {
      quizData = JSON.parse(quizDataRaw);
    } catch (e) {
      console.error('Failed to parse quiz data:', e, quizDataRaw);
      return;
    }
    
    if (!quizData || !quizData.questions || !Array.isArray(quizData.questions)) {
      console.error('Invalid quiz data structure:', quizData);
      return;
    }
    
    
    console.log('Quiz data loaded:', quizData);
  
    function arraysEqual(a, b) {
      if (!a || !b) return false;
      if (a.length !== b.length) return false;
      const sortedA = [...a].sort();
      const sortedB = [...b].sort();
      return sortedA.every((val, i) => val === sortedB[i]);
    }
    
    checkBtn.addEventListener('click', function() {
    if (!quizData.questions || !Array.isArray(quizData.questions)) {
      console.error('Invalid quiz data structure');
      return;
    }
    
    let correctCount = 0;
    let totalQuestions = quizData.questions.length;
    
    quizData.questions.forEach((question, qIndex) => {
      const questionDiv = form.querySelector(`[data-question-index="${qIndex}"]`);
      if (!questionDiv) {
        console.error('Question div not found for index:', qIndex);
        return;
      }
      
      const feedbackDiv = questionDiv.querySelector('.quiz-feedback');
      if (!feedbackDiv) {
        console.error('Feedback div not found for question:', qIndex);
        return;
      }
      
      if (question.type === 'multiple-choice' || question.type === 'single-choice') {
        if (!question.answers || !Array.isArray(question.answers)) {
          console.error('Invalid answers for question:', qIndex);
          return;
        }
        
        const inputs = questionDiv.querySelectorAll(`input[name="question-${qIndex}"]`);
        const selectedAnswers = Array.from(inputs)
          .filter(input => input.checked)
          .map(input => parseInt(input.value));
        
        const correctAnswers = question.answers
          .map((answer, index) => answer.correct === true ? index : -1)
          .filter(index => index !== -1);
        
        const isCorrect = arraysEqual(selectedAnswers, correctAnswers);
        
        if (isCorrect) {
          correctCount++;
          feedbackDiv.innerHTML = '<span class="text-success">✓ ' + (lang === 'ru' ? 'Правильно!' : 'Correct!') + '</span>';
          feedbackDiv.style.display = 'block';
          inputs.forEach(input => {
            const answerIndex = parseInt(input.value);
            const answer = question.answers[answerIndex];
            if (!answer) return;
            
            if (input.checked && answer.correct === true) {
              input.parentElement.classList.add('text-success');
            } else if (input.checked && answer.correct !== true) {
              input.parentElement.classList.add('text-danger');
            } else if (!input.checked && answer.correct === true) {
              input.parentElement.classList.add('text-warning');
            }
          });
        } else {
          feedbackDiv.innerHTML = '<span class="text-danger">✗ ' + (lang === 'ru' ? 'Неправильно' : 'Incorrect') + '</span>';
          feedbackDiv.style.display = 'block';
          inputs.forEach(input => {
            const answerIndex = parseInt(input.value);
            const answer = question.answers[answerIndex];
            if (!answer) return;
            
            if (input.checked && answer.correct !== true) {
              input.parentElement.classList.add('text-danger');
            } else if (!input.checked && answer.correct === true) {
              input.parentElement.classList.add('text-warning');
            }
          });
        }
      } else if (question.type === 'text') {
        const textarea = questionDiv.querySelector('textarea');
        const correctAnswerDiv = questionDiv.querySelector('[data-correct-answer]');
        
        if (!textarea || !question.correct_answer) {
          console.error('Invalid text question:', qIndex);
          return;
        }
        
        if (textarea.value.trim().toLowerCase() === question.correct_answer.toLowerCase()) {
          correctCount++;
          feedbackDiv.innerHTML = '<span class="text-success">✓ ' + (lang === 'ru' ? 'Правильно!' : 'Correct!') + '</span>';
          feedbackDiv.style.display = 'block';
        } else {
          feedbackDiv.innerHTML = '<span class="text-danger">✗ ' + (lang === 'ru' ? 'Неправильно' : 'Incorrect') + '</span>';
          feedbackDiv.style.display = 'block';
          if (correctAnswerDiv) {
            correctAnswerDiv.style.display = 'block';
          }
        }
      }
    });
    
    const percentage = Math.round((correctCount / totalQuestions) * 100);
    const alertClass = percentage >= 70 ? 'alert-success' : percentage >= 50 ? 'alert-warning' : 'alert-danger';
    const message = (lang === 'ru' ? 'Вы ответили правильно на ' : 'You got ') + 
                   correctCount + (lang === 'ru' ? ' из ' : ' out of ') + 
                   totalQuestions + (lang === 'ru' ? ' вопросов (' : ' questions (') + 
                   percentage + '%)';
    
    const alertElement = resultsDiv.querySelector('.alert');
    if (alertElement) {
      alertElement.className = 'alert ' + alertClass;
      alertElement.textContent = message;
    }
      resultsDiv.style.display = 'block';
      checkBtn.style.display = 'none';
      if (resetBtn) {
        resetBtn.style.display = 'inline-block';
      }
    });
    
    if (resetBtn) {
      resetBtn.addEventListener('click', function() {
        form.reset();
        form.querySelectorAll('.quiz-feedback').forEach(el => el.style.display = 'none');
        form.querySelectorAll('.text-success, .text-danger, .text-warning').forEach(el => {
          el.classList.remove('text-success', 'text-danger', 'text-warning');
        });
        form.querySelectorAll('[data-correct-answer]').forEach(el => el.style.display = 'none');
        resultsDiv.style.display = 'none';
        checkBtn.style.display = 'inline-block';
        resetBtn.style.display = 'none';
      });
    }
  } catch (error) {
    console.error('Quiz script error:', error);
  }
})();
</script>



    


    <script defer src="/discuss.js"></script>
    <div id="discuss"></div>
</div>

</div>

<div class="bg-light">&nbsp;</div>

<footer>
    <div class="container " style="padding-top: 0; padding-bottom: 10px;">
    <div class="container">
        <img src="/niz.svg" alt="gopher legs" style="height: 50px; vertical-align: top;"/>
        <div style="text-align: right; vertical-align: top; display: inline-block;">
            
            &nbsp;
            &nbsp;
            &nbsp;
            
            
            <a href='/ru/post/dependency-injection.html'>
            <span class="flag-icon flag-icon-ru"></span>
            </a>
            
        </div>

    </div>
</div>

</footer>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script defer src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

</body>
</html>
