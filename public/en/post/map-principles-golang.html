

<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=51376&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="content-type" content="text/html; charset=utf-8" />

<title>Principles of map type in GO | Golang for all</title>




  






  
  
    
  








  



<meta name="description" content="The map programming interface in Go is described in the Go blog. We just need to recall that a map is a key-value storage and it should retrieve values by key …">


<meta property="og:type" content="article">
<meta property="og:url" content="http://localhost:51376/en/post/map-principles-golang.html">
<meta property="og:title" content="Principles of map type in GO | Golang for all">
<meta property="og:description" content="The map programming interface in Go is described in the Go blog. We just need to recall that a map is a key-value storage and it should retrieve values by key …">
<meta property="og:image" content="http://localhost:51376/en/post/map-principles-golang/map.svg">
<meta property="og:site_name" content="Golang for all">
<meta property="og:locale" content="en">

  
    <meta property="article:published_time" content="2020-04-02T09:00:00&#43;03:00">
  
  
    <meta property="article:modified_time" content="2020-04-02T09:00:00&#43;03:00">
  
  
    
      <meta property="article:tag" content="Map">
    
      <meta property="article:tag" content="Sources">
    
  



<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:url" content="http://localhost:51376/en/post/map-principles-golang.html">
<meta name="twitter:title" content="Principles of map type in GO | Golang for all">
<meta name="twitter:description" content="The map programming interface in Go is described in the Go blog. We just need to recall that a map is a key-value storage and it should retrieve values by key …">
<meta name="twitter:image" content="http://localhost:51376/en/post/map-principles-golang/map.svg">



<link rel="canonical" href="http://localhost:51376/en/post/map-principles-golang.html">



  <link rel="alternate" hreflang="ru" href="http://localhost:51376/ru/post/map-principles-golang.html">


<meta name="yandex-verification" content="10233a4b32f4dc29" />
<meta name="yandex-verification" content="cfa4be404c1af368" />

<link rel="icon" type="image/png" sizes="93x93" href="/gophereye.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="/gophereye32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/gophereye16x16.png">


    <link rel="stylesheet" href="/css/main.css">


      <script src="/js/main.js"></script>


<link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.4.6/css/flag-icon.min.css" integrity="sha256-YjcCvXkdRVOucibC9I4mBS41lXPrWfqY2BnpskhZPnw=" crossorigin="anonymous" />


</head>
<body>
<div class="container">
    <nav class="navbar navbar-expand-lg navbar-light" style="padding-bottom: 0;">
        <div class="container">
            <a class="navbar-brand" href="/en/" style="padding-bottom: 0">
                <img src="/verh.svg" alt="gopher eyes" style="height: 50px;"/>
            </a>

            <button class="navbar-toggler" type="button"
                    data-toggle="collapse"
                    data-target="#navbarResponsive"
                    aria-controls="navbarResponsive"
                    aria-expanded="false"
                    aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <a href="/en/" style="color:#000;"><span class="gopherchat">Golang for all</span></a>
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="/en/about.html">About</a>
                    </li>
                    
                </ul>
            </div>
        </div>
    </nav>
</div>
<div class="bg-light">&nbsp;</div>

<div class="container">
    
<div class="col-lg-12">
    
    <h1 class="mt-4">Principles of map type in GO</h1>

    
    <p>


  April 2, 2020



            <a href="/tags/map/" class="badge">Map</a>
            <a href="/tags/sources/" class="badge">Sources</a>
    </p>

    <hr/>

    
    
    
    <div class="container">
        <div class="row mx-0 my-0">
            <div class="col-md-8">
                <img class="img-fluid rounded"
                     style="max-height: 400px;"
                     src="/en/post/map-principles-golang/map.svg"
                     alt="Principles of map type in GO"/>
            </div>
            <div class="col-md-4">
                
                
                <nav id="toc">
                    <h5>Contents</h5>
                    <nav id="TableOfContents">
  <ul>
    <li><a href="#implementation">Implementation</a></li>
    <li><a href="#getting-data-from-map">Getting Data from Map</a></li>
    <li><a href="#map-growing">Map Growing</a></li>
  </ul>
</nav>
                </nav>
                
            </div>
        </div>
    </div>
    <hr>
    
    

    <div id="post-content">
    <p>The map programming interface in Go is described in the Go blog. We just need to recall that a map is a key-value storage and it should retrieve values by key as fast as possible.</p>
<p>Any comparable type can be a key — all simple scalar types, channels, and arrays.
Non-comparable types include slices, maps, and functions.</p>
<p>Map keys and values should be stored in memory allocated for the map, consecutively. To deal with memory addresses, we should use a hash function.</p>
<p>We have the following requirements for a hash function:</p>
<ul>
<li><strong>Deterministic</strong> — should return the same value for the same key</li>
<li><strong>Uniform</strong> — values should be somehow equally related to all buckets</li>
<li><strong>Fast</strong> — should run quickly to be used many times</li>
</ul>
<h2 id="implementation">Implementation</h2>
<p>Now to the implementation. The simplified map structure is below (from sources):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// A header for a Go map.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">hmap</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">count</span>      <span style="color:#66d9ef">int</span> <span style="color:#75715e">// # live cells == size of map.  Must be first (used by len() builtin)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">B</span>          <span style="color:#66d9ef">uint8</span>  <span style="color:#75715e">// log_2 of # of buckets (can hold up to loadFactor * 2^B items)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">buckets</span>    <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span> <span style="color:#75715e">// array of 2^B Buckets. may be nil if count==0.</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">oldbuckets</span> <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span> <span style="color:#75715e">// previous bucket array of half the size, non-nil only when growing</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Data addresses are stored divided into parts — in the buckets array.</p>
<p><code>unsafe.Pointer</code> — can be a pointer of any variable type — a generics issue solution (Go developers use it to make keys and values of any type).</p>
<p>Buckets is nil if there is no data in the map. On the first key, 8 buckets are added.</p>
<h2 id="getting-data-from-map">Getting Data from Map</h2>
<p>We need to find the memory address of the key and value.</p>
<p>First, to find the bucket. It is selected by a comparison of the first 8 bits of the key hash with corresponding data stored in the bucket struct.</p>
<p>Next, to find the key value by its address:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">k</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>(<span style="color:#a6e22e">b</span>), <span style="color:#a6e22e">dataOffset</span><span style="color:#f92672">+</span><span style="color:#a6e22e">i</span><span style="color:#f92672">*</span>uintptr(<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">keysize</span>))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">indirectkey</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">k</span> = <span style="color:#f92672">*</span>((<span style="color:#f92672">*</span><span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>)(<span style="color:#a6e22e">k</span>))
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Next, to find the value the same way:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">key</span>.<span style="color:#a6e22e">equal</span>(<span style="color:#a6e22e">key</span>, <span style="color:#a6e22e">k</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">e</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>(<span style="color:#a6e22e">b</span>), <span style="color:#a6e22e">dataOffset</span><span style="color:#f92672">+</span><span style="color:#a6e22e">bucketCnt</span><span style="color:#f92672">*</span>uintptr(<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">keysize</span>)<span style="color:#f92672">+</span><span style="color:#a6e22e">i</span><span style="color:#f92672">*</span>uintptr(<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">elemsize</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">indirectelem</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">e</span> = <span style="color:#f92672">*</span>((<span style="color:#f92672">*</span><span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>)(<span style="color:#a6e22e">e</span>))
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">e</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="map-growing">Map Growing</h2>
<p>We work with the <code>oldbuckets</code> map struct property during data migration.</p>
<p>Migration starts when there is too much data in buckets. We save the current value of buckets to oldbuckets, then create a doubled amount of buckets in the buckets property. Map data is copied from oldbuckets to buckets.</p>
<p>The amount of buckets is always a power of 2.
That&rsquo;s why there is a B property — it is the power of 2 that shows the current number of buckets.</p>
<p>During migration, the map is accessible. That&rsquo;s why there is a lot of work with both buckets and oldbuckets in the same functions of the source code. After migration, oldbuckets is set to nil.</p>
<p>During migration, the address of data can change, so Go doesn&rsquo;t allow getting a pointer to a map value:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">mymap</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;1&#34;</span>: <span style="color:#e6db74">&#34;1&#34;</span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">mymap</span>[<span style="color:#e6db74">&#34;1&#34;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// cannot take the address of mymap[&#34;1&#34;]</span>
</span></span></code></pre></div><p>The great GopherCon 2016 related lecture:</p>
    
  <div>
    <div>Tags:</div>
    <ul>
        <li><a href="/tags/map/">Map</a></li>
        <li><a href="/tags/sources/">Sources</a></li>
    </ul>
  </div>

    </div>
    
<div id="article-quiz" class="mt-5 mb-5" data-quiz-lang="en">
  <hr class="mb-4">
  <h3 class="mb-4">Test Your Knowledge</h3>
  
  <form id="quiz-form" data-quiz-data="{&#34;questions&#34;:[{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;Comparable types like simple scalar types&#34;},{&#34;correct&#34;:true,&#34;text&#34;:&#34;Channels&#34;},{&#34;correct&#34;:true,&#34;text&#34;:&#34;Arrays&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;Slices&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;Maps&#34;}],&#34;question&#34;:&#34;What types can be used as map keys in Go?&#34;,&#34;type&#34;:&#34;multiple-choice&#34;},{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;Deterministic&#34;},{&#34;correct&#34;:true,&#34;text&#34;:&#34;Uniform distribution&#34;},{&#34;correct&#34;:true,&#34;text&#34;:&#34;Fast execution&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;Cryptographically secure&#34;}],&#34;question&#34;:&#34;What are the requirements for a hash function used in Go maps?&#34;,&#34;type&#34;:&#34;multiple-choice&#34;},{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;8 buckets&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;1 bucket&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;16 buckets&#34;}],&#34;question&#34;:&#34;How many buckets are added when the first key is inserted into an empty map?&#34;,&#34;type&#34;:&#34;single-choice&#34;},{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;During map growth, data addresses can change&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;Map values are immutable&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;It&#39;s a language design limitation&#34;}],&#34;question&#34;:&#34;Why doesn&#39;t Go allow taking the address of a map value?&#34;,&#34;type&#34;:&#34;single-choice&#34;}]}">
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="0">
      <h5 class="mb-3">1. What types can be used as map keys in Go?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-0" 
                 value="0"
                 id="q0-a0">
          <label class="form-check-label" for="q0-a0">
            Comparable types like simple scalar types
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-0" 
                 value="1"
                 id="q0-a1">
          <label class="form-check-label" for="q0-a1">
            Channels
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-0" 
                 value="2"
                 id="q0-a2">
          <label class="form-check-label" for="q0-a2">
            Arrays
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-0" 
                 value="3"
                 id="q0-a3">
          <label class="form-check-label" for="q0-a3">
            Slices
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-0" 
                 value="4"
                 id="q0-a4">
          <label class="form-check-label" for="q0-a4">
            Maps
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="1">
      <h5 class="mb-3">2. What are the requirements for a hash function used in Go maps?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-1" 
                 value="0"
                 id="q1-a0">
          <label class="form-check-label" for="q1-a0">
            Deterministic
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-1" 
                 value="1"
                 id="q1-a1">
          <label class="form-check-label" for="q1-a1">
            Uniform distribution
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-1" 
                 value="2"
                 id="q1-a2">
          <label class="form-check-label" for="q1-a2">
            Fast execution
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-1" 
                 value="3"
                 id="q1-a3">
          <label class="form-check-label" for="q1-a3">
            Cryptographically secure
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="2">
      <h5 class="mb-3">3. How many buckets are added when the first key is inserted into an empty map?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-2" 
                 value="0"
                 id="q2-a0">
          <label class="form-check-label" for="q2-a0">
            8 buckets
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-2" 
                 value="1"
                 id="q2-a1">
          <label class="form-check-label" for="q2-a1">
            1 bucket
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-2" 
                 value="2"
                 id="q2-a2">
          <label class="form-check-label" for="q2-a2">
            16 buckets
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="3">
      <h5 class="mb-3">4. Why doesn&#39;t Go allow taking the address of a map value?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-3" 
                 value="0"
                 id="q3-a0">
          <label class="form-check-label" for="q3-a0">
            During map growth, data addresses can change
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-3" 
                 value="1"
                 id="q3-a1">
          <label class="form-check-label" for="q3-a1">
            Map values are immutable
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-3" 
                 value="2"
                 id="q3-a2">
          <label class="form-check-label" for="q3-a2">
            It&#39;s a language design limitation
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    
    <button type="button" class="btn btn-primary" id="check-answers">
      Check Answers
    </button>
    <button type="button" class="btn btn-secondary ml-2" id="reset-quiz" style="display: none;">
      Reset
    </button>
  </form>
  
  <div id="quiz-results" class="mt-4" style="display: none;">
    <div class="alert" role="alert"></div>
  </div>
</div>

<script>
(function() {
  try {
    const quizContainer = document.getElementById('article-quiz');
    const form = document.getElementById('quiz-form');
    const checkBtn = document.getElementById('check-answers');
    const resetBtn = document.getElementById('reset-quiz');
    const resultsDiv = document.getElementById('quiz-results');
    
    if (!quizContainer || !form || !checkBtn) {
      console.error('Quiz initialization failed: missing elements', {
        quizContainer: !!quizContainer,
        form: !!form,
        checkBtn: !!checkBtn
      });
      return;
    }
    
    const lang = quizContainer.getAttribute('data-quiz-lang') || 'en';
    const quizDataRaw = form.getAttribute('data-quiz-data');
    
    if (!quizDataRaw) {
      console.error('Quiz data not found in data attribute');
      return;
    }
    
    let quizData;
    try {
      quizData = JSON.parse(quizDataRaw);
    } catch (e) {
      console.error('Failed to parse quiz data:', e, quizDataRaw);
      return;
    }
    
    if (!quizData || !quizData.questions || !Array.isArray(quizData.questions)) {
      console.error('Invalid quiz data structure:', quizData);
      return;
    }
    
    
    console.log('Quiz data loaded:', quizData);
  
    function arraysEqual(a, b) {
      if (!a || !b) return false;
      if (a.length !== b.length) return false;
      const sortedA = [...a].sort();
      const sortedB = [...b].sort();
      return sortedA.every((val, i) => val === sortedB[i]);
    }
    
    checkBtn.addEventListener('click', function() {
    if (!quizData.questions || !Array.isArray(quizData.questions)) {
      console.error('Invalid quiz data structure');
      return;
    }
    
    let correctCount = 0;
    let totalQuestions = quizData.questions.length;
    
    quizData.questions.forEach((question, qIndex) => {
      const questionDiv = form.querySelector(`[data-question-index="${qIndex}"]`);
      if (!questionDiv) {
        console.error('Question div not found for index:', qIndex);
        return;
      }
      
      const feedbackDiv = questionDiv.querySelector('.quiz-feedback');
      if (!feedbackDiv) {
        console.error('Feedback div not found for question:', qIndex);
        return;
      }
      
      if (question.type === 'multiple-choice' || question.type === 'single-choice') {
        if (!question.answers || !Array.isArray(question.answers)) {
          console.error('Invalid answers for question:', qIndex);
          return;
        }
        
        const inputs = questionDiv.querySelectorAll(`input[name="question-${qIndex}"]`);
        const selectedAnswers = Array.from(inputs)
          .filter(input => input.checked)
          .map(input => parseInt(input.value));
        
        const correctAnswers = question.answers
          .map((answer, index) => answer.correct === true ? index : -1)
          .filter(index => index !== -1);
        
        const isCorrect = arraysEqual(selectedAnswers, correctAnswers);
        
        if (isCorrect) {
          correctCount++;
          feedbackDiv.innerHTML = '<span class="text-success">✓ ' + (lang === 'ru' ? 'Правильно!' : 'Correct!') + '</span>';
          feedbackDiv.style.display = 'block';
          inputs.forEach(input => {
            const answerIndex = parseInt(input.value);
            const answer = question.answers[answerIndex];
            if (!answer) return;
            
            if (input.checked && answer.correct === true) {
              input.parentElement.classList.add('text-success');
            } else if (input.checked && answer.correct !== true) {
              input.parentElement.classList.add('text-danger');
            } else if (!input.checked && answer.correct === true) {
              input.parentElement.classList.add('text-warning');
            }
          });
        } else {
          feedbackDiv.innerHTML = '<span class="text-danger">✗ ' + (lang === 'ru' ? 'Неправильно' : 'Incorrect') + '</span>';
          feedbackDiv.style.display = 'block';
          inputs.forEach(input => {
            const answerIndex = parseInt(input.value);
            const answer = question.answers[answerIndex];
            if (!answer) return;
            
            if (input.checked && answer.correct !== true) {
              input.parentElement.classList.add('text-danger');
            } else if (!input.checked && answer.correct === true) {
              input.parentElement.classList.add('text-warning');
            }
          });
        }
      } else if (question.type === 'text') {
        const textarea = questionDiv.querySelector('textarea');
        const correctAnswerDiv = questionDiv.querySelector('[data-correct-answer]');
        
        if (!textarea || !question.correct_answer) {
          console.error('Invalid text question:', qIndex);
          return;
        }
        
        if (textarea.value.trim().toLowerCase() === question.correct_answer.toLowerCase()) {
          correctCount++;
          feedbackDiv.innerHTML = '<span class="text-success">✓ ' + (lang === 'ru' ? 'Правильно!' : 'Correct!') + '</span>';
          feedbackDiv.style.display = 'block';
        } else {
          feedbackDiv.innerHTML = '<span class="text-danger">✗ ' + (lang === 'ru' ? 'Неправильно' : 'Incorrect') + '</span>';
          feedbackDiv.style.display = 'block';
          if (correctAnswerDiv) {
            correctAnswerDiv.style.display = 'block';
          }
        }
      }
    });
    
    const percentage = Math.round((correctCount / totalQuestions) * 100);
    const alertClass = percentage >= 70 ? 'alert-success' : percentage >= 50 ? 'alert-warning' : 'alert-danger';
    const message = (lang === 'ru' ? 'Вы ответили правильно на ' : 'You got ') + 
                   correctCount + (lang === 'ru' ? ' из ' : ' out of ') + 
                   totalQuestions + (lang === 'ru' ? ' вопросов (' : ' questions (') + 
                   percentage + '%)';
    
    const alertElement = resultsDiv.querySelector('.alert');
    if (alertElement) {
      alertElement.className = 'alert ' + alertClass;
      alertElement.textContent = message;
    }
      resultsDiv.style.display = 'block';
      checkBtn.style.display = 'none';
      if (resetBtn) {
        resetBtn.style.display = 'inline-block';
      }
    });
    
    if (resetBtn) {
      resetBtn.addEventListener('click', function() {
        form.reset();
        form.querySelectorAll('.quiz-feedback').forEach(el => el.style.display = 'none');
        form.querySelectorAll('.text-success, .text-danger, .text-warning').forEach(el => {
          el.classList.remove('text-success', 'text-danger', 'text-warning');
        });
        form.querySelectorAll('[data-correct-answer]').forEach(el => el.style.display = 'none');
        resultsDiv.style.display = 'none';
        checkBtn.style.display = 'inline-block';
        resetBtn.style.display = 'none';
      });
    }
  } catch (error) {
    console.error('Quiz script error:', error);
  }
})();
</script>



    
    <hr class="mt-5 mb-4">
    <h3 class="mb-4">Related Articles</h3>
    <div class="row">
      <div class="col-md-6 mb-4">
        <div class="card h-100 bg-light rounded" style="border: none;">
          <div class="card-body">
            <span style="color: #aaa; font-size: 0.9em;">


  May 2, 2020


</span>
            <h4 class="card-title mt-2">
              <a href="/en/post/sync-map.html" style="text-decoration: none; color: inherit;">sync.Map</a>
            </h4>
            
            
            
            <a href="/en/post/sync-map.html">
              <img class="card-img-top mb-3 rounded"
                   src="/en/post/sync-map/dvoe.svg"
                   style="max-height: 200px;"
                   alt="sync.Map"/>
            </a>
            
            
            <p class="card-text"><p>Let&rsquo;s take a look at <code>sync.Map</code> usage and its source code.</p></p>
            
            <a href="/en/post/sync-map.html" class="btn btn-primary btn-sm">Read More →</a>
                  <a href="/tags/sync.map/" class="badge">Sync.map</a>
                  <a href="/tags/map/" class="badge">Map</a>
                  <a href="/tags/concurrency/" class="badge">Concurrency</a>
          </div>
        </div>
      </div>
      <div class="col-md-6 mb-4">
        <div class="card h-100 bg-light rounded" style="border: none;">
          <div class="card-body">
            <span style="color: #aaa; font-size: 0.9em;">


  April 9, 2020


</span>
            <h4 class="card-title mt-2">
              <a href="/en/post/templates.html" style="text-decoration: none; color: inherit;">GO Templates: Principles and Usage</a>
            </h4>
            
            
            
            <a href="/en/post/templates.html">
              <img class="card-img-top mb-3 rounded"
                   src="/en/post/templates/lis.svg"
                   style="max-height: 200px;"
                   alt="GO Templates: Principles and Usage"/>
            </a>
            
            
            <p class="card-text"><p>Packages <code>text/template</code> and <code>html/template</code> are part of the Go standard library. Go templates are used in many Go-programmed software — Docker, Kubernetes, Helm. Many third-party libraries are integrated with Go templates, for example Echo. Knowing Go template syntax is very useful.</p>
<p>This article consists of <code>text/template</code> package documentation and a couple of author&rsquo;s solutions. After describing Go template syntax, we&rsquo;ll dive into <code>text/template</code> and <code>html/template</code> sources.</p></p>
            
            <a href="/en/post/templates.html" class="btn btn-primary btn-sm">Read More →</a>
                  <a href="/tags/templates/" class="badge">Templates</a>
                  <a href="/tags/html/" class="badge">Html</a>
                  <a href="/tags/text/" class="badge">Text</a>
                  <a href="/tags/sources/" class="badge">Sources</a>
          </div>
        </div>
      </div>
      <div class="col-md-6 mb-4">
        <div class="card h-100 bg-light rounded" style="border: none;">
          <div class="card-body">
            <span style="color: #aaa; font-size: 0.9em;">


  April 4, 2020


</span>
            <h4 class="card-title mt-2">
              <a href="/en/post/golang-slice.html" style="text-decoration: none; color: inherit;">Principles of slice type in GO</a>
            </h4>
            
            
            
            <a href="/en/post/golang-slice.html">
              <img class="card-img-top mb-3 rounded"
                   src="/en/post/golang-slice/gophslice.svg"
                   style="max-height: 200px;"
                   alt="Principles of slice type in GO"/>
            </a>
            
            
            <p class="card-text"><p>The Go blog describes how to use slices. Let&rsquo;s take a look at slice internals.</p></p>
            
            <a href="/en/post/golang-slice.html" class="btn btn-primary btn-sm">Read More →</a>
                  <a href="/tags/slice/" class="badge">Slice</a>
                  <a href="/tags/allocation/" class="badge">Allocation</a>
                  <a href="/tags/sources/" class="badge">Sources</a>
          </div>
        </div>
      </div>
      <div class="col-md-6 mb-4">
        <div class="card h-100 bg-light rounded" style="border: none;">
          <div class="card-body">
            <span style="color: #aaa; font-size: 0.9em;">


  April 2, 2020


</span>
            <h4 class="card-title mt-2">
              <a href="/en/post/golang-data-handling-concurrent-programs.html" style="text-decoration: none; color: inherit;">Data handling in concurrent programs</a>
            </h4>
            
            
            
            <a href="/en/post/golang-data-handling-concurrent-programs.html">
              <img class="card-img-top mb-3 rounded"
                   src="/en/post/golang-data-handling-concurrent-programs/kanat.svg"
                   style="max-height: 200px;"
                   alt="Data handling in concurrent programs"/>
            </a>
            
            
            <p class="card-text"><p>In Go, we have goroutines functionality out of the box. We can run code in parallel. However, in our parallel running code we can work with shared variables, and it is not clear how exactly Go handles such situations.</p></p>
            
            <a href="/en/post/golang-data-handling-concurrent-programs.html" class="btn btn-primary btn-sm">Read More →</a>
                  <a href="/tags/map/" class="badge">Map</a>
                  <a href="/tags/sources/" class="badge">Sources</a>
          </div>
        </div>
      </div>
      <div class="col-md-6 mb-4">
        <div class="card h-100 bg-light rounded" style="border: none;">
          <div class="card-body">
            <span style="color: #aaa; font-size: 0.9em;">


  March 30, 2020


</span>
            <h4 class="card-title mt-2">
              <a href="/en/post/golang-regexp-matching-newline.html" style="text-decoration: none; color: inherit;">Golang regexp: matching newline</a>
            </h4>
            
            
            
            <a href="/en/post/golang-regexp-matching-newline.html">
              <img class="card-img-top mb-3 rounded"
                   src="/en/post/golang-regexp-matching-newline/regular.svg"
                   style="max-height: 200px;"
                   alt="Golang regexp: matching newline"/>
            </a>
            
            
            <p class="card-text"><p>Why regular expressions with dot (&quot;.&quot;) work differently in Go compared to PHP and JavaScript.</p></p>
            
            <a href="/en/post/golang-regexp-matching-newline.html" class="btn btn-primary btn-sm">Read More →</a>
                  <a href="/tags/regular-expressions/" class="badge">Regular Expressions</a>
                  <a href="/tags/sources/" class="badge">Sources</a>
          </div>
        </div>
      </div>
    </div>


    <script defer src="/discuss.js"></script>
    <div id="discuss"></div>
</div>

</div>

<div class="bg-light">&nbsp;</div>

<footer>
    <div class="container " style="padding-top: 0; padding-bottom: 10px;">
    <div class="container">
        <img src="/niz.svg" alt="gopher legs" style="height: 50px; vertical-align: top;"/>
        <div style="text-align: right; vertical-align: top; display: inline-block;">
            
            &nbsp;
            &nbsp;
            &nbsp;
            
            
            <a href='/ru/post/map-principles-golang.html'>
            <span class="flag-icon flag-icon-ru"></span>
            </a>
            
        </div>

    </div>
</div>

</footer>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script defer src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

</body>
</html>
