

<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=51376&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="content-type" content="text/html; charset=utf-8" />

<title>Principles of slice type in GO | Golang for all</title>




  






  
  
    
  








  



<meta name="description" content="The Go blog describes how to use slices. Let&rsquo;s take a look at slice internals.
">


<meta property="og:type" content="article">
<meta property="og:url" content="http://localhost:51376/en/post/golang-slice.html">
<meta property="og:title" content="Principles of slice type in GO | Golang for all">
<meta property="og:description" content="The Go blog describes how to use slices. Let&rsquo;s take a look at slice internals.
">
<meta property="og:image" content="http://localhost:51376/en/post/golang-slice/gophslice.svg">
<meta property="og:site_name" content="Golang for all">
<meta property="og:locale" content="en">

  
    <meta property="article:published_time" content="2020-04-04T09:00:00&#43;03:00">
  
  
    <meta property="article:modified_time" content="2020-04-04T09:00:00&#43;03:00">
  
  
    
      <meta property="article:tag" content="Slice">
    
      <meta property="article:tag" content="Allocation">
    
      <meta property="article:tag" content="Sources">
    
  



<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:url" content="http://localhost:51376/en/post/golang-slice.html">
<meta name="twitter:title" content="Principles of slice type in GO | Golang for all">
<meta name="twitter:description" content="The Go blog describes how to use slices. Let&rsquo;s take a look at slice internals.
">
<meta name="twitter:image" content="http://localhost:51376/en/post/golang-slice/gophslice.svg">



<link rel="canonical" href="http://localhost:51376/en/post/golang-slice.html">



  <link rel="alternate" hreflang="ru" href="http://localhost:51376/ru/post/golang-slice.html">


<meta name="yandex-verification" content="10233a4b32f4dc29" />
<meta name="yandex-verification" content="cfa4be404c1af368" />

<link rel="icon" type="image/png" sizes="93x93" href="/gophereye.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="/gophereye32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/gophereye16x16.png">


    <link rel="stylesheet" href="/css/main.css">


      <script src="/js/main.js"></script>


<link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.4.6/css/flag-icon.min.css" integrity="sha256-YjcCvXkdRVOucibC9I4mBS41lXPrWfqY2BnpskhZPnw=" crossorigin="anonymous" />


</head>
<body>
<div class="container">
    <nav class="navbar navbar-expand-lg navbar-light" style="padding-bottom: 0;">
        <div class="container">
            <a class="navbar-brand" href="/en/" style="padding-bottom: 0">
                <img src="/verh.svg" alt="gopher eyes" style="height: 50px;"/>
            </a>

            <button class="navbar-toggler" type="button"
                    data-toggle="collapse"
                    data-target="#navbarResponsive"
                    aria-controls="navbarResponsive"
                    aria-expanded="false"
                    aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <a href="/en/" style="color:#000;"><span class="gopherchat">Golang for all</span></a>
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="/en/about.html">About</a>
                    </li>
                    
                </ul>
            </div>
        </div>
    </nav>
</div>
<div class="bg-light">&nbsp;</div>

<div class="container">
    
<div class="col-lg-12">
    
    <h1 class="mt-4">Principles of slice type in GO</h1>

    
    <p>


  April 4, 2020



            <a href="/tags/slice/" class="badge">Slice</a>
            <a href="/tags/allocation/" class="badge">Allocation</a>
            <a href="/tags/sources/" class="badge">Sources</a>
    </p>

    <hr/>

    
    
    
    <div class="container">
        <div class="row mx-0 my-0">
            <div class="col-md-8">
                <img class="img-fluid rounded"
                     style="max-height: 400px;"
                     src="/en/post/golang-slice/gophslice.svg"
                     alt="Principles of slice type in GO"/>
            </div>
            <div class="col-md-4">
                
                
                <nav id="toc">
                    <h5>Contents</h5>
                    <nav id="TableOfContents">
  <ul>
    <li><a href="#slice-behavior-on-append">Slice Behavior on Append</a></li>
    <li><a href="#memory-impact-of-appending">Memory Impact of Appending</a></li>
  </ul>
</nav>
                </nav>
                
            </div>
        </div>
    </div>
    <hr>
    
    

    <div id="post-content">
    <p>The Go blog describes how to use slices. Let&rsquo;s take a look at slice internals.</p>
<p>A slice is a data type that wraps an array.</p>
<p>The differences between a slice and an array are:</p>
<ul>
<li>A slice is a pointer to an array</li>
<li>A slice&rsquo;s size can be changed</li>
</ul>
<p>In the Go sources, a slice is represented by the following structure:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">slice</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">array</span> <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">len</span>   <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">cap</span>   <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>len</code> (length) is the current slice length, <code>cap</code> (capacity) is the number of elements in the underlying array.</p>
<p>Both fields can be passed as parameters to the <code>make</code> function:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">s</span> <span style="color:#f92672">:=</span> make(
</span></span><span style="display:flex;"><span>	[]<span style="color:#66d9ef">int</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#ae81ff">10</span>, <span style="color:#75715e">// len</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ae81ff">10</span>, <span style="color:#75715e">// cap</span>
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p>Capacity is the main parameter responsible for memory allocations in slices. It is also responsible for append performance.</p>
<h2 id="slice-behavior-on-append">Slice Behavior on Append</h2>
<p>Let&rsquo;s take a look at slice behavior when appending:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">a</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">1</span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">b</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">a</span>[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">b</span>[<span style="color:#ae81ff">0</span>] = <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">a</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">// [0]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">a</span>[<span style="color:#ae81ff">0</span>] = <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">b</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">// [1]</span>
</span></span></code></pre></div><p>We created slice <code>b</code> from slice <code>a</code>. As we can see, both slices point to the same underlying array.</p>
<p>Let&rsquo;s add an append operation to one of the slices:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">a</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">1</span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">b</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">a</span>[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">a</span> = append(<span style="color:#a6e22e">a</span>, <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">a</span>[<span style="color:#ae81ff">0</span>] = <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">b</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">// [10 2] [0]</span>
</span></span></code></pre></div><p>After the append, slices have different values in the first element. Now the slices point to different arrays.</p>
<p>One can understand this situation by examining the <code>growslice</code> function sources.</p>
<p>On capacity change, the underlying array data is always copied:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">memmove</span>(<span style="color:#a6e22e">p</span>, <span style="color:#a6e22e">old</span>.<span style="color:#a6e22e">array</span>, <span style="color:#a6e22e">lenmem</span>)
</span></span></code></pre></div><p>Now let&rsquo;s take a look at the actual capacity changes:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">newcap</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">old</span>.<span style="color:#a6e22e">cap</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">doublecap</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">newcap</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">newcap</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">cap</span> &gt; <span style="color:#a6e22e">doublecap</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">newcap</span> = <span style="color:#a6e22e">cap</span>
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">old</span>.<span style="color:#a6e22e">len</span> &lt; <span style="color:#ae81ff">1024</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">newcap</span> = <span style="color:#a6e22e">doublecap</span>
</span></span><span style="display:flex;"><span>	} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// Check 0 &lt; newcap to detect overflow</span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// and prevent an infinite loop.</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> <span style="color:#ae81ff">0</span> &lt; <span style="color:#a6e22e">newcap</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">newcap</span> &lt; <span style="color:#a6e22e">cap</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">newcap</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">newcap</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// Set newcap to the requested cap when</span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// the newcap calculation overflowed.</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">newcap</span> <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">newcap</span> = <span style="color:#a6e22e">cap</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When slice length &lt; 1024, memory size doubles.</p>
<p>Otherwise, the slice grows by a quarter.</p>
<h2 id="memory-impact-of-appending">Memory Impact of Appending</h2>
<p>Appending to a slice has a significant impact on memory:</p>
<ul>
<li>On capacity change, the array will be copied</li>
<li>Allocated memory will grow according to internal Go logic</li>
<li>To avoid allocations, one must set the initial slice capacity large enough</li>
</ul>
<p>In the next example, the only change is the slice capacity. Now after appending to the slice, there is no capacity change. Both slices still point to the same array:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">a</span> <span style="color:#f92672">:=</span> make([]<span style="color:#66d9ef">int</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">a</span>[<span style="color:#ae81ff">0</span>] = <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">b</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">a</span>[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">b</span>[<span style="color:#ae81ff">0</span>] = <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">b</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">// [0] [0]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">a</span> = append(<span style="color:#a6e22e">a</span>, <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">a</span>[<span style="color:#ae81ff">0</span>] = <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">b</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">// [10 2] [10]</span>
</span></span></code></pre></div><p>The Go blog describes an option to use a different append function. However, the only thing we can do is make even more aggressive allocations than Go does:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">AppendByte</span>(<span style="color:#a6e22e">slice</span> []<span style="color:#66d9ef">byte</span>, <span style="color:#a6e22e">data</span> <span style="color:#f92672">...</span><span style="color:#66d9ef">byte</span>) []<span style="color:#66d9ef">byte</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">m</span> <span style="color:#f92672">:=</span> len(<span style="color:#a6e22e">slice</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">n</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">m</span> <span style="color:#f92672">+</span> len(<span style="color:#a6e22e">data</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">n</span> &gt; cap(<span style="color:#a6e22e">slice</span>) { <span style="color:#75715e">// if necessary, reallocate</span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// allocate double what&#39;s needed, for future growth.</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">newSlice</span> <span style="color:#f92672">:=</span> make([]<span style="color:#66d9ef">byte</span>, (<span style="color:#a6e22e">n</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>		copy(<span style="color:#a6e22e">newSlice</span>, <span style="color:#a6e22e">slice</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">slice</span> = <span style="color:#a6e22e">newSlice</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">slice</span> = <span style="color:#a6e22e">slice</span>[<span style="color:#ae81ff">0</span>:<span style="color:#a6e22e">n</span>]
</span></span><span style="display:flex;"><span>	copy(<span style="color:#a6e22e">slice</span>[<span style="color:#a6e22e">m</span>:<span style="color:#a6e22e">n</span>], <span style="color:#a6e22e">data</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">slice</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>One should be careful when a new slice is created as a part of an old one. The full old underlying array will remain in memory.</p>
    
  <div>
    <div>Tags:</div>
    <ul>
        <li><a href="/tags/slice/">Slice</a></li>
        <li><a href="/tags/allocation/">Allocation</a></li>
        <li><a href="/tags/sources/">Sources</a></li>
    </ul>
  </div>

    </div>
    
<div id="article-quiz" class="mt-5 mb-5" data-quiz-lang="en">
  <hr class="mb-4">
  <h3 class="mb-4">Test Your Knowledge</h3>
  
  <form id="quiz-form" data-quiz-data="{&#34;questions&#34;:[{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;A slice is a pointer to an array&#34;},{&#34;correct&#34;:true,&#34;text&#34;:&#34;A slice&#39;s size can be changed&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;Arrays are faster than slices&#34;}],&#34;question&#34;:&#34;What is the main difference between a slice and an array in Go?&#34;,&#34;type&#34;:&#34;multiple-choice&#34;},{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;The data is copied to a new array&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;The array is extended in place&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;Nothing happens&#34;}],&#34;question&#34;:&#34;What happens to the underlying array when a slice&#39;s capacity changes during append?&#34;,&#34;type&#34;:&#34;single-choice&#34;},{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;Memory size doubles&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;Memory grows by a quarter&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;Memory grows by a fixed amount&#34;}],&#34;question&#34;:&#34;How does slice capacity grow when length is less than 1024?&#34;,&#34;type&#34;:&#34;single-choice&#34;},{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;The old underlying array remains in memory&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;The old array is garbage collected immediately&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;Both slices share the same array&#34;}],&#34;question&#34;:&#34;What happens when you create a new slice from an old slice and the old slice&#39;s capacity changes?&#34;,&#34;type&#34;:&#34;single-choice&#34;}]}">
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="0">
      <h5 class="mb-3">1. What is the main difference between a slice and an array in Go?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-0" 
                 value="0"
                 id="q0-a0">
          <label class="form-check-label" for="q0-a0">
            A slice is a pointer to an array
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-0" 
                 value="1"
                 id="q0-a1">
          <label class="form-check-label" for="q0-a1">
            A slice&#39;s size can be changed
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-0" 
                 value="2"
                 id="q0-a2">
          <label class="form-check-label" for="q0-a2">
            Arrays are faster than slices
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="1">
      <h5 class="mb-3">2. What happens to the underlying array when a slice&#39;s capacity changes during append?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-1" 
                 value="0"
                 id="q1-a0">
          <label class="form-check-label" for="q1-a0">
            The data is copied to a new array
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-1" 
                 value="1"
                 id="q1-a1">
          <label class="form-check-label" for="q1-a1">
            The array is extended in place
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-1" 
                 value="2"
                 id="q1-a2">
          <label class="form-check-label" for="q1-a2">
            Nothing happens
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="2">
      <h5 class="mb-3">3. How does slice capacity grow when length is less than 1024?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-2" 
                 value="0"
                 id="q2-a0">
          <label class="form-check-label" for="q2-a0">
            Memory size doubles
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-2" 
                 value="1"
                 id="q2-a1">
          <label class="form-check-label" for="q2-a1">
            Memory grows by a quarter
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-2" 
                 value="2"
                 id="q2-a2">
          <label class="form-check-label" for="q2-a2">
            Memory grows by a fixed amount
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="3">
      <h5 class="mb-3">4. What happens when you create a new slice from an old slice and the old slice&#39;s capacity changes?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-3" 
                 value="0"
                 id="q3-a0">
          <label class="form-check-label" for="q3-a0">
            The old underlying array remains in memory
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-3" 
                 value="1"
                 id="q3-a1">
          <label class="form-check-label" for="q3-a1">
            The old array is garbage collected immediately
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-3" 
                 value="2"
                 id="q3-a2">
          <label class="form-check-label" for="q3-a2">
            Both slices share the same array
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    
    <button type="button" class="btn btn-primary" id="check-answers">
      Check Answers
    </button>
    <button type="button" class="btn btn-secondary ml-2" id="reset-quiz" style="display: none;">
      Reset
    </button>
  </form>
  
  <div id="quiz-results" class="mt-4" style="display: none;">
    <div class="alert" role="alert"></div>
  </div>
</div>

<script>
(function() {
  try {
    const quizContainer = document.getElementById('article-quiz');
    const form = document.getElementById('quiz-form');
    const checkBtn = document.getElementById('check-answers');
    const resetBtn = document.getElementById('reset-quiz');
    const resultsDiv = document.getElementById('quiz-results');
    
    if (!quizContainer || !form || !checkBtn) {
      console.error('Quiz initialization failed: missing elements', {
        quizContainer: !!quizContainer,
        form: !!form,
        checkBtn: !!checkBtn
      });
      return;
    }
    
    const lang = quizContainer.getAttribute('data-quiz-lang') || 'en';
    const quizDataRaw = form.getAttribute('data-quiz-data');
    
    if (!quizDataRaw) {
      console.error('Quiz data not found in data attribute');
      return;
    }
    
    let quizData;
    try {
      quizData = JSON.parse(quizDataRaw);
    } catch (e) {
      console.error('Failed to parse quiz data:', e, quizDataRaw);
      return;
    }
    
    if (!quizData || !quizData.questions || !Array.isArray(quizData.questions)) {
      console.error('Invalid quiz data structure:', quizData);
      return;
    }
    
    
    console.log('Quiz data loaded:', quizData);
  
    function arraysEqual(a, b) {
      if (!a || !b) return false;
      if (a.length !== b.length) return false;
      const sortedA = [...a].sort();
      const sortedB = [...b].sort();
      return sortedA.every((val, i) => val === sortedB[i]);
    }
    
    checkBtn.addEventListener('click', function() {
    if (!quizData.questions || !Array.isArray(quizData.questions)) {
      console.error('Invalid quiz data structure');
      return;
    }
    
    let correctCount = 0;
    let totalQuestions = quizData.questions.length;
    
    quizData.questions.forEach((question, qIndex) => {
      const questionDiv = form.querySelector(`[data-question-index="${qIndex}"]`);
      if (!questionDiv) {
        console.error('Question div not found for index:', qIndex);
        return;
      }
      
      const feedbackDiv = questionDiv.querySelector('.quiz-feedback');
      if (!feedbackDiv) {
        console.error('Feedback div not found for question:', qIndex);
        return;
      }
      
      if (question.type === 'multiple-choice' || question.type === 'single-choice') {
        if (!question.answers || !Array.isArray(question.answers)) {
          console.error('Invalid answers for question:', qIndex);
          return;
        }
        
        const inputs = questionDiv.querySelectorAll(`input[name="question-${qIndex}"]`);
        const selectedAnswers = Array.from(inputs)
          .filter(input => input.checked)
          .map(input => parseInt(input.value));
        
        const correctAnswers = question.answers
          .map((answer, index) => answer.correct === true ? index : -1)
          .filter(index => index !== -1);
        
        const isCorrect = arraysEqual(selectedAnswers, correctAnswers);
        
        if (isCorrect) {
          correctCount++;
          feedbackDiv.innerHTML = '<span class="text-success">✓ ' + (lang === 'ru' ? 'Правильно!' : 'Correct!') + '</span>';
          feedbackDiv.style.display = 'block';
          inputs.forEach(input => {
            const answerIndex = parseInt(input.value);
            const answer = question.answers[answerIndex];
            if (!answer) return;
            
            if (input.checked && answer.correct === true) {
              input.parentElement.classList.add('text-success');
            } else if (input.checked && answer.correct !== true) {
              input.parentElement.classList.add('text-danger');
            } else if (!input.checked && answer.correct === true) {
              input.parentElement.classList.add('text-warning');
            }
          });
        } else {
          feedbackDiv.innerHTML = '<span class="text-danger">✗ ' + (lang === 'ru' ? 'Неправильно' : 'Incorrect') + '</span>';
          feedbackDiv.style.display = 'block';
          inputs.forEach(input => {
            const answerIndex = parseInt(input.value);
            const answer = question.answers[answerIndex];
            if (!answer) return;
            
            if (input.checked && answer.correct !== true) {
              input.parentElement.classList.add('text-danger');
            } else if (!input.checked && answer.correct === true) {
              input.parentElement.classList.add('text-warning');
            }
          });
        }
      } else if (question.type === 'text') {
        const textarea = questionDiv.querySelector('textarea');
        const correctAnswerDiv = questionDiv.querySelector('[data-correct-answer]');
        
        if (!textarea || !question.correct_answer) {
          console.error('Invalid text question:', qIndex);
          return;
        }
        
        if (textarea.value.trim().toLowerCase() === question.correct_answer.toLowerCase()) {
          correctCount++;
          feedbackDiv.innerHTML = '<span class="text-success">✓ ' + (lang === 'ru' ? 'Правильно!' : 'Correct!') + '</span>';
          feedbackDiv.style.display = 'block';
        } else {
          feedbackDiv.innerHTML = '<span class="text-danger">✗ ' + (lang === 'ru' ? 'Неправильно' : 'Incorrect') + '</span>';
          feedbackDiv.style.display = 'block';
          if (correctAnswerDiv) {
            correctAnswerDiv.style.display = 'block';
          }
        }
      }
    });
    
    const percentage = Math.round((correctCount / totalQuestions) * 100);
    const alertClass = percentage >= 70 ? 'alert-success' : percentage >= 50 ? 'alert-warning' : 'alert-danger';
    const message = (lang === 'ru' ? 'Вы ответили правильно на ' : 'You got ') + 
                   correctCount + (lang === 'ru' ? ' из ' : ' out of ') + 
                   totalQuestions + (lang === 'ru' ? ' вопросов (' : ' questions (') + 
                   percentage + '%)';
    
    const alertElement = resultsDiv.querySelector('.alert');
    if (alertElement) {
      alertElement.className = 'alert ' + alertClass;
      alertElement.textContent = message;
    }
      resultsDiv.style.display = 'block';
      checkBtn.style.display = 'none';
      if (resetBtn) {
        resetBtn.style.display = 'inline-block';
      }
    });
    
    if (resetBtn) {
      resetBtn.addEventListener('click', function() {
        form.reset();
        form.querySelectorAll('.quiz-feedback').forEach(el => el.style.display = 'none');
        form.querySelectorAll('.text-success, .text-danger, .text-warning').forEach(el => {
          el.classList.remove('text-success', 'text-danger', 'text-warning');
        });
        form.querySelectorAll('[data-correct-answer]').forEach(el => el.style.display = 'none');
        resultsDiv.style.display = 'none';
        checkBtn.style.display = 'inline-block';
        resetBtn.style.display = 'none';
      });
    }
  } catch (error) {
    console.error('Quiz script error:', error);
  }
})();
</script>



    
    <hr class="mt-5 mb-4">
    <h3 class="mb-4">Related Articles</h3>
    <div class="row">
      <div class="col-md-6 mb-4">
        <div class="card h-100 bg-light rounded" style="border: none;">
          <div class="card-body">
            <span style="color: #aaa; font-size: 0.9em;">


  April 23, 2020


</span>
            <h4 class="card-title mt-2">
              <a href="/en/post/profiling.html" style="text-decoration: none; color: inherit;">Profiling Go: Basics and Practice</a>
            </h4>
            
            
            
            <a href="/en/post/profiling.html">
              <img class="card-img-top mb-3 rounded"
                   src="/en/post/profiling/goph.svg"
                   style="max-height: 200px;"
                   alt="Profiling Go: Basics and Practice"/>
            </a>
            
            
            <p class="card-text"><p>Go has rich profiling tools from the very beginning — the <code>pprof</code> package and <code>go tool pprof</code>. Let&rsquo;s discuss why profiling is useful, how to work with it, and what&rsquo;s new in this area.</p></p>
            
            <a href="/en/post/profiling.html" class="btn btn-primary btn-sm">Read More →</a>
                  <a href="/tags/profiling/" class="badge">Profiling</a>
                  <a href="/tags/pprof/" class="badge">Pprof</a>
                  <a href="/tags/benchmark/" class="badge">Benchmark</a>
                  <a href="/tags/ab/" class="badge">Ab</a>
                  <a href="/tags/cpu/" class="badge">Cpu</a>
                  <a href="/tags/allocation/" class="badge">Allocation</a>
                  <a href="/tags/remote/" class="badge">Remote</a>
          </div>
        </div>
      </div>
      <div class="col-md-6 mb-4">
        <div class="card h-100 bg-light rounded" style="border: none;">
          <div class="card-body">
            <span style="color: #aaa; font-size: 0.9em;">


  April 9, 2020


</span>
            <h4 class="card-title mt-2">
              <a href="/en/post/templates.html" style="text-decoration: none; color: inherit;">GO Templates: Principles and Usage</a>
            </h4>
            
            
            
            <a href="/en/post/templates.html">
              <img class="card-img-top mb-3 rounded"
                   src="/en/post/templates/lis.svg"
                   style="max-height: 200px;"
                   alt="GO Templates: Principles and Usage"/>
            </a>
            
            
            <p class="card-text"><p>Packages <code>text/template</code> and <code>html/template</code> are part of the Go standard library. Go templates are used in many Go-programmed software — Docker, Kubernetes, Helm. Many third-party libraries are integrated with Go templates, for example Echo. Knowing Go template syntax is very useful.</p>
<p>This article consists of <code>text/template</code> package documentation and a couple of author&rsquo;s solutions. After describing Go template syntax, we&rsquo;ll dive into <code>text/template</code> and <code>html/template</code> sources.</p></p>
            
            <a href="/en/post/templates.html" class="btn btn-primary btn-sm">Read More →</a>
                  <a href="/tags/templates/" class="badge">Templates</a>
                  <a href="/tags/html/" class="badge">Html</a>
                  <a href="/tags/text/" class="badge">Text</a>
                  <a href="/tags/sources/" class="badge">Sources</a>
          </div>
        </div>
      </div>
      <div class="col-md-6 mb-4">
        <div class="card h-100 bg-light rounded" style="border: none;">
          <div class="card-body">
            <span style="color: #aaa; font-size: 0.9em;">


  April 2, 2020


</span>
            <h4 class="card-title mt-2">
              <a href="/en/post/golang-data-handling-concurrent-programs.html" style="text-decoration: none; color: inherit;">Data handling in concurrent programs</a>
            </h4>
            
            
            
            <a href="/en/post/golang-data-handling-concurrent-programs.html">
              <img class="card-img-top mb-3 rounded"
                   src="/en/post/golang-data-handling-concurrent-programs/kanat.svg"
                   style="max-height: 200px;"
                   alt="Data handling in concurrent programs"/>
            </a>
            
            
            <p class="card-text"><p>In Go, we have goroutines functionality out of the box. We can run code in parallel. However, in our parallel running code we can work with shared variables, and it is not clear how exactly Go handles such situations.</p></p>
            
            <a href="/en/post/golang-data-handling-concurrent-programs.html" class="btn btn-primary btn-sm">Read More →</a>
                  <a href="/tags/map/" class="badge">Map</a>
                  <a href="/tags/sources/" class="badge">Sources</a>
          </div>
        </div>
      </div>
      <div class="col-md-6 mb-4">
        <div class="card h-100 bg-light rounded" style="border: none;">
          <div class="card-body">
            <span style="color: #aaa; font-size: 0.9em;">


  April 2, 2020


</span>
            <h4 class="card-title mt-2">
              <a href="/en/post/map-principles-golang.html" style="text-decoration: none; color: inherit;">Principles of map type in GO</a>
            </h4>
            
            
            
            <a href="/en/post/map-principles-golang.html">
              <img class="card-img-top mb-3 rounded"
                   src="/en/post/map-principles-golang/map.svg"
                   style="max-height: 200px;"
                   alt="Principles of map type in GO"/>
            </a>
            
            
            <p class="card-text"><p>The map programming interface in Go is described in the Go blog. We just need to recall that a map is a key-value storage and it should retrieve values by key as fast as possible.</p></p>
            
            <a href="/en/post/map-principles-golang.html" class="btn btn-primary btn-sm">Read More →</a>
                  <a href="/tags/map/" class="badge">Map</a>
                  <a href="/tags/sources/" class="badge">Sources</a>
          </div>
        </div>
      </div>
      <div class="col-md-6 mb-4">
        <div class="card h-100 bg-light rounded" style="border: none;">
          <div class="card-body">
            <span style="color: #aaa; font-size: 0.9em;">


  March 30, 2020


</span>
            <h4 class="card-title mt-2">
              <a href="/en/post/golang-regexp-matching-newline.html" style="text-decoration: none; color: inherit;">Golang regexp: matching newline</a>
            </h4>
            
            
            
            <a href="/en/post/golang-regexp-matching-newline.html">
              <img class="card-img-top mb-3 rounded"
                   src="/en/post/golang-regexp-matching-newline/regular.svg"
                   style="max-height: 200px;"
                   alt="Golang regexp: matching newline"/>
            </a>
            
            
            <p class="card-text"><p>Why regular expressions with dot (&quot;.&quot;) work differently in Go compared to PHP and JavaScript.</p></p>
            
            <a href="/en/post/golang-regexp-matching-newline.html" class="btn btn-primary btn-sm">Read More →</a>
                  <a href="/tags/regular-expressions/" class="badge">Regular Expressions</a>
                  <a href="/tags/sources/" class="badge">Sources</a>
          </div>
        </div>
      </div>
    </div>


    <script defer src="/discuss.js"></script>
    <div id="discuss"></div>
</div>

</div>

<div class="bg-light">&nbsp;</div>

<footer>
    <div class="container " style="padding-top: 0; padding-bottom: 10px;">
    <div class="container">
        <img src="/niz.svg" alt="gopher legs" style="height: 50px; vertical-align: top;"/>
        <div style="text-align: right; vertical-align: top; display: inline-block;">
            
            &nbsp;
            &nbsp;
            &nbsp;
            
            
            <a href='/ru/post/golang-slice.html'>
            <span class="flag-icon flag-icon-ru"></span>
            </a>
            
        </div>

    </div>
</div>

</footer>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script defer src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

</body>
</html>
