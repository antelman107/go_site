

<!DOCTYPE html>
<html lang="ru-ru" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=51376&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="content-type" content="text/html; charset=utf-8" />

<title>Деплой Telegram бота на AWS Lambda с Function URL | Golang for all</title>




  






  
  








  



<meta name="description" content="Эта статья является продолжением статьи &ldquo;Создание AI-телеграм бота на Go с Gemini API и AWS Lambda&rdquo; и содержит детальные инструкции по настройке и …">


<meta property="og:type" content="article">
<meta property="og:url" content="http://localhost:51376/ru/post/go-telegram-bot-aws-lambda-deploy.html">
<meta property="og:title" content="Деплой Telegram бота на AWS Lambda с Function URL | Golang for all">
<meta property="og:description" content="Эта статья является продолжением статьи &ldquo;Создание AI-телеграм бота на Go с Gemini API и AWS Lambda&rdquo; и содержит детальные инструкции по настройке и …">
<meta property="og:image" content="http://localhost:51376//gopher.png">
<meta property="og:site_name" content="Golang for all">
<meta property="og:locale" content="ru">

  
    <meta property="article:published_time" content="2024-12-20T09:00:00&#43;03:00">
  
  
    <meta property="article:modified_time" content="2024-12-20T09:00:00&#43;03:00">
  
  
    
      <meta property="article:tag" content="Go">
    
      <meta property="article:tag" content="Telegram">
    
      <meta property="article:tag" content="Aws">
    
      <meta property="article:tag" content="Lambda">
    
      <meta property="article:tag" content="Deploy">
    
      <meta property="article:tag" content="Function-Url">
    
      <meta property="article:tag" content="Cli">
    
  



<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:url" content="http://localhost:51376/ru/post/go-telegram-bot-aws-lambda-deploy.html">
<meta name="twitter:title" content="Деплой Telegram бота на AWS Lambda с Function URL | Golang for all">
<meta name="twitter:description" content="Эта статья является продолжением статьи &ldquo;Создание AI-телеграм бота на Go с Gemini API и AWS Lambda&rdquo; и содержит детальные инструкции по настройке и …">
<meta name="twitter:image" content="http://localhost:51376//gopher.png">



<link rel="canonical" href="http://localhost:51376/ru/post/go-telegram-bot-aws-lambda-deploy.html">



  <link rel="alternate" hreflang="en" href="http://localhost:51376/en/post/go-telegram-bot-aws-lambda-deploy.html">


<meta name="yandex-verification" content="10233a4b32f4dc29" />
<meta name="yandex-verification" content="cfa4be404c1af368" />

<link rel="icon" type="image/png" sizes="93x93" href="/gophereye.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="/gophereye32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/gophereye16x16.png">


    <link rel="stylesheet" href="/css/main.css">


      <script src="/js/main.js"></script>


<link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.4.6/css/flag-icon.min.css" integrity="sha256-YjcCvXkdRVOucibC9I4mBS41lXPrWfqY2BnpskhZPnw=" crossorigin="anonymous" />

<script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true, theme: 'neutral' });
</script>


</head>
<body>
<div class="container">
    <nav class="navbar navbar-expand-lg navbar-light" style="padding-bottom: 0;">
        <div class="container">
            <a class="navbar-brand" href="/ru/" style="padding-bottom: 0">
                <img src="/verh.svg" alt="gopher eyes" style="height: 50px;"/>
            </a>

            <button class="navbar-toggler" type="button"
                    data-toggle="collapse"
                    data-target="#navbarResponsive"
                    aria-controls="navbarResponsive"
                    aria-expanded="false"
                    aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <a href="/ru/" style="color:#000;"><span class="gopherchat">Golang для всех</span></a>
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="/ru/about.html">О сайте</a>
                    </li>
                    
                </ul>
            </div>
        </div>
    </nav>
</div>
<div class="bg-light">&nbsp;</div>

<div class="container">
    
<div class="col-lg-12">
    
    <h1 class="mt-4">Деплой Telegram бота на AWS Lambda с Function URL</h1>

    
    <p>


  20 декабря 2024 г.



            <a href="/ru/tags/go/" class="badge">Go</a>
            <a href="/ru/tags/telegram/" class="badge">Telegram</a>
            <a href="/ru/tags/aws/" class="badge">Aws</a>
            <a href="/ru/tags/lambda/" class="badge">Lambda</a>
            <a href="/ru/tags/deploy/" class="badge">Deploy</a>
            <a href="/ru/tags/function-url/" class="badge">Function-Url</a>
            <a href="/ru/tags/cli/" class="badge">Cli</a>
    </p>

    <hr/>

    
    
    
    <div class="float-right">
        <div>
            
            
            <nav id="toc">
                <h5>Содержание</h5>
                <nav id="TableOfContents">
  <ul>
    <li><a href="#введение">Введение</a></li>
    <li><a href="#подготовка-aws-cli-и-аутентификация">Подготовка: AWS CLI и аутентификация</a>
      <ul>
        <li><a href="#установка-aws-cli">Установка AWS CLI</a></li>
        <li><a href="#настройка-аутентификации">Настройка аутентификации</a></li>
        <li><a href="#проверка-подключения">Проверка подключения</a></li>
        <li><a href="#работа-с-несколькими-профилями">Работа с несколькими профилями</a></li>
      </ul>
    </li>
    <li><a href="#архитектура-обработки-запросов">Архитектура обработки запросов</a></li>
    <li><a href="#подготовка-кода-для-lambda">Подготовка кода для Lambda</a></li>
    <li><a href="#создание-lambda-функции-через-aws-cli">Создание Lambda функции через AWS CLI</a>
      <ul>
        <li><a href="#шаг-1-создание-iam-роли-для-lambda">Шаг 1: Создание IAM роли для Lambda</a></li>
        <li><a href="#шаг-2-создание-s3-бакета-для-разговоров-опционально">Шаг 2: Создание S3 бакета для разговоров (опционально)</a></li>
        <li><a href="#шаг-3-сборка-go-приложения">Шаг 3: Сборка Go приложения</a></li>
        <li><a href="#шаг-4-создание-lambda-функции">Шаг 4: Создание Lambda функции</a></li>
      </ul>
    </li>
    <li><a href="#создание-lambda-function-url">Создание Lambda Function URL</a></li>
    <li><a href="#настройка-telegram-webhook">Настройка Telegram Webhook</a></li>
    <li><a href="#обновление-кода-функции-деплой">Обновление кода функции (деплой)</a></li>
    <li><a href="#мониторинг-и-логирование">Мониторинг и логирование</a></li>
    <li><a href="#автоматизация-деплоя-makefile">Автоматизация деплоя (Makefile)</a></li>
    <li><a href="#преимущества-function-url-vs-api-gateway">Преимущества Function URL vs API Gateway</a></li>
    <li><a href="#заключение">Заключение</a></li>
  </ul>
</nav>
            </nav>
            
        </div>
        <div>
        </div>
    </div>
    

    <div id="post-content">
    <p>Эта статья является продолжением статьи <a href="/ru/post/go-telegram-gemini-ai-bot.html">&ldquo;Создание AI-телеграм бота на Go с Gemini API и AWS Lambda&rdquo;</a> и содержит детальные инструкции по настройке и деплою Telegram бота на AWS Lambda с использованием Function URL.</p>
<h2 id="введение">Введение</h2>
<p>В предыдущей статье мы рассмотрели архитектуру Telegram бота с AI роутером и интеграцией с Gemini API. Теперь мы детально разберём процесс деплоя этого бота на AWS Lambda, включая настройку AWS CLI, создание Lambda функции, настройку Function URL и автоматизацию процесса деплоя.</p>
<h2 id="подготовка-aws-cli-и-аутентификация">Подготовка: AWS CLI и аутентификация</h2>
<p>Перед началом работы с AWS Lambda необходимо установить и настроить AWS CLI. AWS CLI - это унифицированный инструмент командной строки для управления сервисами AWS.</p>
<h3 id="установка-aws-cli">Установка AWS CLI</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># macOS</span>
</span></span><span style="display:flex;"><span>brew install awscli
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Linux</span>
</span></span><span style="display:flex;"><span>curl <span style="color:#e6db74">&#34;https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip&#34;</span> -o <span style="color:#e6db74">&#34;awscliv2.zip&#34;</span>
</span></span><span style="display:flex;"><span>unzip awscliv2.zip
</span></span><span style="display:flex;"><span>sudo ./aws/install
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Проверка установки</span>
</span></span><span style="display:flex;"><span>aws --version
</span></span></code></pre></div><h3 id="настройка-аутентификации">Настройка аутентификации</h3>
<p>AWS CLI использует несколько методов аутентификации. Самый простой и безопасный способ для начала работы - использование AWS IAM Identity Center (ранее AWS SSO) или прямые учетные данные IAM.</p>
<p><strong>Метод 1: AWS IAM Identity Center (рекомендуется для организаций)</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Настройка SSO профиля</span>
</span></span><span style="display:flex;"><span>aws configure sso
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Вам будет предложено:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - SSO start URL: https://your-company.awsapps.com/start</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - SSO region: us-east-1 (или ваш регион)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - SSO account ID: 123456789012</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - SSO role name: AdministratorAccess (или другая роль)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - CLI default region: us-east-1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - CLI default output format: json</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Вход в SSO</span>
</span></span><span style="display:flex;"><span>aws sso login --profile your-profile-name
</span></span></code></pre></div><p><strong>Метод 2: Прямые учетные данные IAM (для личных проектов)</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Настройка учетных данных</span>
</span></span><span style="display:flex;"><span>aws configure
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Вам будет предложено ввести:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># AWS Access Key ID: AKIAIOSFODNN7EXAMPLE</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># AWS Secret Access Key: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Default region name: us-east-1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Default output format: json</span>
</span></span></code></pre></div><h3 id="проверка-подключения">Проверка подключения</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Проверка текущего пользователя/роли</span>
</span></span><span style="display:flex;"><span>aws sts get-caller-identity
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Должен вернуть что-то вроде:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># {</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     &#34;UserId&#34;: &#34;AIDAIOSFODNN7EXAMPLE&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     &#34;Account&#34;: &#34;123456789012&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     &#34;Arn&#34;: &#34;arn:aws:iam::123456789012:user/your-username&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># }</span>
</span></span></code></pre></div><h3 id="работа-с-несколькими-профилями">Работа с несколькими профилями</h3>
<p>Если у вас несколько AWS аккаунтов, вы можете использовать профили:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Создание профиля</span>
</span></span><span style="display:flex;"><span>aws configure --profile production
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Использование профиля</span>
</span></span><span style="display:flex;"><span>aws lambda list-functions --profile production
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Или установка переменной окружения</span>
</span></span><span style="display:flex;"><span>export AWS_PROFILE<span style="color:#f92672">=</span>production
</span></span></code></pre></div><h2 id="архитектура-обработки-запросов">Архитектура обработки запросов</h2>
<p>Перед тем как перейти к созданию Lambda функции, давайте разберём, как AWS обрабатывает запрос от Telegram:</p>
<pre class="mermaid">
  sequenceDiagram
    participant User as Пользователь Telegram
    participant TG as Telegram API
    participant FunctionURL as Lambda Function URL
    participant Lambda as Lambda Function
    participant S3 as AWS S3
    participant Gemini as Google Gemini API
    participant CloudWatch as CloudWatch Logs

    User-&gt;&gt;TG: Отправляет сообщение боту
    TG-&gt;&gt;FunctionURL: POST webhook (JSON update)
    FunctionURL-&gt;&gt;Lambda: Вызывает функцию
    Lambda-&gt;&gt;CloudWatch: Логирует начало выполнения
    
    Lambda-&gt;&gt;S3: Загружает историю разговора (chatID)
    S3--&gt;&gt;Lambda: Возвращает историю (JSON)
    
    Lambda-&gt;&gt;Lambda: Роутер определяет тип запроса
    alt Текстовый запрос
        Lambda-&gt;&gt;Gemini: Chat API запрос с контекстом
        Gemini--&gt;&gt;Lambda: Текстовый ответ
    else Генерация изображения
        Lambda-&gt;&gt;Gemini: Image Generation API
        Gemini--&gt;&gt;Lambda: Изображение
    end
    
    Lambda-&gt;&gt;TG: Отправляет ответ пользователю
    Lambda-&gt;&gt;S3: Сохраняет обновлённую историю
    Lambda-&gt;&gt;CloudWatch: Логирует завершение
    
    Lambda--&gt;&gt;FunctionURL: HTTP 200 OK
    FunctionURL--&gt;&gt;TG: Подтверждение получения
    TG--&gt;&gt;User: Показывает ответ бота
</pre>
<h2 id="подготовка-кода-для-lambda">Подготовка кода для Lambda</h2>
<p>Для работы с Lambda Function URL нам нужно адаптировать код. Function URL использует стандартный HTTP формат, а не формат API Gateway. Вот адаптированный обработчик:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;context&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;encoding/json&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;os&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;github.com/aws/aws-lambda-go/events&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;github.com/aws/aws-lambda-go/lambda&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;github.com/aws/aws-sdk-go-v2/aws&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;github.com/aws/aws-sdk-go-v2/config&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;github.com/aws/aws-sdk-go-v2/service/s3&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">tgbotapi</span> <span style="color:#e6db74">&#34;github.com/go-telegram-bot-api/telegram-bot-api/v5&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;google.golang.org/api/option&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;google.golang.org/api/generativeai&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">bot</span>    <span style="color:#f92672">*</span><span style="color:#a6e22e">tgbotapi</span>.<span style="color:#a6e22e">BotAPI</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gemini</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">generativeai</span>.<span style="color:#a6e22e">Client</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">s3Client</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">s3</span>.<span style="color:#a6e22e">Client</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">init</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Инициализация при холодном старте Lambda</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">cfg</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">loadConfig</span>()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">bot</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">tgbotapi</span>.<span style="color:#a6e22e">NewBotAPI</span>(<span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">TelegramToken</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        panic(<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;Failed to create bot: %v&#34;</span>, <span style="color:#a6e22e">err</span>))
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gemini</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">generativeai</span>.<span style="color:#a6e22e">NewClient</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>(),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">option</span>.<span style="color:#a6e22e">WithAPIKey</span>(<span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">GeminiAPIKey</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        panic(<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;Failed to create Gemini client: %v&#34;</span>, <span style="color:#a6e22e">err</span>))
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Инициализация S3 клиента</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">awsCfg</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">LoadDefaultConfig</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>())
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        panic(<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;Failed to load AWS config: %v&#34;</span>, <span style="color:#a6e22e">err</span>))
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">s3Client</span> = <span style="color:#a6e22e">s3</span>.<span style="color:#a6e22e">NewFromConfig</span>(<span style="color:#a6e22e">awsCfg</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Handler</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">request</span> <span style="color:#a6e22e">events</span>.<span style="color:#a6e22e">LambdaFunctionURLRequest</span>) 
</span></span><span style="display:flex;"><span>    (<span style="color:#a6e22e">events</span>.<span style="color:#a6e22e">LambdaFunctionURLResponse</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Парсинг Telegram webhook обновления</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">update</span> <span style="color:#a6e22e">tgbotapi</span>.<span style="color:#a6e22e">Update</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">Unmarshal</span>([]byte(<span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">Body</span>), <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">update</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">events</span>.<span style="color:#a6e22e">LambdaFunctionURLResponse</span>{
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">StatusCode</span>: <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">StatusBadRequest</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Body</span>:       <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;Invalid request: %v&#34;</span>, <span style="color:#a6e22e">err</span>),
</span></span><span style="display:flex;"><span>        }, <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Обработка обновления асинхронно</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">go</span> <span style="color:#a6e22e">handleMessage</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">update</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Немедленно возвращаем ответ Telegram</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">events</span>.<span style="color:#a6e22e">LambdaFunctionURLResponse</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">StatusCode</span>: <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">StatusOK</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Body</span>:       <span style="color:#e6db74">&#34;OK&#34;</span>,
</span></span><span style="display:flex;"><span>    }, <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">lambda</span>.<span style="color:#a6e22e">Start</span>(<span style="color:#a6e22e">Handler</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="создание-lambda-функции-через-aws-cli">Создание Lambda функции через AWS CLI</h2>
<p>Теперь создадим Lambda функцию используя современный AWS CLI v2:</p>
<h3 id="шаг-1-создание-iam-роли-для-lambda">Шаг 1: Создание IAM роли для Lambda</h3>
<p>Сначала создадим роль, которую будет использовать Lambda функция:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Создание trust policy для Lambda</span>
</span></span><span style="display:flex;"><span>cat &gt; trust-policy.json <span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;Version&#34;: &#34;2012-10-17&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;Statement&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;Effect&#34;: &#34;Allow&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;Principal&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;Service&#34;: &#34;lambda.amazonaws.com&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;Action&#34;: &#34;sts:AssumeRole&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Создание роли</span>
</span></span><span style="display:flex;"><span>aws iam create-role <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --role-name telegram-bot-lambda-role <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --assume-role-policy-document file://trust-policy.json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Прикрепление базовой политики для выполнения Lambda</span>
</span></span><span style="display:flex;"><span>aws iam attach-role-policy <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --role-name telegram-bot-lambda-role <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --policy-arn arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Создание политики для доступа к S3</span>
</span></span><span style="display:flex;"><span>cat &gt; s3-policy.json <span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;Version&#34;: &#34;2012-10-17&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;Statement&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;Effect&#34;: &#34;Allow&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;Action&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;s3:GetObject&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;s3:PutObject&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      ],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;Resource&#34;: &#34;arn:aws:s3:::bot-conversations/*&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>aws iam put-role-policy <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --role-name telegram-bot-lambda-role <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --policy-name S3AccessPolicy <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --policy-document file://s3-policy.json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Получение ARN роли (нужен для создания функции)</span>
</span></span><span style="display:flex;"><span>ROLE_ARN<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>aws iam get-role <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --role-name telegram-bot-lambda-role <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --query <span style="color:#e6db74">&#39;Role.Arn&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --output text<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;Role ARN: </span>$ROLE_ARN<span style="color:#e6db74">&#34;</span>
</span></span></code></pre></div><h3 id="шаг-2-создание-s3-бакета-для-разговоров-опционально">Шаг 2: Создание S3 бакета для разговоров (опционально)</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Создание бакета (имена бакетов должны быть глобально уникальными)</span>
</span></span><span style="display:flex;"><span>BUCKET_NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;telegram-bot-conversations-</span><span style="color:#66d9ef">$(</span>date +%s<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>aws s3 mb s3://$BUCKET_NAME --region us-east-1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Сохранение имени бакета для дальнейшего использования</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;BUCKET_NAME=</span>$BUCKET_NAME<span style="color:#e6db74">&#34;</span> &gt; .env.bucket
</span></span></code></pre></div><h3 id="шаг-3-сборка-go-приложения">Шаг 3: Сборка Go приложения</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Сборка для Linux (требуется для Lambda)</span>
</span></span><span style="display:flex;"><span>GOOS<span style="color:#f92672">=</span>linux GOARCH<span style="color:#f92672">=</span>amd64 CGO_ENABLED<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> go build -o bootstrap
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Создание ZIP архива (Lambda требует именно bootstrap как имя исполняемого файла)</span>
</span></span><span style="display:flex;"><span>zip <span style="color:#66d9ef">function</span>.zip bootstrap
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Проверка размера (Lambda имеет ограничение на размер deployment package)</span>
</span></span><span style="display:flex;"><span>ls -lh <span style="color:#66d9ef">function</span>.zip
</span></span></code></pre></div><h3 id="шаг-4-создание-lambda-функции">Шаг 4: Создание Lambda функции</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Создание функции (замените $ROLE_ARN на значение из предыдущего шага)</span>
</span></span><span style="display:flex;"><span>aws lambda create-function <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --function-name telegram-bot <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --runtime provided.al2023 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --role $ROLE_ARN <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --handler bootstrap <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --zip-file fileb://function.zip <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --timeout <span style="color:#ae81ff">30</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --memory-size <span style="color:#ae81ff">512</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --architectures arm64 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --environment Variables<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    TELEGRAM_TOKEN=your-telegram-token,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    GEMINI_API_KEY=your-gemini-api-key,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    S3_BUCKET=</span>$BUCKET_NAME<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --description <span style="color:#e6db74">&#34;Telegram bot with Gemini AI integration&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Проверка создания функции</span>
</span></span><span style="display:flex;"><span>aws lambda get-function --function-name telegram-bot
</span></span></code></pre></div><p><strong>Важные параметры:</strong></p>
<ul>
<li><code>--runtime provided.al2023</code>: Использует Amazon Linux 2023 runtime для Go</li>
<li><code>--architectures arm64</code>: Использует ARM64 архитектуру (дешевле и быстрее)</li>
<li><code>--timeout 30</code>: Максимальное время выполнения (секунды)</li>
<li><code>--memory-size 512</code>: Выделенная память (MB). Больше памяти = больше CPU</li>
</ul>
<h2 id="создание-lambda-function-url">Создание Lambda Function URL</h2>
<p>Lambda Function URL - это простой способ предоставить HTTP(S) endpoint для Lambda функции без необходимости настраивать API Gateway. Это идеально подходит для Telegram webhook:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Создание Function URL с CORS (если нужно)</span>
</span></span><span style="display:flex;"><span>aws lambda create-function-url-config <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --function-name telegram-bot <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --auth-type NONE <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --cors <span style="color:#e6db74">&#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;AllowOrigins&#34;: [&#34;*&#34;],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;AllowMethods&#34;: [&#34;POST&#34;],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;AllowHeaders&#34;: [&#34;content-type&#34;],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;MaxAge&#34;: 300
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Получение URL функции</span>
</span></span><span style="display:flex;"><span>FUNCTION_URL<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>aws lambda get-function-url-config <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --function-name telegram-bot <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --query <span style="color:#e6db74">&#39;FunctionUrl&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --output text<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;Function URL: </span>$FUNCTION_URL<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Добавление разрешения на публичный доступ</span>
</span></span><span style="display:flex;"><span>aws lambda add-permission <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --function-name telegram-bot <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --statement-id FunctionURLAllowPublicAccess <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --action lambda:InvokeFunctionUrl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --principal <span style="color:#e6db74">&#34;*&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --function-url-auth-type NONE
</span></span></code></pre></div><p><strong>Типы аутентификации Function URL:</strong></p>
<ul>
<li><code>NONE</code>: Публичный доступ (подходит для Telegram webhook)</li>
<li><code>AWS_IAM</code>: Требует подпись AWS Signature Version 4</li>
</ul>
<h2 id="настройка-telegram-webhook">Настройка Telegram Webhook</h2>
<p>Теперь настроим Telegram для отправки обновлений на наш Function URL:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Установка webhook</span>
</span></span><span style="display:flex;"><span>TELEGRAM_TOKEN<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;your-telegram-bot-token&#34;</span>
</span></span><span style="display:flex;"><span>curl -X POST <span style="color:#e6db74">&#34;https://api.telegram.org/bot</span><span style="color:#e6db74">${</span>TELEGRAM_TOKEN<span style="color:#e6db74">}</span><span style="color:#e6db74">/setWebhook&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -H <span style="color:#e6db74">&#34;Content-Type: application/json&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -d <span style="color:#e6db74">&#34;{\&#34;url\&#34;: \&#34;</span><span style="color:#e6db74">${</span>FUNCTION_URL<span style="color:#e6db74">}</span><span style="color:#e6db74">\&#34;}&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Проверка статуса webhook</span>
</span></span><span style="display:flex;"><span>curl <span style="color:#e6db74">&#34;https://api.telegram.org/bot</span><span style="color:#e6db74">${</span>TELEGRAM_TOKEN<span style="color:#e6db74">}</span><span style="color:#e6db74">/getWebhookInfo&#34;</span>
</span></span></code></pre></div><h2 id="обновление-кода-функции-деплой">Обновление кода функции (деплой)</h2>
<p>Когда вам нужно обновить код функции:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Пересборка</span>
</span></span><span style="display:flex;"><span>GOOS<span style="color:#f92672">=</span>linux GOARCH<span style="color:#f92672">=</span>arm64 CGO_ENABLED<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> go build -o bootstrap
</span></span><span style="display:flex;"><span>zip <span style="color:#66d9ef">function</span>.zip bootstrap
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Обновление кода функции</span>
</span></span><span style="display:flex;"><span>aws lambda update-function-code <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --function-name telegram-bot <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --zip-file fileb://function.zip <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --architectures arm64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Обновление переменных окружения (если нужно)</span>
</span></span><span style="display:flex;"><span>aws lambda update-function-configuration <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --function-name telegram-bot <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --environment Variables<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    TELEGRAM_TOKEN=your-new-token,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    GEMINI_API_KEY=your-new-key,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    S3_BUCKET=</span>$BUCKET_NAME<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Ожидание завершения обновления</span>
</span></span><span style="display:flex;"><span>aws lambda wait <span style="color:#66d9ef">function</span>-updated --function-name telegram-bot
</span></span></code></pre></div><h2 id="мониторинг-и-логирование">Мониторинг и логирование</h2>
<p>AWS Lambda автоматически отправляет логи в CloudWatch:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Просмотр последних логов</span>
</span></span><span style="display:flex;"><span>aws logs tail /aws/lambda/telegram-bot --follow
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Просмотр метрик функции</span>
</span></span><span style="display:flex;"><span>aws cloudwatch get-metric-statistics <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --namespace AWS/Lambda <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --metric-name Invocations <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --dimensions Name<span style="color:#f92672">=</span>FunctionName,Value<span style="color:#f92672">=</span>telegram-bot <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --start-time <span style="color:#66d9ef">$(</span>date -u -d <span style="color:#e6db74">&#39;1 hour ago&#39;</span> +%Y-%m-%dT%H:%M:%S<span style="color:#66d9ef">)</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --end-time <span style="color:#66d9ef">$(</span>date -u +%Y-%m-%dT%H:%M:%S<span style="color:#66d9ef">)</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --period <span style="color:#ae81ff">300</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --statistics Sum
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Просмотр информации о функции</span>
</span></span><span style="display:flex;"><span>aws lambda get-function <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --function-name telegram-bot <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --query <span style="color:#e6db74">&#39;Configuration.[FunctionName,Runtime,LastModified,MemorySize,Timeout]&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --output table
</span></span></code></pre></div><h2 id="автоматизация-деплоя-makefile">Автоматизация деплоя (Makefile)</h2>
<p>Для упрощения процесса деплоя можно создать Makefile:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#a6e22e">.PHONY</span><span style="color:#f92672">:</span> build deploy update logs clean
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>FUNCTION_NAME<span style="color:#f92672">=</span>telegram-bot
</span></span><span style="display:flex;"><span>REGION<span style="color:#f92672">=</span>us-east-1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">build</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#e6db74">&#34;Building for Lambda...&#34;</span>
</span></span><span style="display:flex;"><span>	GOOS<span style="color:#f92672">=</span>linux GOARCH<span style="color:#f92672">=</span>arm64 CGO_ENABLED<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> go build -o bootstrap
</span></span><span style="display:flex;"><span>	zip <span style="color:#66d9ef">function</span>.zip bootstrap
</span></span><span style="display:flex;"><span>	@echo <span style="color:#e6db74">&#34;Build complete. Size:&#34;</span>
</span></span><span style="display:flex;"><span>	@ls -lh <span style="color:#66d9ef">function</span>.zip
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">deploy</span><span style="color:#f92672">:</span> build
</span></span><span style="display:flex;"><span>	@echo <span style="color:#e6db74">&#34;Deploying to Lambda...&#34;</span>
</span></span><span style="display:flex;"><span>	aws lambda update-function-code <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>		--function-name <span style="color:#66d9ef">$(</span>FUNCTION_NAME<span style="color:#66d9ef">)</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>		--zip-file fileb://function.zip <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>		--region <span style="color:#66d9ef">$(</span>REGION<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#e6db74">&#34;Waiting for update to complete...&#34;</span>
</span></span><span style="display:flex;"><span>	aws lambda wait <span style="color:#66d9ef">function</span>-updated <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>		--function-name <span style="color:#66d9ef">$(</span>FUNCTION_NAME<span style="color:#66d9ef">)</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>		--region <span style="color:#66d9ef">$(</span>REGION<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#e6db74">&#34;Deployment complete!&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">update-env</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#e6db74">&#34;Updating environment variables...&#34;</span>
</span></span><span style="display:flex;"><span>	aws lambda update-function-configuration <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>		--function-name <span style="color:#66d9ef">$(</span>FUNCTION_NAME<span style="color:#66d9ef">)</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>		--environment Variables<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{TELEGRAM_TOKEN=</span><span style="color:#66d9ef">$(</span>TELEGRAM_TOKEN<span style="color:#66d9ef">)</span><span style="color:#e6db74">,GEMINI_API_KEY=</span><span style="color:#66d9ef">$(</span>GEMINI_API_KEY<span style="color:#66d9ef">)</span><span style="color:#e6db74">,S3_BUCKET=</span><span style="color:#66d9ef">$(</span>S3_BUCKET<span style="color:#66d9ef">)</span><span style="color:#e6db74">}&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>		--region <span style="color:#66d9ef">$(</span>REGION<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">logs</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#e6db74">&#34;Tailing logs...&#34;</span>
</span></span><span style="display:flex;"><span>	aws logs tail /aws/lambda/<span style="color:#66d9ef">$(</span>FUNCTION_NAME<span style="color:#66d9ef">)</span> --follow --region <span style="color:#66d9ef">$(</span>REGION<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">clean</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	rm -f bootstrap <span style="color:#66d9ef">function</span>.zip
</span></span><span style="display:flex;"><span>	@echo <span style="color:#e6db74">&#34;Clean complete&#34;</span>
</span></span></code></pre></div><p>Использование:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Установка переменных окружения</span>
</span></span><span style="display:flex;"><span>export TELEGRAM_TOKEN<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;your-token&#34;</span>
</span></span><span style="display:flex;"><span>export GEMINI_API_KEY<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;your-key&#34;</span>
</span></span><span style="display:flex;"><span>export S3_BUCKET<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;your-bucket-name&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Сборка и деплой</span>
</span></span><span style="display:flex;"><span>make deploy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Просмотр логов</span>
</span></span><span style="display:flex;"><span>make logs
</span></span></code></pre></div><h2 id="преимущества-function-url-vs-api-gateway">Преимущества Function URL vs API Gateway</h2>
<p><strong>Lambda Function URL:</strong></p>
<ul>
<li>✅ Проще настроить (один AWS CLI вызов)</li>
<li>✅ Ниже задержка (нет промежуточного слоя)</li>
<li>✅ Дешевле (нет платы за API Gateway)</li>
<li>✅ Идеально для простых webhook</li>
</ul>
<p><strong>API Gateway:</strong></p>
<ul>
<li>✅ Больше возможностей (rate limiting, API keys, caching)</li>
<li>✅ Поддержка REST и WebSocket</li>
<li>✅ Интеграция с другими AWS сервисами</li>
<li>✅ Лучше для публичных API</li>
</ul>
<p>Для Telegram бота Function URL - оптимальный выбор благодаря простоте и экономичности.</p>
<h2 id="заключение">Заключение</h2>
<p>В этой статье мы рассмотрели детальный процесс деплоя Telegram бота на AWS Lambda с использованием Function URL. Мы настроили AWS CLI, создали IAM роли, развернули Lambda функцию и настроили webhook интеграцию с Telegram. Использование Function URL упрощает процесс по сравнению с API Gateway и делает деплой более экономичным для простых webhook сценариев.</p>
<p>Для получения дополнительной информации о создании самого бота и его архитектуре, обратитесь к предыдущей статье: <a href="/ru/post/go-telegram-gemini-ai-bot.html">&ldquo;Создание AI-телеграм бота на Go с Gemini API и AWS Lambda&rdquo;</a>.</p>
    
  <div>
    <div>Tags:</div>
    <ul>
        <li><a href="/ru/tags/go/">Go</a></li>
        <li><a href="/ru/tags/telegram/">Telegram</a></li>
        <li><a href="/ru/tags/aws/">Aws</a></li>
        <li><a href="/ru/tags/lambda/">Lambda</a></li>
        <li><a href="/ru/tags/deploy/">Deploy</a></li>
        <li><a href="/ru/tags/function-url/">Function-Url</a></li>
        <li><a href="/ru/tags/cli/">Cli</a></li>
    </ul>
  </div>

    </div>
    
<div id="article-quiz" class="mt-5 mb-5" data-quiz-lang="ru">
  <hr class="mb-4">
  <h3 class="mb-4">Проверьте свои знания</h3>
  
  <form id="quiz-form" data-quiz-data="{&#34;questions&#34;:[{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;provided.al2023&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;go1.x&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;go1.21&#34;}],&#34;question&#34;:&#34;Какой runtime используется для Go функций в AWS Lambda?&#34;,&#34;type&#34;:&#34;single-choice&#34;},{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;arm64 (дешевле и быстрее)&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;x86_64&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;Не имеет значения&#34;}],&#34;question&#34;:&#34;Какая архитектура предпочтительнее для Lambda функций на Go?&#34;,&#34;type&#34;:&#34;single-choice&#34;},{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;NONE (публичный доступ)&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;AWS_IAM&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;OAuth&#34;}],&#34;question&#34;:&#34;Какой тип аутентификации Function URL используется для Telegram webhook?&#34;,&#34;type&#34;:&#34;single-choice&#34;},{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;bootstrap&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;main&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;handler&#34;}],&#34;question&#34;:&#34;Какое имя исполняемого файла требуется для Lambda функции на Go?&#34;,&#34;type&#34;:&#34;single-choice&#34;},{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;Проще настроить&#34;},{&#34;correct&#34;:true,&#34;text&#34;:&#34;Ниже задержка&#34;},{&#34;correct&#34;:true,&#34;text&#34;:&#34;Дешевле&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;Больше возможностей для rate limiting&#34;}],&#34;question&#34;:&#34;Какие преимущества имеет Lambda Function URL по сравнению с API Gateway?&#34;,&#34;type&#34;:&#34;multiple-choice&#34;},{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;aws sts get-caller-identity&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;aws configure list&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;aws login&#34;}],&#34;question&#34;:&#34;Как проверить подключение к AWS после настройки CLI?&#34;,&#34;type&#34;:&#34;single-choice&#34;},{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;AWS CloudWatch Logs&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;S3&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;DynamoDB&#34;}],&#34;question&#34;:&#34;Где хранятся логи Lambda функций?&#34;,&#34;type&#34;:&#34;single-choice&#34;},{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;AWS IAM Identity Center (SSO)&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;Прямые IAM учетные данные&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;SSH ключи&#34;}],&#34;question&#34;:&#34;Какой метод аутентификации AWS CLI рекомендуется для организаций?&#34;,&#34;type&#34;:&#34;single-choice&#34;}]}">
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="0">
      <h5 class="mb-3">1. Какой runtime используется для Go функций в AWS Lambda?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-0" 
                 value="0"
                 id="q0-a0">
          <label class="form-check-label" for="q0-a0">
            provided.al2023
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-0" 
                 value="1"
                 id="q0-a1">
          <label class="form-check-label" for="q0-a1">
            go1.x
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-0" 
                 value="2"
                 id="q0-a2">
          <label class="form-check-label" for="q0-a2">
            go1.21
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="1">
      <h5 class="mb-3">2. Какая архитектура предпочтительнее для Lambda функций на Go?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-1" 
                 value="0"
                 id="q1-a0">
          <label class="form-check-label" for="q1-a0">
            arm64 (дешевле и быстрее)
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-1" 
                 value="1"
                 id="q1-a1">
          <label class="form-check-label" for="q1-a1">
            x86_64
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-1" 
                 value="2"
                 id="q1-a2">
          <label class="form-check-label" for="q1-a2">
            Не имеет значения
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="2">
      <h5 class="mb-3">3. Какой тип аутентификации Function URL используется для Telegram webhook?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-2" 
                 value="0"
                 id="q2-a0">
          <label class="form-check-label" for="q2-a0">
            NONE (публичный доступ)
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-2" 
                 value="1"
                 id="q2-a1">
          <label class="form-check-label" for="q2-a1">
            AWS_IAM
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-2" 
                 value="2"
                 id="q2-a2">
          <label class="form-check-label" for="q2-a2">
            OAuth
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="3">
      <h5 class="mb-3">4. Какое имя исполняемого файла требуется для Lambda функции на Go?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-3" 
                 value="0"
                 id="q3-a0">
          <label class="form-check-label" for="q3-a0">
            bootstrap
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-3" 
                 value="1"
                 id="q3-a1">
          <label class="form-check-label" for="q3-a1">
            main
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-3" 
                 value="2"
                 id="q3-a2">
          <label class="form-check-label" for="q3-a2">
            handler
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="4">
      <h5 class="mb-3">5. Какие преимущества имеет Lambda Function URL по сравнению с API Gateway?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-4" 
                 value="0"
                 id="q4-a0">
          <label class="form-check-label" for="q4-a0">
            Проще настроить
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-4" 
                 value="1"
                 id="q4-a1">
          <label class="form-check-label" for="q4-a1">
            Ниже задержка
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-4" 
                 value="2"
                 id="q4-a2">
          <label class="form-check-label" for="q4-a2">
            Дешевле
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-4" 
                 value="3"
                 id="q4-a3">
          <label class="form-check-label" for="q4-a3">
            Больше возможностей для rate limiting
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="5">
      <h5 class="mb-3">6. Как проверить подключение к AWS после настройки CLI?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-5" 
                 value="0"
                 id="q5-a0">
          <label class="form-check-label" for="q5-a0">
            aws sts get-caller-identity
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-5" 
                 value="1"
                 id="q5-a1">
          <label class="form-check-label" for="q5-a1">
            aws configure list
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-5" 
                 value="2"
                 id="q5-a2">
          <label class="form-check-label" for="q5-a2">
            aws login
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="6">
      <h5 class="mb-3">7. Где хранятся логи Lambda функций?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-6" 
                 value="0"
                 id="q6-a0">
          <label class="form-check-label" for="q6-a0">
            AWS CloudWatch Logs
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-6" 
                 value="1"
                 id="q6-a1">
          <label class="form-check-label" for="q6-a1">
            S3
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-6" 
                 value="2"
                 id="q6-a2">
          <label class="form-check-label" for="q6-a2">
            DynamoDB
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="7">
      <h5 class="mb-3">8. Какой метод аутентификации AWS CLI рекомендуется для организаций?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-7" 
                 value="0"
                 id="q7-a0">
          <label class="form-check-label" for="q7-a0">
            AWS IAM Identity Center (SSO)
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-7" 
                 value="1"
                 id="q7-a1">
          <label class="form-check-label" for="q7-a1">
            Прямые IAM учетные данные
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-7" 
                 value="2"
                 id="q7-a2">
          <label class="form-check-label" for="q7-a2">
            SSH ключи
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    
    <button type="button" class="btn btn-primary" id="check-answers">
      Проверить ответы
    </button>
    <button type="button" class="btn btn-secondary ml-2" id="reset-quiz" style="display: none;">
      Сбросить
    </button>
  </form>
  
  <div id="quiz-results" class="mt-4" style="display: none;">
    <div class="alert" role="alert"></div>
  </div>
</div>

<script>
(function() {
  try {
    const quizContainer = document.getElementById('article-quiz');
    const form = document.getElementById('quiz-form');
    const checkBtn = document.getElementById('check-answers');
    const resetBtn = document.getElementById('reset-quiz');
    const resultsDiv = document.getElementById('quiz-results');
    
    if (!quizContainer || !form || !checkBtn) {
      console.error('Quiz initialization failed: missing elements', {
        quizContainer: !!quizContainer,
        form: !!form,
        checkBtn: !!checkBtn
      });
      return;
    }
    
    const lang = quizContainer.getAttribute('data-quiz-lang') || 'en';
    const quizDataRaw = form.getAttribute('data-quiz-data');
    
    if (!quizDataRaw) {
      console.error('Quiz data not found in data attribute');
      return;
    }
    
    let quizData;
    try {
      quizData = JSON.parse(quizDataRaw);
    } catch (e) {
      console.error('Failed to parse quiz data:', e, quizDataRaw);
      return;
    }
    
    if (!quizData || !quizData.questions || !Array.isArray(quizData.questions)) {
      console.error('Invalid quiz data structure:', quizData);
      return;
    }
    
    
    console.log('Quiz data loaded:', quizData);
  
    function arraysEqual(a, b) {
      if (!a || !b) return false;
      if (a.length !== b.length) return false;
      const sortedA = [...a].sort();
      const sortedB = [...b].sort();
      return sortedA.every((val, i) => val === sortedB[i]);
    }
    
    checkBtn.addEventListener('click', function() {
    if (!quizData.questions || !Array.isArray(quizData.questions)) {
      console.error('Invalid quiz data structure');
      return;
    }
    
    let correctCount = 0;
    let totalQuestions = quizData.questions.length;
    
    quizData.questions.forEach((question, qIndex) => {
      const questionDiv = form.querySelector(`[data-question-index="${qIndex}"]`);
      if (!questionDiv) {
        console.error('Question div not found for index:', qIndex);
        return;
      }
      
      const feedbackDiv = questionDiv.querySelector('.quiz-feedback');
      if (!feedbackDiv) {
        console.error('Feedback div not found for question:', qIndex);
        return;
      }
      
      if (question.type === 'multiple-choice' || question.type === 'single-choice') {
        if (!question.answers || !Array.isArray(question.answers)) {
          console.error('Invalid answers for question:', qIndex);
          return;
        }
        
        const inputs = questionDiv.querySelectorAll(`input[name="question-${qIndex}"]`);
        const selectedAnswers = Array.from(inputs)
          .filter(input => input.checked)
          .map(input => parseInt(input.value));
        
        const correctAnswers = question.answers
          .map((answer, index) => answer.correct === true ? index : -1)
          .filter(index => index !== -1);
        
        const isCorrect = arraysEqual(selectedAnswers, correctAnswers);
        
        if (isCorrect) {
          correctCount++;
          feedbackDiv.innerHTML = '<span class="text-success">✓ ' + (lang === 'ru' ? 'Правильно!' : 'Correct!') + '</span>';
          feedbackDiv.style.display = 'block';
          inputs.forEach(input => {
            const answerIndex = parseInt(input.value);
            const answer = question.answers[answerIndex];
            if (!answer) return;
            
            if (input.checked && answer.correct === true) {
              input.parentElement.classList.add('text-success');
            } else if (input.checked && answer.correct !== true) {
              input.parentElement.classList.add('text-danger');
            } else if (!input.checked && answer.correct === true) {
              input.parentElement.classList.add('text-warning');
            }
          });
        } else {
          feedbackDiv.innerHTML = '<span class="text-danger">✗ ' + (lang === 'ru' ? 'Неправильно' : 'Incorrect') + '</span>';
          feedbackDiv.style.display = 'block';
          inputs.forEach(input => {
            const answerIndex = parseInt(input.value);
            const answer = question.answers[answerIndex];
            if (!answer) return;
            
            if (input.checked && answer.correct !== true) {
              input.parentElement.classList.add('text-danger');
            } else if (!input.checked && answer.correct === true) {
              input.parentElement.classList.add('text-warning');
            }
          });
        }
      } else if (question.type === 'text') {
        const textarea = questionDiv.querySelector('textarea');
        const correctAnswerDiv = questionDiv.querySelector('[data-correct-answer]');
        
        if (!textarea || !question.correct_answer) {
          console.error('Invalid text question:', qIndex);
          return;
        }
        
        if (textarea.value.trim().toLowerCase() === question.correct_answer.toLowerCase()) {
          correctCount++;
          feedbackDiv.innerHTML = '<span class="text-success">✓ ' + (lang === 'ru' ? 'Правильно!' : 'Correct!') + '</span>';
          feedbackDiv.style.display = 'block';
        } else {
          feedbackDiv.innerHTML = '<span class="text-danger">✗ ' + (lang === 'ru' ? 'Неправильно' : 'Incorrect') + '</span>';
          feedbackDiv.style.display = 'block';
          if (correctAnswerDiv) {
            correctAnswerDiv.style.display = 'block';
          }
        }
      }
    });
    
    const percentage = Math.round((correctCount / totalQuestions) * 100);
    const alertClass = percentage >= 70 ? 'alert-success' : percentage >= 50 ? 'alert-warning' : 'alert-danger';
    const message = (lang === 'ru' ? 'Вы ответили правильно на ' : 'You got ') + 
                   correctCount + (lang === 'ru' ? ' из ' : ' out of ') + 
                   totalQuestions + (lang === 'ru' ? ' вопросов (' : ' questions (') + 
                   percentage + '%)';
    
    const alertElement = resultsDiv.querySelector('.alert');
    if (alertElement) {
      alertElement.className = 'alert ' + alertClass;
      alertElement.textContent = message;
    }
      resultsDiv.style.display = 'block';
      checkBtn.style.display = 'none';
      if (resetBtn) {
        resetBtn.style.display = 'inline-block';
      }
    });
    
    if (resetBtn) {
      resetBtn.addEventListener('click', function() {
        form.reset();
        form.querySelectorAll('.quiz-feedback').forEach(el => el.style.display = 'none');
        form.querySelectorAll('.text-success, .text-danger, .text-warning').forEach(el => {
          el.classList.remove('text-success', 'text-danger', 'text-warning');
        });
        form.querySelectorAll('[data-correct-answer]').forEach(el => el.style.display = 'none');
        resultsDiv.style.display = 'none';
        checkBtn.style.display = 'inline-block';
        resetBtn.style.display = 'none';
      });
    }
  } catch (error) {
    console.error('Quiz script error:', error);
  }
})();
</script>



    
    <hr class="mt-5 mb-4">
    <h3 class="mb-4">Похожие статьи</h3>
    <div class="row">
      <div class="col-md-6 mb-4">
        <div class="card h-100 bg-light rounded" style="border: none;">
          <div class="card-body">
            <span style="color: #aaa; font-size: 0.9em;">


  19 декабря 2024 г.


</span>
            <h4 class="card-title mt-2">
              <a href="/ru/post/go-telegram-gemini-ai-bot.html" style="text-decoration: none; color: inherit;">Создание AI-телеграм бота на Go с Gemini API и AWS Lambda</a>
            </h4>
            
            
            
            
            <p class="card-text"><p>В этой статье мы рассмотрим, как создать интеллектуального Telegram бота на Go, который выступает в роли прокси между пользователями и API Google Gemini. Бот будет выполнять две основные функции: отвечать на сообщения пользователей и генерировать изображения. Хотя этот механизм может быть существенно расширен дополнительными возможностями, такими как генерация голоса и видео, мы сосредоточимся на этих двух типах запросов для простоты.</p></p>
            
            <a href="/ru/post/go-telegram-gemini-ai-bot.html" class="btn btn-primary btn-sm">Read More →</a>
                  <a href="/ru/tags/go/" class="badge">Go</a>
                  <a href="/ru/tags/telegram/" class="badge">Telegram</a>
                  <a href="/ru/tags/gemini/" class="badge">Gemini</a>
                  <a href="/ru/tags/ai/" class="badge">Ai</a>
                  <a href="/ru/tags/aws/" class="badge">Aws</a>
                  <a href="/ru/tags/lambda/" class="badge">Lambda</a>
                  <a href="/ru/tags/bot/" class="badge">Bot</a>
          </div>
        </div>
      </div>
      <div class="col-md-6 mb-4">
        <div class="card h-100 bg-light rounded" style="border: none;">
          <div class="card-body">
            <span style="color: #aaa; font-size: 0.9em;">


  1 июля 2020 г.


</span>
            <h4 class="card-title mt-2">
              <a href="/ru/post/deploy-docker-swarm-gitlab.html" style="text-decoration: none; color: inherit;">Деплой docker swarm из Gitlab CI</a>
            </h4>
            
            
            
            <a href="/ru/post/deploy-docker-swarm-gitlab.html">
              <img class="card-img-top mb-3 rounded"
                   src="/en/post/deploy-docker-swarm-gitlab/docker.svg"
                   style="max-height: 200px;"
                   alt="Деплой docker swarm из Gitlab CI"/>
            </a>
            
            
            <p class="card-text"><p>Ранее мы рассматривали деплой бинарного файла программы через SSH на сервер</p>
<p>Сейчас мы рассмотрим как реализовать деплой Docker контейнера из Gitlab CI.</p></p>
            
            <a href="/ru/post/deploy-docker-swarm-gitlab.html" class="btn btn-primary btn-sm">Read More →</a>
                  <a href="/ru/tags/docker/" class="badge">Docker</a>
                  <a href="/ru/tags/deploy/" class="badge">Deploy</a>
                  <a href="/ru/tags/gitlab/" class="badge">Gitlab</a>
                  <a href="/ru/tags/ci/cd/" class="badge">Ci/Cd</a>
          </div>
        </div>
      </div>
      <div class="col-md-6 mb-4">
        <div class="card h-100 bg-light rounded" style="border: none;">
          <div class="card-body">
            <span style="color: #aaa; font-size: 0.9em;">


  8 мая 2020 г.


</span>
            <h4 class="card-title mt-2">
              <a href="/ru/post/go-build-and-deploy-ssh-gitlab.html" style="text-decoration: none; color: inherit;">Компиляция и деплой через SSH в GitLab CI</a>
            </h4>
            
            
            
            <a href="/ru/post/go-build-and-deploy-ssh-gitlab.html">
              <img class="card-img-top mb-3 rounded"
                   src="/en/post/go-build-and-deploy-ssh-gitlab/gitlab_logo.svg"
                   style="max-height: 200px;"
                   alt="Компиляция и деплой через SSH в GitLab CI"/>
            </a>
            
            
            <p class="card-text"><p>Давайте рассмотрим, как работает компиляция Go и как использовать GitLab CI для этого.</p></p>
            
            <a href="/ru/post/go-build-and-deploy-ssh-gitlab.html" class="btn btn-primary btn-sm">Read More →</a>
                  <a href="/ru/tags/gitlab/" class="badge">Gitlab</a>
                  <a href="/ru/tags/compilation/" class="badge">Compilation</a>
                  <a href="/ru/tags/deploy/" class="badge">Deploy</a>
                  <a href="/ru/tags/ssh/" class="badge">Ssh</a>
                  <a href="/ru/tags/modules/" class="badge">Modules</a>
                  <a href="/ru/tags/vendor/" class="badge">Vendor</a>
                  <a href="/ru/tags/ci/cd/" class="badge">Ci/Cd</a>
          </div>
        </div>
      </div>
    </div>


    <script defer src="/discuss.js"></script>
    <div id="discuss"></div>
</div>

</div>

<div class="bg-light">&nbsp;</div>

<footer>
    <div class="container " style="padding-top: 0; padding-bottom: 10px;">
    <div class="container">
        <img src="/niz.svg" alt="gopher legs" style="height: 50px; vertical-align: top;"/>
        <div style="text-align: right; vertical-align: top; display: inline-block;">
            
            &nbsp;
            &nbsp;
            &nbsp;
            
            
            <a href='/en/post/go-telegram-bot-aws-lambda-deploy.html'>
            <span class="flag-icon flag-icon-us"></span>
            </a>
            
        </div>

    </div>
</div>

</footer>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script defer src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

</body>
</html>
