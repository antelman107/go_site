

<!DOCTYPE html>
<html lang="ru-ru" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=51376&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="content-type" content="text/html; charset=utf-8" />

<title>Удалённая отладка с Delve | Golang for all</title>




  






  
  








  



<meta name="description" content="Ранее мы обсуждали локальную отладку с помощью IDE GoLand. Теперь мы обсудим, как удалённо отлаживать программу, работающую внутри Docker-контейнера, используя …">


<meta property="og:type" content="article">
<meta property="og:url" content="http://localhost:51376/ru/post/go-docker-delve-remote-debug.html">
<meta property="og:title" content="Удалённая отладка с Delve | Golang for all">
<meta property="og:description" content="Ранее мы обсуждали локальную отладку с помощью IDE GoLand. Теперь мы обсудим, как удалённо отлаживать программу, работающую внутри Docker-контейнера, используя …">
<meta property="og:image" content="http://localhost:51376//gopher.png">
<meta property="og:site_name" content="Golang for all">
<meta property="og:locale" content="ru">

  
    <meta property="article:published_time" content="2020-07-01T09:00:00-07:00">
  
  
    <meta property="article:modified_time" content="2020-07-01T09:00:00-07:00">
  
  
    
      <meta property="article:tag" content="Docker">
    
      <meta property="article:tag" content="Debugger">
    
      <meta property="article:tag" content="Delve">
    
      <meta property="article:tag" content="Vscode">
    
      <meta property="article:tag" content="Goland">
    
  



<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:url" content="http://localhost:51376/ru/post/go-docker-delve-remote-debug.html">
<meta name="twitter:title" content="Удалённая отладка с Delve | Golang for all">
<meta name="twitter:description" content="Ранее мы обсуждали локальную отладку с помощью IDE GoLand. Теперь мы обсудим, как удалённо отлаживать программу, работающую внутри Docker-контейнера, используя …">
<meta name="twitter:image" content="http://localhost:51376//gopher.png">



<link rel="canonical" href="http://localhost:51376/ru/post/go-docker-delve-remote-debug.html">



  <link rel="alternate" hreflang="en" href="http://localhost:51376/en/post/go-docker-delve-remote-debug.html">


<meta name="yandex-verification" content="10233a4b32f4dc29" />
<meta name="yandex-verification" content="cfa4be404c1af368" />

<link rel="icon" type="image/png" sizes="93x93" href="/gophereye.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="/gophereye32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/gophereye16x16.png">


    <link rel="stylesheet" href="/css/main.css">


      <script src="/js/main.js"></script>


<link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.4.6/css/flag-icon.min.css" integrity="sha256-YjcCvXkdRVOucibC9I4mBS41lXPrWfqY2BnpskhZPnw=" crossorigin="anonymous" />


</head>
<body>
<div class="container">
    <nav class="navbar navbar-expand-lg navbar-light" style="padding-bottom: 0;">
        <div class="container">
            <a class="navbar-brand" href="/ru/" style="padding-bottom: 0">
                <img src="/verh.svg" alt="gopher eyes" style="height: 50px;"/>
            </a>

            <button class="navbar-toggler" type="button"
                    data-toggle="collapse"
                    data-target="#navbarResponsive"
                    aria-controls="navbarResponsive"
                    aria-expanded="false"
                    aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <a href="/ru/" style="color:#000;"><span class="gopherchat">Golang для всех</span></a>
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="/ru/about.html">О сайте</a>
                    </li>
                    
                </ul>
            </div>
        </div>
    </nav>
</div>
<div class="bg-light">&nbsp;</div>

<div class="container">
    
<div class="col-lg-12">
    
    <h1 class="mt-4">Удалённая отладка с Delve</h1>

    
    <p>


  1 июля 2020 г.



            <a href="/ru/tags/docker/" class="badge">Docker</a>
            <a href="/ru/tags/debugger/" class="badge">Debugger</a>
            <a href="/ru/tags/delve/" class="badge">Delve</a>
            <a href="/ru/tags/vscode/" class="badge">Vscode</a>
            <a href="/ru/tags/goland/" class="badge">Goland</a>
    </p>

    <hr/>

    
    
    
    <div class="float-right">
        <div>
            
            
            <nav id="toc">
                <h5>Содержание</h5>
                <nav id="TableOfContents">
  <ul>
    <li><a href="#зачем-нужна-удалённая-отладка">Зачем нужна удалённая отладка?</a></li>
    <li><a href="#delve">Delve</a></li>
    <li><a href="#исходный-код">Исходный код</a></li>
    <li><a href="#docker">Docker</a></li>
    <li><a href="#запуск-контейнера">Запуск контейнера</a></li>
    <li><a href="#visual-studio-code">Visual Studio Code</a></li>
    <li><a href="#goland-ide">GoLand IDE</a></li>
  </ul>
</nav>
            </nav>
            
        </div>
        <div>
        </div>
    </div>
    

    <div id="post-content">
    <p>Ранее мы обсуждали локальную отладку с помощью IDE GoLand. Теперь мы обсудим, как удалённо отлаживать программу, работающую внутри Docker-контейнера, используя Visual Studio Code и GoLand IDE.</p>
<p>При локальной отладке IDE управляет всем — компилирует программу, запускает её и подключается к ней.</p>
<p>Однако иногда может потребоваться выполнить удалённую отладку. В этом случае ваша программа должна запускаться независимо от IDE. Подготовка программы к удалённой отладке будет задачей разработчика или DevOps-инженера.</p>
<h2 id="зачем-нужна-удалённая-отладка">Зачем нужна удалённая отладка?</h2>
<p>Это может показаться редким случаем использования, но вот ситуации, когда она может понадобиться:</p>
<ul>
<li>Программу нельзя протестировать локально, только в определённой удалённой среде</li>
<li>Необходимо проанализировать ошибку, которая воспроизводится только в удалённой среде — например, во время интеграционного тестирования</li>
</ul>
<p>Перед началом реализации удалённой отладки необходимо понимать, что ошибки легче исправлять на ранних этапах разработки. При локальной отладке вы можете запустить программу с помощью <code>go run</code>, <code>delve debug</code> или любой IDE. При удалённой отладке вам придётся ждать развёртывания программы в удалённой среде.</p>
<h2 id="delve">Delve</h2>
<p>Инструмент отладки, используемый в IDE GoLand или Visual Studio Code, — это Delve.</p>
<p>Отладка Delve + IDE всегда работает следующим образом:</p>
<ol>
<li>Delve запускается как серверное приложение, прослушивая сетевые подключения на определённом порту</li>
<li>Delve запускает нашу программу (скомпилированный бинарный файл или исходный код Go)</li>
<li>Delve позволяет IDE GoLand или Visual Studio Code подключиться к нему и получает данные о точках останова</li>
<li>В точке останова Delve приостанавливает программу и отправляет данные о переменных в IDE</li>
</ol>
<p>Delve — это инструмент командной строки. Все его параметры CLI определены <a href="https://github.com/go-delve/delve/tree/master/Documentation/cli">здесь</a>.</p>
<p>Помимо сетевого API, Delve также имеет опции отладки из командной строки для отладки напрямую из командной строки (без IDE). Однако мы не будем использовать эту опцию.</p>
<p>Итак, нам нужно запустить Delve и обеспечить удалённое подключение к нему из нашей IDE.</p>
<h2 id="исходный-код">Исходный код</h2>
<p>Для лучшего понимания этой статьи я создал репозиторий GitHub со всем связанным кодом.</p>
<h2 id="docker">Docker</h2>
<p>Docker-контейнеры — популярный тип развёртывания. Недавно мы обсуждали создание минимального Docker-образа и развёртывание Docker Swarm. Docker-контейнеры можно использовать здесь для демонстрации удалённого подключения.</p>
<p>Давайте настроим Dockerfile:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dockerfile" data-lang="dockerfile"><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> rhaps1071/golang-1.14-alpine-git AS build</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> /</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> . .<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> CGO_ENABLED<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> go get -ldflags <span style="color:#e6db74">&#34;-s -w -extldflags &#39;-static&#39;&#34;</span> github.com/go-delve/delve/cmd/dlv<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> CGO_ENABLED<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> go build -gcflags <span style="color:#e6db74">&#34;all=-N -l&#34;</span> -o ./app<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> scratch</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> --from<span style="color:#f92672">=</span>build /go/bin/dlv /dlv<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> --from<span style="color:#f92672">=</span>build /app /app<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENTRYPOINT</span> [ <span style="color:#e6db74">&#34;/dlv&#34;</span> ]<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>Здесь я использовал двухэтапную сборку и статическую компиляцию для создания минимального Docker-образа <code>FROM scratch</code>. В результирующем Docker-образе есть два файла: <code>/dlv</code> — Delve; <code>/app</code> — наша программа.</p>
<p>Флаги компиляции Go поддерживаются многими инструментами Go: <code>build</code>, <code>clean</code>, <code>get</code>, <code>install</code>, <code>list</code>, <code>run</code>, <code>test</code>. Благодаря этому бинарный файл Delve, полученный с помощью <code>go get</code>, также статически скомпилирован. По умолчанию бинарный файл Delve, скомпилированный в среде Alpine Linux, зависит от двух библиотек. Это можно проверить с помощью инструмента <code>ldd</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ldd /go/bin/dlv
</span></span><span style="display:flex;"><span>/lib/ld-musl-x86_64.so.1 <span style="color:#f92672">(</span>0x7f761f8b7000<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>libc.musl-x86_64.so.1 <span style="color:#f92672">=</span>&gt; /lib/ld-musl-x86_64.so.1 <span style="color:#f92672">(</span>0x7f761f8b7000<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>Флаги <code>-gcflags &quot;all=-N -l&quot;</code>, которые используются для компиляции основной программы, необходимы для правильной отладки нашей программы с помощью Delve.</p>
<p>Для сборки контейнера можно использовать <code>docker build -f ./docker/debug/Dockerfile -t debug .</code>, что реализовано как команда Makefile <code>docker-build-debug</code>, поэтому та же команда будет работать как <code>make docker-build-debug</code>.</p>
<h2 id="запуск-контейнера">Запуск контейнера</h2>
<p>Давайте запустим наш образ как контейнер, используя docker-compose.</p>
<p>Содержимое <code>docker-compose.yml</code> ниже:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">version</span>: <span style="color:#e6db74">&#34;3&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">services</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">debug</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">build</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">dockerfile</span>: <span style="color:#ae81ff">docker/debug/Dockerfile</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">context</span>: <span style="color:#ae81ff">../../</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">2345</span>:<span style="color:#ae81ff">2345</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: <span style="color:#e6db74">&#34;--listen=:2345 --headless=true --log=true --log-output=debugger,debuglineerr,gdbwire,lldbout,rpc --accept-multiclient --api-version=2 exec ./app&#34;</span>
</span></span></code></pre></div><p>Ранее мы настроили <code>ENTRYPOINT</code> в нашем образе как <code>/dlv</code>, поэтому теперь в параметре <code>command</code> мы передаём только аргументы Delve. Указанные выше параметры передаются, чтобы Delve работал как сетевой сервер и включал подробное логирование.</p>
<p>Давайте вызовем <code>docker-compose -f ./docker/debug/docker-compose.yml up</code> и проверим логи. Эта команда также доступна как <code>make docker-run-debug</code>.</p>
<pre tabindex="0"><code>Starting debug_debug_1 ... done
Attaching to debug_debug_1
debug_1  | API server listening at: [::]:2345
debug_1  | 2020-07-10T13:36:06Z debug layer=rpc API server pid = 1
debug_1  | 2020-07-10T13:36:06Z info layer=debugger launching process with args: [./app]
</code></pre><p>Логи показывают, что сервер отладки запущен на порту 2345 и готов принимать подключения.</p>
<p>Давайте подключимся к нему из IDE.</p>
<h2 id="visual-studio-code">Visual Studio Code</h2>
<p>Нам нужно открыть наш проект в IDE. Исходный код представляет программу в нашем контейнере.</p>
<p>Давайте создадим/изменим файл <code>.vscode/launch.json</code> со следующей конфигурацией:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;version&#34;</span>: <span style="color:#e6db74">&#34;0.2.0&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;configurations&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Attach&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;go&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;request&#34;</span>: <span style="color:#e6db74">&#34;attach&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;mode&#34;</span>: <span style="color:#e6db74">&#34;remote&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;remotePath&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;port&#34;</span>: <span style="color:#ae81ff">2345</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;host&#34;</span>: <span style="color:#e6db74">&#34;127.0.0.1&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;showLog&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;trace&#34;</span>: <span style="color:#e6db74">&#34;log&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;logOutput&#34;</span>: <span style="color:#e6db74">&#34;rpc&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li><code>&quot;request&quot;: &quot;attach&quot;</code> — позволяет VS Code подключиться к запущенному экземпляру Delve вместо запуска новой сессии отладки локально</li>
<li><code>port</code>, <code>host</code> — сетевой хост и порт нашего Delve. Используя docker-compose, мы запустили Docker-контейнер локально и опубликовали его порт 2345 на хост (localhost)</li>
<li><code>remotePath</code> — один из критических параметров, который влияет на успешную установку точек останова. Это путь к папке с исходным кодом, которая использовалась на этапе компиляции. Мы скомпилировали наш бинарный файл в Dockerfile, используя <code>WORKDIR /</code>, поэтому наша директория — это корневая директория — оставим <code>remotePath</code> пустым</li>
</ul>
<p>Перед выполнением каких-либо действий в IDE давайте проверим, что наш Docker-контейнер сейчас работает.</p>
<p>Затем запустите задачу отладки &ldquo;Attach&rdquo;. Мы должны установить точки останова и убедиться, что они остаются на месте (визуально в IDE). Каждая установка точки останова отражается в логах Docker-контейнера — ошибок быть не должно.</p>
<h2 id="goland-ide">GoLand IDE</h2>
<p>Все настройки в этой IDE можно изменить в графическом интерфейсе, без редактирования файлов конфигурации. Важная вещь — включить интеграцию модулей:</p>
<p>Нажмите <strong>Run → Edit configurations</strong>, добавьте новую конфигурацию отладки и выберите &ldquo;Go Remote&rdquo;:</p>
<p>Так же, как и в VS Code, мы должны установить точки останова и убедиться, что они на месте. Мы должны проверить логи Docker-контейнера. Если есть какие-либо ошибки, например <code>could not find file somedir/main.go</code>, вам нужно включить интеграцию модулей Go.</p>
    
  <div>
    <div>Tags:</div>
    <ul>
        <li><a href="/ru/tags/docker/">Docker</a></li>
        <li><a href="/ru/tags/debugger/">Debugger</a></li>
        <li><a href="/ru/tags/delve/">Delve</a></li>
        <li><a href="/ru/tags/vscode/">Vscode</a></li>
        <li><a href="/ru/tags/goland/">Goland</a></li>
    </ul>
  </div>

    </div>
    
<div id="article-quiz" class="mt-5 mb-5" data-quiz-lang="ru">
  <hr class="mb-4">
  <h3 class="mb-4">Проверьте свои знания</h3>
  
  <form id="quiz-form" data-quiz-data="{&#34;questions&#34;:[{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;Инструмент отладки для Go&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;Фреймворк для тестирования&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;Форматтер кода&#34;}],&#34;question&#34;:&#34;Что такое Delve?&#34;,&#34;type&#34;:&#34;single-choice&#34;},{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;Когда программу нельзя протестировать локально&#34;},{&#34;correct&#34;:true,&#34;text&#34;:&#34;Когда ошибки воспроизводятся только в удалённой среде&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;Когда нужна более быстрая отладка&#34;}],&#34;question&#34;:&#34;Когда полезна удалённая отладка?&#34;,&#34;type&#34;:&#34;multiple-choice&#34;},{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;-gcflags &#39;all=-N -l&#39;&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;-ldflags &#39;-s -w&#39;&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;-tags debug&#34;}],&#34;question&#34;:&#34;Какие флаги компиляции нужны для правильной отладки с Delve?&#34;,&#34;type&#34;:&#34;single-choice&#34;},{&#34;answers&#34;:[{&#34;correct&#34;:true,&#34;text&#34;:&#34;Delve запускается как сервер, и IDE подключается к нему&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;IDE запускает Delve напрямую&#34;},{&#34;correct&#34;:false,&#34;text&#34;:&#34;Delve встроен в IDE&#34;}],&#34;question&#34;:&#34;Как работает Delve с IDE?&#34;,&#34;type&#34;:&#34;single-choice&#34;}]}">
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="0">
      <h5 class="mb-3">1. Что такое Delve?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-0" 
                 value="0"
                 id="q0-a0">
          <label class="form-check-label" for="q0-a0">
            Инструмент отладки для Go
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-0" 
                 value="1"
                 id="q0-a1">
          <label class="form-check-label" for="q0-a1">
            Фреймворк для тестирования
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-0" 
                 value="2"
                 id="q0-a2">
          <label class="form-check-label" for="q0-a2">
            Форматтер кода
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="1">
      <h5 class="mb-3">2. Когда полезна удалённая отладка?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-1" 
                 value="0"
                 id="q1-a0">
          <label class="form-check-label" for="q1-a0">
            Когда программу нельзя протестировать локально
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-1" 
                 value="1"
                 id="q1-a1">
          <label class="form-check-label" for="q1-a1">
            Когда ошибки воспроизводятся только в удалённой среде
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" 
                 name="question-1" 
                 value="2"
                 id="q1-a2">
          <label class="form-check-label" for="q1-a2">
            Когда нужна более быстрая отладка
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="2">
      <h5 class="mb-3">3. Какие флаги компиляции нужны для правильной отладки с Delve?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-2" 
                 value="0"
                 id="q2-a0">
          <label class="form-check-label" for="q2-a0">
            -gcflags &#39;all=-N -l&#39;
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-2" 
                 value="1"
                 id="q2-a1">
          <label class="form-check-label" for="q2-a1">
            -ldflags &#39;-s -w&#39;
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-2" 
                 value="2"
                 id="q2-a2">
          <label class="form-check-label" for="q2-a2">
            -tags debug
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    <div class="quiz-question mb-4 p-3 border rounded" data-question-index="3">
      <h5 class="mb-3">4. Как работает Delve с IDE?</h5>
      
      
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-3" 
                 value="0"
                 id="q3-a0">
          <label class="form-check-label" for="q3-a0">
            Delve запускается как сервер, и IDE подключается к нему
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-3" 
                 value="1"
                 id="q3-a1">
          <label class="form-check-label" for="q3-a1">
            IDE запускает Delve напрямую
          </label>
        </div>
        
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" 
                 name="question-3" 
                 value="2"
                 id="q3-a2">
          <label class="form-check-label" for="q3-a2">
            Delve встроен в IDE
          </label>
        </div>
        
      
      
      <div class="quiz-feedback mt-2" style="display: none;"></div>
    </div>
    
    
    <button type="button" class="btn btn-primary" id="check-answers">
      Проверить ответы
    </button>
    <button type="button" class="btn btn-secondary ml-2" id="reset-quiz" style="display: none;">
      Сбросить
    </button>
  </form>
  
  <div id="quiz-results" class="mt-4" style="display: none;">
    <div class="alert" role="alert"></div>
  </div>
</div>

<script>
(function() {
  try {
    const quizContainer = document.getElementById('article-quiz');
    const form = document.getElementById('quiz-form');
    const checkBtn = document.getElementById('check-answers');
    const resetBtn = document.getElementById('reset-quiz');
    const resultsDiv = document.getElementById('quiz-results');
    
    if (!quizContainer || !form || !checkBtn) {
      console.error('Quiz initialization failed: missing elements', {
        quizContainer: !!quizContainer,
        form: !!form,
        checkBtn: !!checkBtn
      });
      return;
    }
    
    const lang = quizContainer.getAttribute('data-quiz-lang') || 'en';
    const quizDataRaw = form.getAttribute('data-quiz-data');
    
    if (!quizDataRaw) {
      console.error('Quiz data not found in data attribute');
      return;
    }
    
    let quizData;
    try {
      quizData = JSON.parse(quizDataRaw);
    } catch (e) {
      console.error('Failed to parse quiz data:', e, quizDataRaw);
      return;
    }
    
    if (!quizData || !quizData.questions || !Array.isArray(quizData.questions)) {
      console.error('Invalid quiz data structure:', quizData);
      return;
    }
    
    
    console.log('Quiz data loaded:', quizData);
  
    function arraysEqual(a, b) {
      if (!a || !b) return false;
      if (a.length !== b.length) return false;
      const sortedA = [...a].sort();
      const sortedB = [...b].sort();
      return sortedA.every((val, i) => val === sortedB[i]);
    }
    
    checkBtn.addEventListener('click', function() {
    if (!quizData.questions || !Array.isArray(quizData.questions)) {
      console.error('Invalid quiz data structure');
      return;
    }
    
    let correctCount = 0;
    let totalQuestions = quizData.questions.length;
    
    quizData.questions.forEach((question, qIndex) => {
      const questionDiv = form.querySelector(`[data-question-index="${qIndex}"]`);
      if (!questionDiv) {
        console.error('Question div not found for index:', qIndex);
        return;
      }
      
      const feedbackDiv = questionDiv.querySelector('.quiz-feedback');
      if (!feedbackDiv) {
        console.error('Feedback div not found for question:', qIndex);
        return;
      }
      
      if (question.type === 'multiple-choice' || question.type === 'single-choice') {
        if (!question.answers || !Array.isArray(question.answers)) {
          console.error('Invalid answers for question:', qIndex);
          return;
        }
        
        const inputs = questionDiv.querySelectorAll(`input[name="question-${qIndex}"]`);
        const selectedAnswers = Array.from(inputs)
          .filter(input => input.checked)
          .map(input => parseInt(input.value));
        
        const correctAnswers = question.answers
          .map((answer, index) => answer.correct === true ? index : -1)
          .filter(index => index !== -1);
        
        const isCorrect = arraysEqual(selectedAnswers, correctAnswers);
        
        if (isCorrect) {
          correctCount++;
          feedbackDiv.innerHTML = '<span class="text-success">✓ ' + (lang === 'ru' ? 'Правильно!' : 'Correct!') + '</span>';
          feedbackDiv.style.display = 'block';
          inputs.forEach(input => {
            const answerIndex = parseInt(input.value);
            const answer = question.answers[answerIndex];
            if (!answer) return;
            
            if (input.checked && answer.correct === true) {
              input.parentElement.classList.add('text-success');
            } else if (input.checked && answer.correct !== true) {
              input.parentElement.classList.add('text-danger');
            } else if (!input.checked && answer.correct === true) {
              input.parentElement.classList.add('text-warning');
            }
          });
        } else {
          feedbackDiv.innerHTML = '<span class="text-danger">✗ ' + (lang === 'ru' ? 'Неправильно' : 'Incorrect') + '</span>';
          feedbackDiv.style.display = 'block';
          inputs.forEach(input => {
            const answerIndex = parseInt(input.value);
            const answer = question.answers[answerIndex];
            if (!answer) return;
            
            if (input.checked && answer.correct !== true) {
              input.parentElement.classList.add('text-danger');
            } else if (!input.checked && answer.correct === true) {
              input.parentElement.classList.add('text-warning');
            }
          });
        }
      } else if (question.type === 'text') {
        const textarea = questionDiv.querySelector('textarea');
        const correctAnswerDiv = questionDiv.querySelector('[data-correct-answer]');
        
        if (!textarea || !question.correct_answer) {
          console.error('Invalid text question:', qIndex);
          return;
        }
        
        if (textarea.value.trim().toLowerCase() === question.correct_answer.toLowerCase()) {
          correctCount++;
          feedbackDiv.innerHTML = '<span class="text-success">✓ ' + (lang === 'ru' ? 'Правильно!' : 'Correct!') + '</span>';
          feedbackDiv.style.display = 'block';
        } else {
          feedbackDiv.innerHTML = '<span class="text-danger">✗ ' + (lang === 'ru' ? 'Неправильно' : 'Incorrect') + '</span>';
          feedbackDiv.style.display = 'block';
          if (correctAnswerDiv) {
            correctAnswerDiv.style.display = 'block';
          }
        }
      }
    });
    
    const percentage = Math.round((correctCount / totalQuestions) * 100);
    const alertClass = percentage >= 70 ? 'alert-success' : percentage >= 50 ? 'alert-warning' : 'alert-danger';
    const message = (lang === 'ru' ? 'Вы ответили правильно на ' : 'You got ') + 
                   correctCount + (lang === 'ru' ? ' из ' : ' out of ') + 
                   totalQuestions + (lang === 'ru' ? ' вопросов (' : ' questions (') + 
                   percentage + '%)';
    
    const alertElement = resultsDiv.querySelector('.alert');
    if (alertElement) {
      alertElement.className = 'alert ' + alertClass;
      alertElement.textContent = message;
    }
      resultsDiv.style.display = 'block';
      checkBtn.style.display = 'none';
      if (resetBtn) {
        resetBtn.style.display = 'inline-block';
      }
    });
    
    if (resetBtn) {
      resetBtn.addEventListener('click', function() {
        form.reset();
        form.querySelectorAll('.quiz-feedback').forEach(el => el.style.display = 'none');
        form.querySelectorAll('.text-success, .text-danger, .text-warning').forEach(el => {
          el.classList.remove('text-success', 'text-danger', 'text-warning');
        });
        form.querySelectorAll('[data-correct-answer]').forEach(el => el.style.display = 'none');
        resultsDiv.style.display = 'none';
        checkBtn.style.display = 'inline-block';
        resetBtn.style.display = 'none';
      });
    }
  } catch (error) {
    console.error('Quiz script error:', error);
  }
})();
</script>



    
    <hr class="mt-5 mb-4">
    <h3 class="mb-4">Похожие статьи</h3>
    <div class="row">
      <div class="col-md-6 mb-4">
        <div class="card h-100 bg-light rounded" style="border: none;">
          <div class="card-body">
            <span style="color: #aaa; font-size: 0.9em;">


  1 июля 2020 г.


</span>
            <h4 class="card-title mt-2">
              <a href="/ru/post/deploy-docker-swarm-gitlab.html" style="text-decoration: none; color: inherit;">Деплой docker swarm из Gitlab CI</a>
            </h4>
            
            
            
            <a href="/ru/post/deploy-docker-swarm-gitlab.html">
              <img class="card-img-top mb-3 rounded"
                   src="/en/post/deploy-docker-swarm-gitlab/docker.svg"
                   style="max-height: 200px;"
                   alt="Деплой docker swarm из Gitlab CI"/>
            </a>
            
            
            <p class="card-text"><p>Ранее мы рассматривали деплой бинарного файла программы через SSH на сервер</p>
<p>Сейчас мы рассмотрим как реализовать деплой Docker контейнера из Gitlab CI.</p></p>
            
            <a href="/ru/post/deploy-docker-swarm-gitlab.html" class="btn btn-primary btn-sm">Read More →</a>
                  <a href="/ru/tags/docker/" class="badge">Docker</a>
                  <a href="/ru/tags/deploy/" class="badge">Deploy</a>
                  <a href="/ru/tags/gitlab/" class="badge">Gitlab</a>
                  <a href="/ru/tags/ci/cd/" class="badge">Ci/Cd</a>
          </div>
        </div>
      </div>
      <div class="col-md-6 mb-4">
        <div class="card h-100 bg-light rounded" style="border: none;">
          <div class="card-body">
            <span style="color: #aaa; font-size: 0.9em;">


  30 июня 2020 г.


</span>
            <h4 class="card-title mt-2">
              <a href="/ru/post/net-wait-go.html" style="text-decoration: none; color: inherit;">Утилита и библиотека net-wait-go</a>
            </h4>
            
            
            
            <a href="/ru/post/net-wait-go.html">
              <img class="card-img-top mb-3 rounded"
                   src="/en/post/net-wait-go/tube2.svg"
                   style="max-height: 200px;"
                   alt="Утилита и библиотека net-wait-go"/>
            </a>
            
            
            <p class="card-text"><p>Утилита и пакет Go для ожидания открытия портов (TCP, UDP).</p></p>
            
            <a href="/ru/post/net-wait-go.html" class="btn btn-primary btn-sm">Read More →</a>
                  <a href="/ru/tags/tcp/" class="badge">Tcp</a>
                  <a href="/ru/tags/udp/" class="badge">Udp</a>
                  <a href="/ru/tags/docker/" class="badge">Docker</a>
          </div>
        </div>
      </div>
      <div class="col-md-6 mb-4">
        <div class="card h-100 bg-light rounded" style="border: none;">
          <div class="card-body">
            <span style="color: #aaa; font-size: 0.9em;">


  29 июня 2020 г.


</span>
            <h4 class="card-title mt-2">
              <a href="/en/post/go-minimum-docker-image.html" style="text-decoration: none; color: inherit;">Создание минимального Docker образа для Go приложений</a>
            </h4>
            
            
            
            <a href="/en/post/go-minimum-docker-image.html">
              <img class="card-img-top mb-3 rounded"
                   src="/ru/post/go-minimum-docker-image/docker.svg"
                   style="max-height: 200px;"
                   alt="Создание минимального Docker образа для Go приложений"/>
            </a>
            
            
            <p class="card-text"><p>Давайте обсудим, как создать минимальный Docker образ для Go программы.</p></p>
            
            <a href="/en/post/go-minimum-docker-image.html" class="btn btn-primary btn-sm">Read More →</a>
                  <a href="/ru/tags/docker/" class="badge">Docker</a>
                  <a href="/ru/tags/compilation/" class="badge">Compilation</a>
                  <a href="/ru/tags/upx/" class="badge">Upx</a>
                  <a href="/ru/tags/ldflags/" class="badge">Ldflags</a>
          </div>
        </div>
      </div>
      <div class="col-md-6 mb-4">
        <div class="card h-100 bg-light rounded" style="border: none;">
          <div class="card-body">
            <span style="color: #aaa; font-size: 0.9em;">


  24 марта 2020 г.


</span>
            <h4 class="card-title mt-2">
              <a href="/ru/post/goland-debugger.html" style="text-decoration: none; color: inherit;">Как и зачем использовать дебаггер с GO</a>
            </h4>
            
            
            
            
            <p class="card-text"><p>Отладчик — это очень полезный и мощный инструмент. Он может помочь вам точно понять, что происходит в вашем коде, изучить новые проекты и избежать ненужных изменений отладочного кода.</p></p>
            
            <a href="/ru/post/goland-debugger.html" class="btn btn-primary btn-sm">Read More →</a>
                  <a href="/ru/tags/debugger/" class="badge">Debugger</a>
                  <a href="/ru/tags/goland/" class="badge">Goland</a>
          </div>
        </div>
      </div>
    </div>


    <script defer src="/discuss.js"></script>
    <div id="discuss"></div>
</div>

</div>

<div class="bg-light">&nbsp;</div>

<footer>
    <div class="container " style="padding-top: 0; padding-bottom: 10px;">
    <div class="container">
        <img src="/niz.svg" alt="gopher legs" style="height: 50px; vertical-align: top;"/>
        <div style="text-align: right; vertical-align: top; display: inline-block;">
            
            &nbsp;
            &nbsp;
            &nbsp;
            
            
            <a href='/en/post/go-docker-delve-remote-debug.html'>
            <span class="flag-icon flag-icon-us"></span>
            </a>
            
        </div>

    </div>
</div>

</footer>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script defer src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

</body>
</html>
